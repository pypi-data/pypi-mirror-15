"use strict;";angular.module("mediaExplorer",["ui.bootstrap","mediaExplorer.images","mediaExplorer.videos","mediaExplorer.mg"]),angular.module("mediaExplorer").service("ActiveTab",function ActiveTab(){var ActiveTab=this;return ActiveTab.activeTab=1,ActiveTab.changeActiveTab=function(tabNumber){ActiveTab.activeTab=tabNumber},ActiveTab}),angular.module("mediaExplorer").controller("GlobalController",["$scope","ActiveTab",function($scope,ActiveTab){$scope.init=function(){$scope.activeTabService=ActiveTab},$scope.init()}]),angular.module("dropzone",[]),angular.module("dropzone",[]).directive("dropzone",function(){return function(scope,element,attrs){Dropzone.autoDiscover=!1,Dropzone.prototype.defaultOptions.dictDefaultMessage="Drag files here to upload, or click to browse your computer.",Dropzone.prototype.defaultOptions.previewTemplate='<div class="dz-preview dz-file-preview">\n<div class="dz-image"><img data-dz-thumbnail /></div>\n<div class="dz-details">\n<div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n</div>\n<div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n<div class="dz-error-message"><span data-dz-errormessage></span></div>\n<div class="dz-success-mark">\n<svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n<title>Check</title>\n<defs></defs>\n<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n<path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n</g>\n</svg>\n</div>\n<div class="dz-error-mark">\n<svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n<title>Error</title>\n<defs></defs>\n<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n<g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n<path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n</g>\n</g>\n</svg>\n</div>\n<div class="dz-remove" data-dz-remove><span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-times fa-stack-1x"></i></span></div>';var config,dropzone;config=scope[attrs.dropzone],dropzone=new Dropzone(element[0],config.options),angular.forEach(config.eventHandlers,function(handler,event){dropzone.on(event,handler)})}}),angular.module("bootstrapLightbox",["ngTouch","ui.bootstrap","chieffancypants.loadingBar","ngSanitize"]),angular.module("bootstrapLightbox").filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),angular.module("bootstrapLightbox").directive("lightboxSrc",["$window","ImageLoader","Lightbox",function($window,ImageLoader,Lightbox){var calculateImageDisplayDimensions=function(dimensions){var w=dimensions.width,h=dimensions.height,minW=dimensions.minWidth,minH=dimensions.minHeight,maxW=dimensions.maxWidth,maxH=dimensions.maxHeight,displayW=w,displayH=h;return minW>w&&minH>h?w/h>maxW/maxH?(displayH=minH,displayW=Math.round(w*minH/h)):(displayW=minW,displayH=Math.round(h*minW/w)):minW>w?(displayW=minW,displayH=Math.round(h*minW/w)):minH>h&&(displayH=minH,displayW=Math.round(w*minH/h)),w>maxW&&h>maxH?w/h>maxW/maxH?(displayW=maxW,displayH=Math.round(h*maxW/w)):(displayH=maxH,displayW=Math.round(w*maxH/h)):w>maxW?(displayW=maxW,displayH=Math.round(h*maxW/w)):h>maxH&&(displayH=maxH,displayW=Math.round(w*maxH/h)),{width:displayW||0,height:displayH||0}},imageWidth=0,imageHeight=0;return{link:function(scope,element,attrs){var resize=function(){{var windowWidth=$window.innerWidth,windowHeight=$window.innerHeight,imageDimensionLimits=Lightbox.calculateImageDimensionLimits({windowWidth:windowWidth,windowHeight:windowHeight,imageWidth:.75*windowWidth-30,imageHeight:.75*windowHeight-30}),imageDisplayDimensions=calculateImageDisplayDimensions(angular.extend({width:imageWidth,height:imageHeight,minWidth:1,minHeight:1,maxWidth:65*windowWidth,maxHeight:3e3},imageDimensionLimits));Lightbox.calculateModalDimensions({windowWidth:windowWidth,windowHeight:windowHeight,imageDisplayWidth:imageDisplayDimensions.width,imageDisplayHeight:imageDisplayDimensions.height})}element.css({width:imageDisplayDimensions.width+"px",height:imageDisplayDimensions.height+"px"}),angular.element(document.querySelector(".lightbox-modal .modal-dialog")).css({width:.75*windowWidth+"px"}),angular.element(document.querySelector(".lightbox-modal .modal-content")).css({height:.75*windowHeight*1.25+"px"})};scope.$watch(function(){return attrs.lightboxSrc},function(src){element[0].src="//:0",ImageLoader.load(src).then(function(image){imageWidth=image.naturalWidth,imageHeight=image.naturalHeight,resize(),element[0].src=src})}),angular.element($window).on("resize",resize)}}}]),angular.module("bootstrapLightbox").provider("Lightbox",function(){this.templateUrl="/static/partials/media_explorer/lightbox.html",this.getImageUrl=function(element){return"image"==element.type?element.image_url:element.thumbnail_image_url},this.getImageCaption=function(element){return element.description},this.getVideoEmbed=function(element){return element.video_embed},this.calculateImageDimensionLimits=function(dimensions){return dimensions.windowWidth>=768?{maxWidth:.75*dimensions.windowWidth-92,maxHeight:.75*dimensions.windowHeight-126}:{maxWidth:.75*dimensions.windowWidth-52,maxHeight:.75*dimensions.windowHeight-86}},this.calculateModalDimensions=function(dimensions){var width=Math.max(640,dimensions.imageDisplayWidth+32),height=Math.max(375,dimensions.imageDisplayHeight+66);return(width>=dimensions.windowWidth-20||dimensions.windowWidth<768)&&(width="auto"),height>=dimensions.windowHeight&&(height="auto"),{width:width,height:height}},this.$get=["$document","$modal","$timeout","cfpLoadingBar","ImageLoader",function($document,$modal,$timeout,cfpLoadingBar,ImageLoader){var images=[],index=-1,Lightbox={};return Lightbox.templateUrl=this.templateUrl,Lightbox.getImageUrl=this.getImageUrl,Lightbox.getImageCaption=this.getImageCaption,Lightbox.getVideoEmbed=this.getVideoEmbed,Lightbox.calculateImageDimensionLimits=this.calculateImageDimensionLimits,Lightbox.calculateModalDimensions=this.calculateModalDimensions,Lightbox.keyboardNavEnabled=!1,Lightbox.image={},Lightbox.modalInstance=null,Lightbox.openModal=function(newImages,newIndex){return images=newImages,Lightbox.setImage(newIndex),Lightbox.modalInstance=$modal.open({templateUrl:Lightbox.templateUrl,controller:["$scope",function($scope){$scope.Lightbox=Lightbox,Lightbox.keyboardNavEnabled=!0}],windowClass:"lightbox-modal"}),Lightbox.modalInstance.result["finally"](function(){Lightbox.image={},Lightbox.imageUrl=null,Lightbox.imageCaption=null,lightbox.videoEmbed=null,Lightbox.keyboardNavEnabled=!1,cfpLoadingBar.complete()}),Lightbox.modalInstance},Lightbox.closeModal=function(result){return Lightbox.modalInstance.close(result)},Lightbox.setImage=function(newIndex){if(!(newIndex in images))throw"Invalid image.";cfpLoadingBar.start();var success=function(){index=newIndex,Lightbox.image=images[index],cfpLoadingBar.complete()},imageUrl=Lightbox.getImageUrl(images[newIndex]),videoEmbed=Lightbox.getVideoEmbed(images[newIndex]);ImageLoader.load(imageUrl).then(function(){success(),Lightbox.imageUrl=imageUrl,Lightbox.imageCaption=Lightbox.getImageCaption(Lightbox.image),Lightbox.videoEmbed=videoEmbed},function(){success(),Lightbox.imageUrl="//:0",Lightbox.imageCaption="Failed to load element"})},Lightbox.firstImage=function(){Lightbox.setImage(0)},Lightbox.prevImage=function(){Lightbox.setImage((index-1+images.length)%images.length)},Lightbox.nextImage=function(){Lightbox.setImage((index+1)%images.length)},Lightbox.lastImage=function(){Lightbox.setImage(images.length-1)},Lightbox.setImages=function(newImages){images=newImages,Lightbox.setImage(index)},$document.bind("keydown",function(event){if(Lightbox.keyboardNavEnabled){var method=null;switch(event.which){case 39:method="nextImage";break;case 37:method="prevImage"}null!==method&&-1===["input","textarea"].indexOf(event.target.tagName.toLowerCase())&&($timeout(function(){Lightbox[method]()}),event.preventDefault())}}),Lightbox}]}),angular.module("bootstrapLightbox").service("ImageLoader",["$q",function($q){this.load=function(url){var deferred=$q.defer(),image=new Image;return image.onload=function(){("boolean"==typeof this.complete&&this.complete===!1||"number"==typeof this.naturalWidth&&0===this.naturalWidth)&&deferred.reject(),deferred.resolve(image)},image.onerror=function(){deferred.reject()},image.src=url,deferred.promise}}]),angular.module("mediaExplorer.images",["ui.bootstrap","dropzone","bootstrapLightbox","mediaExplorer.mg"]),angular.module("mediaExplorer.images").run(["$http",function($http){$http.defaults.headers.common["X-CSRFToken"]=getCookie("csrftoken"),$http.defaults.headers.common["Content-Type"]="application/x-www-form-urlencoded"}]),angular.module("mediaExplorer.images").directive("imagetab",function(){return{restrict:"E",controller:"ImagesController",scope:!0,replace:!0,transclude:!0,templateUrl:"/static/partials/media_explorer/imagetab.html"}}),angular.module("mediaExplorer.images").filter("startFrom",function(){return function(input,start){return start=parseInt(start,10),start?input.slice(start):input}}),angular.module("mediaExplorer.images").service("Images",function Images($http,$q){var Images=this;return Images.imageList={},Images.stats={},Images.imageViewToggle=!1,Images.currentPage=1,Images.userPageSizes=[{size:5},{size:10},{size:25},{size:50}],Images.userPageSizeSelection=Images.userPageSizes[0].size,Images.oldServerPage=1,Images.newServerPage=1,Images.sort_by="created_at",Images.direction="desc",Images.filter="",Images.searchTerm="",Images.getImageStats=function(){var defer=$q.defer();return $http.get("/api/stats/elements?type=image&filter="+Images.filter).success(function(res){Images.stats=res,defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},Images.changePage=function(page){Images.oldServerPage=Images.newServerPage,Images.currentPage=page,Images.newServerPage=Math.ceil(Images.currentPage*Images.userPageSizeSelection/Images.stats.page_size)},Images.getFirst=function(){Images.changePage(1),Images.getImagesByPage()},Images.getPrevious=function(){Images.changePage(Images.currentPage-1),Images.oldServerPage!=Images.newServerPage&&Images.getImagesByPage()},Images.getNext=function(){Images.changePage(Images.currentPage+1),Images.oldServerPage!=Images.newServerPage&&Images.getImagesByPage()},Images.getLast=function(){Images.changePage(Images.getTotalUserPages()),Images.getImagesByPage()},Images.getTotalUserPages=function(){return Math.ceil(Images.stats.total_entries/Images.userPageSizeSelection)},Images.changeDirection=function(sort_by){Images.direction=Images.sort_by!=sort_by?"created_at"==sort_by?"desc":"asc":"desc"==Images.direction?"asc":"desc"},Images.sort=function(sort_by){Images.changeDirection(sort_by),Images.sort_by=sort_by,Images.changePage(1),Images.getImagesByPage()},Images.search=function(filter){Images.filter=filter,Images.changePage(1),Images.getImagesByPage()},Images.getImagesByPage=function(page,sort_by,direction,filter){page=page||Images.currentPage,sort_by=sort_by||Images.sort_by,direction=direction||Images.direction,filter=filter||Images.filter,page!=Images.currentPage&&(Images.currentPage=page),sort_by!=Images.sort_by&&(Images.sort_by=sort_by),direction!=Images.direction&&(Images.direction=direction),filter!=Images.filter&&(Images.filter=filter);var defer=$q.defer();return $http.get("/api/media/elements?type=image&page="+Images.newServerPage+"&sort="+Images.sort_by+"&direction="+Images.direction+"&filter="+Images.filter).success(function(res){Images.getImageStats(),Images.imageList=res,defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},Images.editImage=function(id,form){var defer=$q.defer();return $http.put("/api/media/elements/"+id,form,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(res){defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},Images.deleteImage=function(id){var defer=$q.defer();return $http["delete"]("/api/media/elements/"+id).success(function(res){defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},Images}),angular.module("mediaExplorer.images").controller("ImagesController",["$scope","$modal","ActiveTab","Images","MG","Lightbox",function($scope,$modal,ActiveTab,Images,MG,Lightbox){$scope.init=function(){$scope.imageService=Images,$scope.mgService=MG,$scope.imageService.getImageStats(),$scope.imageService.getImagesByPage($scope.imageService.currentPage),$scope.currentActiveTab=ActiveTab,$scope.disableInsert=disableInsertion()},$scope.ieAlert=function(){alert("Sorry! Django Media Explorer is read-only in older browsers. Consider upgrading to a modern alternative.")},$scope.insertImage=function(image){opener.MediaExplorer.insert(image),window.close()},$scope.openLightbox=function(orderedList,index){Lightbox.openModal(orderedList,index)},$scope.editImage=function(image){var confirmSave=confirm("This will permanently alter this image entry. Do you wish to proceed?");if(confirmSave){var editImageForm=new FormData;editImageForm.append("name",image.editName),image.editDescription?editImageForm.append("description",image.editDescription):editImageForm.append("description",""),image.editCredit?editImageForm.append("credit",image.editCredit):editImageForm.append("credit",""),$scope.imageService.editImage(image.id,editImageForm).then(function(){$scope.imageService.getImagesByPage($scope.imageService.currentPage),$scope.mgService.getAllMediaGalleries()},function(){alert("There was an error saving your edits. Please try again later."),$scope.imageService.getImagesByPage($scope.imageService.currentPage)})}},$scope.deleteImage=function(element){var confirmDelete=confirm("This will permanently delete this image entry. Do you wish to proceed?");confirmDelete&&$scope.imageService.deleteImage(element.id).then(function(){$scope.imageService.getImagesByPage($scope.imageService.currentPage),$scope.mgService.removeElementFromNewMg(element),$scope.mgService.getAllMediaGalleries()},function(){alert("There was an error deleting this element. Please try again later."),$scope.imageService.getImagesByPage($scope.imageService.currentPage)})},$scope.init()}]),angular.module("mediaExplorer.images").controller("DropzoneImageController",function($scope){$scope.imageDropzoneConfig={options:{paramName:"image",headers:{"X-CSRFToken":getCookie("csrftoken")},url:"/api/media/elements",parallelUploads:1},eventHandlers:{sending:function(){},success:function(){$scope.imageService.getImagesByPage($scope.imageService.currentPage),$scope.imageService.getImageStats()},processing:function(){uploadInProgressState(!0)},queuecomplete:function(){uploadInProgressState(!1)}}}}),angular.module("mediaExplorer.videos",["ui.bootstrap","bootstrapLightbox","mediaExplorer.mg"]),angular.module("mediaExplorer.videos").run(["$http",function($http){$http.defaults.headers.common["X-CSRFToken"]=getCookie("csrftoken")}]),angular.module("mediaExplorer.videos").directive("videotab",function(){return{restrict:"E",controller:"VideosController",scope:!0,replace:!0,transclude:!0,templateUrl:"/static/partials/media_explorer/videotab.html"}}),angular.module("mediaExplorer.videos").directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]),angular.module("mediaExplorer.videos").filter("startFrom",function(){return function(input,start){return start=parseInt(start,10),start?input.slice(start):input}}),angular.module("mediaExplorer.videos").service("Videos",function Videos($http,$q){var Videos=this;return Videos.videoList={},Videos.stats={},Videos.newVideoFormData={},Videos.videoViewToggle=!1,Videos.currentPage=1,Videos.userPageSizes=[{size:5},{size:10},{size:25},{size:50}],Videos.userPageSizeSelection=Videos.userPageSizes[0].size,Videos.oldServerPage=1,Videos.newServerPage=1,Videos.sort_by="created_at",Videos.direction="desc",Videos.filter="",Videos.searchTerm="",Videos.getVideoStats=function(){var defer=$q.defer();return $http.get("/api/stats/elements?type=video&filter="+Videos.filter).success(function(res){Videos.stats=res,defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},Videos.changePage=function(page){Videos.oldServerPage=Videos.newServerPage,Videos.currentPage=page,Videos.newServerPage=Math.ceil(Videos.currentPage*Videos.userPageSizeSelection/Videos.stats.page_size)},Videos.getFirst=function(){Videos.changePage(1),Videos.getVideosByPage()},Videos.getPrevious=function(){Videos.changePage(Videos.currentPage-1),Videos.oldServerPage!=Videos.newServerPage&&Videos.getVideosByPage()},Videos.getNext=function(){Videos.changePage(Videos.currentPage+1),Videos.oldServerPage!=Videos.newServerPage&&Videos.getVideosByPage()},Videos.getLast=function(){Videos.changePage(Videos.getTotalUserPages()),Videos.getVideosByPage()},Videos.getTotalUserPages=function(){return Math.ceil(Videos.stats.total_entries/Videos.userPageSizeSelection)},Videos.changeDirection=function(sort_by){Videos.direction=Videos.sort_by!=sort_by?"created_at"==sort_by?"desc":"asc":"desc"==Videos.direction?"asc":"desc"},Videos.sort=function(sort_by){Videos.changeDirection(sort_by),Videos.sort_by=sort_by,Videos.changePage(1),Videos.getVideosByPage()},Videos.search=function(filter){Videos.filter=filter,Videos.changePage(1),Videos.getVideosByPage()},Videos.getVideosByPage=function(page,sort_by,direction,filter){page=page||Videos.currentPage,sort_by=sort_by||Videos.sort_by,direction=direction||Videos.direction,filter=filter||Videos.filter,page!=Videos.currentPage&&(Videos.currentPage=page),sort_by!=Videos.sort_by&&(Videos.sort_by=sort_by),direction!=Videos.direction&&(Videos.direction=direction),filter!=Videos.filter&&(Videos.filter=filter);var defer=$q.defer();return $http.get("/api/media/elements?type=video&page="+Videos.newServerPage+"&sort="+Videos.sort_by+"&direction="+Videos.direction+"&filter="+Videos.filter).success(function(res){Videos.getVideoStats(),Videos.videoList=res,defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},Videos.addNewVideo=function(form){var defer=$q.defer();return $http.post("/api/media/elements",form,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(res){defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},Videos.editVideo=function(id,form){var defer=$q.defer();return $http.put("/api/media/elements/"+id,form,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(res){defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},Videos.deleteVideo=function(video){var defer=$q.defer();return $http["delete"]("/api/media/elements/"+video.id).success(function(res){defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},Videos}),angular.module("mediaExplorer.videos").controller("VideosController",["$scope","$modal","ActiveTab","Videos","MG","Lightbox",function($scope,$modal,ActiveTab,Videos,MG,Lightbox){$scope.init=function(){$scope.videoService=Videos,$scope.mgService=MG,$scope.videoService.getVideoStats(),$scope.videoService.getVideosByPage($scope.videoService.currentPage),$scope.videoService.newVideoFormData={},$scope.currentActiveTab=ActiveTab,$scope.disableInsert=disableInsertion()},$scope.ieAlert=function(){alert("Sorry! Django Media Explorer is read-only in older browsers. Consider upgrading to a modern alternative.")},$scope.insertVideo=function(video){opener.MediaExplorer.insert(video),window.close()},$scope.openLightbox=function(orderedList,index){Lightbox.openModal(orderedList,index)},$scope.addVideo=function(){($scope.videoService.newVideoFormData.video_url.indexOf("iframe")>-1||$scope.videoService.newVideoFormData.video_url.indexOf("<div")>-1)&&($scope.videoService.newVideoFormData.video_embed=$scope.videoService.newVideoFormData.video_url,$scope.videoService.newVideoFormData.video_url=""),$scope.videoService.newVideoFormData.video_url&&$scope.videoService.newVideoFormData.video_url.indexOf("https://youtu.be/")>-1&&($scope.videoService.newVideoFormData.video_url=$scope.videoService.newVideoFormData.video_url.replace("https://youtu.be/","https://www.youtube.com/watch?v=")),$scope.videoService.newVideoFormData.video_embed&&$scope.videoService.newVideoFormData.video_embed.indexOf("https://youtu.be/")>-1&&($scope.videoService.newVideoFormData.video_embed=$scope.videoService.newVideoFormData.video_embed.replace("https://youtu.be/","https://www.youtube.com/watch?v="));var newVideoForm=new FormData;newVideoForm.append("name",$scope.videoService.newVideoFormData.name),newVideoForm.append("description",$scope.videoService.newVideoFormData.description),newVideoForm.append("video_url",$scope.videoService.newVideoFormData.video_url),newVideoForm.append("video_embed",$scope.videoService.newVideoFormData.video_embed),$scope.videoService.newVideoFormData.credit&&newVideoForm.append("credit",$scope.videoService.newVideoFormData.credit),$scope.videoService.newVideoFormData.video_thumbnail_image&&(newVideoForm.append("thumbnail_image",$scope.videoService.newVideoFormData.video_thumbnail_image),$scope.video_thumbnail_image=""),$scope.videoService.addNewVideo(newVideoForm).then(function(){$scope.videoService.getVideosByPage($scope.videoService.currentPage),$scope.videoService.newVideoFormData={}},function(){alert("There was an error adding this element. Please try again later."),$scope.imageService.getImagesByPage($scope.imageService.currentPage)}),document.getElementById("newVideoForm").reset(),$scope.videoService.videoViewToggle=!1},$scope.editVideo=function(video){var confirmSave=confirm("This will permanently alter this video/multimedia entry. Do you wish to proceed?");if(confirmSave){var updateVideoForm=new FormData;updateVideoForm.append("name",video.editName),updateVideoForm.append("description",video.editDescription),video.editCredit?updateVideoForm.append("credit",video.editCredit):updateVideoForm.append("credit",""),video.edit_video_thumbnail_image&&(updateVideoForm.append("thumbnail_image",video.edit_video_thumbnail_image),video.edit_video_thumbnail_image=""),$scope.videoService.editVideo(video.id,updateVideoForm).then(function(){$scope.videoService.getVideosByPage($scope.videoService.currentPage),$scope.mgService.getAllMediaGalleries()},function(){alert("There was an error saving your edits. Please try again later."),$scope.imageService.getImagesByPage($scope.imageService.currentPage)})}},$scope.deleteVideo=function(video){var confirmDelete=confirm("This will permanently delete this video/multimedia entry. Do you wish to proceed?");confirmDelete&&$scope.videoService.deleteVideo(video).then(function(){$scope.videoService.getVideosByPage($scope.videoService.currentPage),$scope.mgService.removeElementFromNewMg(video),$scope.mgService.getAllMediaGalleries()},function(){alert("There was an error deleting this element. Please try again later."),$scope.imageService.getImagesByPage($scope.imageService.currentPage)})},$scope.init()}]),angular.module("mediaExplorer.mg",["ui.bootstrap","ui.sortable","bootstrapLightbox"]),angular.module("mediaExplorer.mg").run(["$http",function($http){$http.defaults.headers.common["X-CSRFToken"]=getCookie("csrftoken")}]),angular.module("mediaExplorer.mg").directive("mgtab",function(){return{restrict:"E",controller:"MGController",scope:!0,replace:!0,transclude:!0,templateUrl:"/static/partials/media_explorer/mgtab.html"}}),angular.module("mediaExplorer.mg").directive("newmg",function(){return{restrict:"E",controller:"MGController",scope:!1,replace:!0,transclude:!0,templateUrl:"/static/partials/media_explorer/newmg.html"}}),angular.module("mediaExplorer.mg").filter("startFrom",function(){return function(input,start){return start=parseInt(start,10),start?input.slice(start):input}}),angular.module("mediaExplorer.mg").service("MG",function MG($http,$q){var MG=this;return MG.mgList={},MG.newMG={},MG.stats={},MG.mgViewToggle=!1,MG.currentPage=1,MG.userPageSizes=[{size:5},{size:10},{size:25},{size:50}],MG.userPageSizeSelection=MG.userPageSizes[0].size,MG.oldServerPage=1,MG.newServerPage=1,MG.sort_by="created_at",MG.direction="desc",MG.filter="",MG.searchTerm="",MG.getMGStats=function(){var defer=$q.defer();return $http.get("/api/stats/galleries&filter="+MG.filter).success(function(res){MG.stats=res,defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},MG.changePage=function(page){MG.oldServerPage=MG.newServerPage,MG.currentPage=page,MG.newServerPage=Math.ceil(MG.currentPage*MG.userPageSizeSelection/MG.stats.page_size)},MG.getFirst=function(){MG.changePage(1),MG.getMGByPage()},MG.getPrevious=function(){MG.changePage(MG.currentPage-1),MG.oldServerPage!=MG.newServerPage&&MG.getMGByPage()},MG.getNext=function(){MG.changePage(MG.currentPage+1),MG.oldServerPage!=MG.newServerPage&&MG.getMGByPage()},MG.getLast=function(){MG.changePage(MG.getTotalUserPages()),MG.getMGByPage()},MG.getTotalUserPages=function(){return Math.ceil(MG.stats.total_entries/MG.userPageSizeSelection)},MG.changeDirection=function(sort_by){MG.direction=MG.sort_by!=sort_by?"created_at"==sort_by?"desc":"asc":"desc"==MG.direction?"asc":"desc"},MG.sort=function(sort_by){MG.changeDirection(sort_by),MG.sort_by=sort_by,MG.changePage(1),MG.getMGByPage()},MG.search=function(filter){MG.filter=filter,MG.changePage(1),MG.getMGByPage()},MG.getMGByPage=function(page,sort_by,direction,filter){page=page||MG.currentPage,sort_by=sort_by||MG.sort_by,direction=direction||MG.direction,filter=filter||MG.filter,page!=MG.currentPage&&(MG.currentPage=page),sort_by!=MG.sort_by&&(MG.sort_by=sort_by),direction!=MG.direction&&(MG.direction=direction),filter!=MG.filter&&(MG.filter=filter);var defer=$q.defer();return $http.get("/api/media/galleries?page="+MG.newServerPage+"&sort="+MG.sort_by+"&direction="+MG.direction+"&filter="+MG.filter).success(function(res){MG.getMGStats(),MG.mgList=res,defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},MG.addNewMediaGallery=function(form){var defer=$q.defer();return $http.post("/api/media/galleries",form,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(res){defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},MG.editMediaGallery=function(form){var defer=$q.defer();return $http.put("/api/media/galleries/"+MG.newMG.editGalleryID,form,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(res){defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},MG.deleteMediaGallery=function(id){var defer=$q.defer();return $http["delete"]("/api/media/galleries/"+id).success(function(res){defer.resolve(res)}).error(function(err){defer.reject(err)}),defer.promise},MG.resetNewMG=function(){MG.newMG.name="",MG.newMG.description="",MG.newMG.elements=[],MG.newMG.element_id=[],MG.newMG.isEdit=!1,MG.newMG.editGalleryID=null},MG.loadMG=function(gallery,isDuplicate){isDuplicate||(MG.newMG.isEdit=!0,MG.newMG.editGalleryID=gallery.id),isDuplicate?(MG.newMG.name=gallery.name+" (DUPLICATE)",MG.newMG.description=gallery.description+" (DUPLICATE)"):(MG.newMG.name=gallery.name,MG.newMG.description=gallery.description),MG.newMG.elements=[],MG.newMG.element_id=[];for(var i=0;i<gallery.elements.length;i++){var newMGElement=gallery.elements[i];newMGElement.editDescription=newMGElement.description,newMGElement.mgDescription=newMGElement.description,newMGElement.editCredit=newMGElement.credit,newMGElement.mgCredit=newMGElement.credit,MG.newMG.elements.push(newMGElement),MG.newMG.element_id.push(newMGElement.id)}},MG.addElementToNewMG=function(element){MG.newMG.element_id.push(element.id),MG.newMG.elements.push(element);var elementIndex=MG.newMG.element_id.indexOf(element.id);MG.newMG.elements[elementIndex].editDescription=MG.newMG.elements[elementIndex].description,MG.newMG.elements[elementIndex].mgDescription=MG.newMG.elements[elementIndex].description,MG.newMG.elements[elementIndex].editCredit=MG.newMG.elements[elementIndex].credit,MG.newMG.elements[elementIndex].mgCredit=MG.newMG.elements[elementIndex].credit},MG.removeElementFromNewMg=function(element){var elementIndex=MG.newMG.element_id.indexOf(element.id);elementIndex>-1&&(MG.newMG.element_id.splice(elementIndex,1),MG.newMG.elements.splice(elementIndex,1))},MG.updateElementInNewMG=function(element){var elementIndex=MG.newMG.element_id.indexOf(element.id);elementIndex>-1&&(element.editDescription&&(MG.newMG.elements[elementIndex].mgDescription=element.editDescription),element.editCredit&&(MG.newMG.elements[elementIndex].mgCredit=element.editCredit))},MG}),angular.module("mediaExplorer.mg").controller("MGController",["$scope","ActiveTab","MG","Lightbox",function($scope,ActiveTab,MG,Lightbox){$scope.init=function(){$scope.mgService=MG,$scope.mgService.getMGStats(),$scope.mgService.getMGByPage($scope.mgService.currentPage),$scope.mgService.resetNewMG(),$scope.currentActiveTab=ActiveTab,$scope.disableInsert=disableInsertion()},$scope.ieAlert=function(){alert("Sorry! Django Media Explorer is read-only in older browsers. Consider upgrading to a modern alternative.")},$scope.insertMG=function(mg){opener.MediaExplorer.insert(mg),window.close()},$scope.openLightbox=function(orderedList,index){Lightbox.openModal(orderedList,index)},$scope.sortableOptions={placeholder:"sortable-placeholder",forceHelperSize:!0,change:function(){mgChangeState(!0)}},$scope.deleteMG=function(gallery){var confirmDelete=confirm("This will permanently delete this media gallery entry. Do you wish to proceed?");confirmDelete&&$scope.mgService.deleteMediaGallery(gallery.id).then(function(){$scope.mgService.getMGByPage($scope.mgService.currentPage)},function(){alert("There was a problem deleting this gallery. Please try again later."),$scope.mgService.getMGByPage($scope.mgService.currentPage)})},$scope.cancelGalleryCreation=function(){
var confirmCancel=confirm("All unsaved changes will be permanently deleted. Do you wish to proceed?");confirmCancel&&($scope.mgService.resetNewMG(),$scope.mgService.mgViewToggle=!1,mgChangeState(!1))},$scope.loadMediaGallery=function(gallery,isDuplicate){if(isDuplicate)$scope.mgService.mgViewToggle=!$scope.mgService.mgViewToggle,$scope.mgService.loadMG(gallery,isDuplicate);else{var confirmLoad=confirm("This will edit the existing media gallery. Do you wish to proceed?");confirmLoad&&($scope.mgService.mgViewToggle=!$scope.mgService.mgViewToggle,$scope.mgService.loadMG(gallery,isDuplicate))}},$scope.addNewMG=function(){var newMGForm=new FormData;newMGForm.append("name",$scope.mgService.newMG.name),newMGForm.append("description",$scope.mgService.newMG.description),$scope.mgService.newMG.element_id=[];for(var i=0;i<$scope.mgService.newMG.elements.length;i++)$scope.mgService.newMG.element_id.push($scope.mgService.newMG.elements[i].id),$scope.mgService.newMG.elements[i].mgDescription?newMGForm.append("element_description",$scope.mgService.newMG.elements[i].mgDescription):newMGForm.append("element_description",""),$scope.mgService.newMG.elements[i].mgCredit?newMGForm.append("element_credit",$scope.mgService.newMG.elements[i].mgCredit):newMGForm.append("element_credit","");for(var i=0;i<$scope.mgService.newMG.element_id.length;i++)newMGForm.append("element_id",$scope.mgService.newMG.element_id[i]);$scope.mgService.newMG.isEdit?$scope.mgService.editMediaGallery(newMGForm).then(function(){alert("Media Gallery save success!"),$scope.mgService.getMGByPage($scope.mgService.currentPage),$scope.mgService.resetNewMG(),$scope.mgService.mgViewToggle=!1,mgChangeState(!1)},function(){alert("There was a problem saving your gallery.")}):$scope.mgService.addNewMediaGallery(newMGForm).then(function(){alert("Media Gallery save success!"),$scope.mgService.getMGByPage($scope.mgService.currentPage),$scope.mgService.resetNewMG(),$scope.mgService.mgViewToggle=!1,mgChangeState(!1)},function(){alert("There was a problem saving your gallery.")})},$scope.addElementToNewMG=function(element){$scope.mgService.newMG.element_id.indexOf(element.id)>-1?alert("Element already in gallery! Elements cannot be added more than once."):(mgChangeState(!0),$scope.mgService.addElementToNewMG(element))},$scope.removeElementFromNewMg=function(element){mgChangeState(!0),$scope.mgService.removeElementFromNewMg(element)},$scope.updateElementInNewMG=function(element){mgChangeState(!0),$scope.mgService.updateElementInNewMG(element)},$scope.init()}]);