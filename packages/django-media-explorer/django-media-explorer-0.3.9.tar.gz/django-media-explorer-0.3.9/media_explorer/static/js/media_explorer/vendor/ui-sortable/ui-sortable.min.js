angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(e,t,n){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"="},link:function(r,i,a,o){function l(e,t){return t&&"function"==typeof t?function(){e.apply(this,arguments),t.apply(this,arguments)}:e}function s(e){var t=e.data("ui-sortable");return t&&"object"==typeof t&&"ui-sortable"===t.widgetFullName?t:null}function c(e,t){var n=e.sortable("option","helper");return"clone"===n||"function"==typeof n&&t.item.sortable.isCustomHelperUsed()}function u(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}function d(e,t){for(var n=null,r=0;r<e.length;r++){var i=e[r];if(i.element[0]===t[0]){n=i.scope;break}}return n}function p(e,t){t.item.sortable._destroy()}var f,m={},g={"ui-floating":void 0},h={receive:null,remove:null,start:null,stop:null,update:null},b={helper:null};return angular.extend(m,g,e,r.uiSortable),angular.element.fn&&angular.element.fn.jquery?(o?(r.$watch("ngModel.length",function(){t(function(){s(i)&&i.sortable("refresh")},0,!1)}),h.start=function(e,t){if("auto"===m["ui-floating"]){var n=t.item.siblings(),r=s(angular.element(e.target));r.floating=u(n)}t.item.sortable={model:o.$modelValue[t.item.index()],index:t.item.index(),source:t.item.parent(),sourceModel:o.$modelValue,cancel:function(){t.item.sortable._isCanceled=!0},isCanceled:function(){return t.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!t.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:t.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(t.item.sortable,function(e,n){t.item.sortable[n]=void 0})}}},h.activate=function(e,t){f=i.contents();var n=i.sortable("option","placeholder");if(n&&n.element&&"function"==typeof n.element){var a=n.element();a=angular.element(a);var o=i.find('[class="'+a.attr("class")+'"]:not([ng-repeat], [data-ng-repeat])');f=f.not(o)}var l=t.item.sortable._connectedSortables||[];l.push({element:i,scope:r}),t.item.sortable._connectedSortables=l},h.update=function(e,t){if(!t.item.sortable.received){t.item.sortable.dropindex=t.item.index();var n=t.item.parent();t.item.sortable.droptarget=n;var a=d(t.item.sortable._connectedSortables,n);t.item.sortable.droptargetModel=a.ngModel,i.sortable("cancel")}c(i,t)&&!t.item.sortable.received&&"parent"===i.sortable("option","appendTo")&&(f=f.not(f.last())),f.appendTo(i),t.item.sortable.received&&(f=null),t.item.sortable.received&&!t.item.sortable.isCanceled()&&r.$apply(function(){o.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)})},h.stop=function(e,t){!t.item.sortable.received&&"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()?r.$apply(function(){o.$modelValue.splice(t.item.sortable.dropindex,0,o.$modelValue.splice(t.item.sortable.index,1)[0])}):"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()||c(i,t)||f.appendTo(i),f=null},h.receive=function(e,t){t.item.sortable.received=!0},h.remove=function(e,t){"dropindex"in t.item.sortable||(i.sortable("cancel"),t.item.sortable.cancel()),t.item.sortable.isCanceled()||r.$apply(function(){t.item.sortable.moved=o.$modelValue.splice(t.item.sortable.index,1)[0]})},b.helper=function(e){return e&&"function"==typeof e?function(t,n){var r=e.apply(this,arguments);return n.sortable._isCustomHelperUsed=n!==r,r}:e},r.$watch("uiSortable",function(e){var t=s(i);t&&angular.forEach(e,function(e,n){return n in g?("ui-floating"!==n||e!==!1&&e!==!0||(t.floating=e),void(m[n]=e)):(h[n]?("stop"===n&&(e=l(e,function(){r.$apply()}),e=l(e,p)),e=l(h[n],e)):b[n]&&(e=b[n](e)),m[n]=e,void i.sortable("option",n,e))})},!0),angular.forEach(h,function(e,t){m[t]=l(e,m[t]),"stop"===t&&(m[t]=l(m[t],p))})):n.info("ui.sortable: ngModel not provided!",i),void i.sortable(m)):void n.error("ui.sortable: jQuery should be included before AngularJS!")}}}]);