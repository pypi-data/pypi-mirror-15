.\" Man page generated from reStructuredText.
.
.TH "CDIST-TROUBLESHOOTING" "7" "May 27, 2016" "4.1.0dp" "cdist"
.SH NAME
cdist-troubleshooting \- 
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.sp
Common problems and their solutions
.sp
Nico Schottelius <\fI\%nico\-cdist\-\-@\-\-schottelius.org\fP>
.SH ERROR IN MANIFEST IS NOT CONSIDERED AN ERROR BY CDIST
.sp
Situation: You are executing other scripts from a manifest.
This script fails, but cdist does not recognise the error.
An example script would be something like this:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
% cat ~/.cdist/manifest/init
"$__manifest/special"
% cat ~/.cdist/manifest/special
#!/bin/sh
echo "Here is an unclean exiting script"
somecommandthatdoesnotexist
echo "I continue here although previous command failed"
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
We can clearly see that \fBsomecommandthatdoesnotexist\fP
will fail in ~/.cdist/manifest/special. But as the custom
script is not called with the \-e flag (exit on failure) of shell,
it does not lead to an error. And thus cdist sees the exit 0
code of the last echo line instead of the failing command.
.sp
All scripts executed by cdist carry the \-e flag.
To prevent the above from happening, there are three solutions available,
two of which can be used in the calling script:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
# Execute as before, but abort on failure
sh \-e "$__manifest/special"

# Source the script in our namespace, runs in a set \-e environment:
\&. "$__manifest/special"
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
The third solution is to include a shebang header in every script
you write to use the \-e flag:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
% cat ~/.cdist/manifest/special
#!/bin/sh \-e
\&...
.ft P
.fi
.UNINDENT
.UNINDENT
.SH SEE ALSO
.INDENT 0.0
.IP \(bu 2
\fI\%cdist(1)\fP
.IP \(bu 2
\fI\%cdist\-tutorial(7)\fP
.UNINDENT
.SH COPYING
.sp
Copyright (C) 2013 Nico Schottelius. Free use of this software is
granted under the terms of the GNU General Public License version 3 (GPLv3).
.\" Generated by docutils manpage writer.
.
