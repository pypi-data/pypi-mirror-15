'use strict';function pong(){function X(e,l,m){"undefined"==typeof l&&(l=e,e=0);"undefined"==typeof m&&(m=1);if(0<m&&e>=l||0>m&&e<=l)return[];for(var h=[];0<m?e<l:e>l;e+=m)h.push(e);return h}function T(e){if(null==e||"object"==typeof e)return e;var l={},m;for(m in obj)e.hasOwnProperty(m)&&(l[m]=e[m]);return l}function Y(e){if(null==e||"object"==typeof e)return e;var l={},m;for(m in obj)e.hasOwnProperty(m)&&(l[m]=Y(e[m]));return l}function H(e){return e?[].slice.apply(e):[]}function y(e){e=e?[].slice.apply(e):
[];e.__class__=y;return e}function D(e){var l=[];if(e)for(var m=0;m<e.length;m++)l.add(e[m]);l.__class__=D;return l}function Z(){var e=[],l;for(l in this)M(l)||e.push(l);return e}function aa(){var e=[],l;for(l in this)M(l)||e.push([l,this[l]]);return e}function ba(e){delete this[e]}function C(e){if(!e||e instanceof Array){var l={};if(e)for(var m=0;m<e.length;m++){var h=e[m];l[h[0]]=h[1]}}else l=e;Object.defineProperty(l,"__class__",{value:C,enumerable:!1,writable:!0});Object.defineProperty(l,"py_keys",
{value:Z,enumerable:!1});Object.defineProperty(l,"py_items",{value:aa,enumerable:!1});Object.defineProperty(l,"py_del",{value:ba,enumerable:!1});return l}function K(e){try{return e.__str__()}catch(l){return new String(e)}}var n={},L=function(e,l,m){if(""!=l){l=l.split(".");for(var h=l.length,t=0;t<l.length;t++){if(!e.hasOwnProperty(l[t])){h=t;break}e=e[l[t]]}for(t=h;t<l.length;t++)e[l[t]]={},e=e[l[t]]}for(var d in m)e[d]=m[d]};n.__nest__=L;var Q=function(e){e.__inited__||(e.__all__.__init__(e.__all__),
e.__inited__=!0);return e.__all__};n.__init__=Q;var q=function(e,l,m){return e&&(e.hasOwnProperty("__class__")||"string"==typeof e||e instanceof String)?(m&&Object.defineProperty(e,m,{value:function(){var h=[].slice.apply(arguments);return l.apply(null,[e].concat(h))},writable:!0,enumerable:!0,configurable:!0}),function(){var h=[].slice.apply(arguments);return l.apply(null,[e].concat(h))}):l};n.__get__=q;var F=function(e,l,m){for(var h=function(){var a=[].slice.apply(arguments);return h.__new__(a)},
t=l.length-1;0<=t;t--){var d=l[t],k;for(k in d){var c=Object.getOwnPropertyDescriptor(d,k);Object.defineProperty(h,k,c)}}h.__name__=e;h.__bases__=l;for(k in m)c=Object.getOwnPropertyDescriptor(m,k),Object.defineProperty(h,k,c);return h};n.__class__=F;var N=n.__class__("object",[],{__init__:function(e){},__name__:"object",__bases__:[],__new__:function(e){var l=Object.create(this,{__class__:{value:this,enumerable:!0}});this.__init__.apply(null,[l].concat(e));return l}});n.object=N;n.__pragma__=function(){};
L(n,"org.transcrypt.__base__",{__all__:{__inited__:!1,__init__:function(e){var l=F("__Envir__",[N],{get __init__(){return q(this,function(h){h.transpiler_name="transcrypt";h.transpiler_version="3.5.156";h.target_subdir="__javascript__"})}}),m=l();e.__Envir__=l;e.__envir__=m}}});L(n,"org.transcrypt.__standard__",{__all__:{__inited__:!1,__init__:function(e){var l=F("Exception",[N],{get __init__(){return q(this,function(h){var d=y([].slice.apply(arguments).slice(1));h.args=d})},get __repr__(){return q(this,
function(h){return O(h.args)?"{}{}".format(h.__class__.__name__,ca(y(h.args))):"???"})},get __str__(){return q(this,function(h){return 1<O(h.args)?K(y(h.args)):O(h.args)?K(h.args[0]):"???"})}}),m=F("ValueError",[l],{}),h=function(h,d,k){if("undefined"==typeof d||null!=d&&d.__class__==u)d=null;if("undefined"==typeof k||null!=k&&k.__class__==u)k=!1;if(arguments.length){var c=arguments.length-1;if(arguments[c]&&arguments[c].__class__==u){var c=arguments[c--],a;for(a in c)switch(a){case "iterable":h=
c[a];break;case "key":d=c[a];break;case "reverse":k=c[a]}}}d?h.sort(function(a,g){if(arguments.length){var f=arguments.length-1;if(arguments[f]&&arguments[f].__class__==u){var f=arguments[f--],c;for(c in f)switch(c){case "a":a=f[c];break;case "b":g=f[c]}}}return d(a)>d(g)}):h.sort();k&&h.reverse()};e.Exception=l;e.ValueError=m;e.__sort__=h;e.sorted=function(e,d,k){if("undefined"==typeof d||null!=d&&d.__class__==u)d=null;if("undefined"==typeof k||null!=k&&k.__class__==u)k=!1;if(arguments.length){var c=
arguments.length-1;if(arguments[c]&&arguments[c].__class__==u){var c=arguments[c--],a;for(a in c)switch(a){case "iterable":e=c[a];break;case "key":d=c[a];break;case "reverse":k=c[a]}}}a=U(e)==C?T(e.py_keys()):T(e);h(a,d,k);return a}}}});L(n,"",Q(n.org.transcrypt.__base__));var da=n.__envir__;L(n,"",Q(n.org.transcrypt.__standard__));var ga=n.__sort__;da.executor_name=da.transpiler_name;n.main={__file__:""};n.__except__=null;var u=function(e){e.__class__=u;e.constructor=Object;return e};n.___kwargdict__=
u;n.property=function(e,l){l||(l=function(){});return{get:function(){return e(this)},set:function(e){l(this,e)},enumerable:!0}};n.__merge__=function(e,l){var m={},h;for(h in e)m[h]=e[h];for(h in l)m[h]=l[h];return m};var ea=function(){for(var e=[].slice.apply(arguments),l="",m=0;m<e.length;m++)l+=K(e[m])+" ";console.log(l)};n.print=ea;console.log.apply=function(){ea([].slice.apply(arguments).slice(1))};var J=function(e,l){return U(l)==C?-1<l.py_keys().indexOf(e):-1<l.indexOf(e)};n.__in__=J;var M=
function(e){return e.startswith("__")&&e.endswith("__")||"constructor"==e||e.startswith("py_")};n.__specialattrib__=M;var O=function(e){try{return e.length}catch(m){var l=0;for(attrib in e)M(attrib)||l++;return l}};n.len=O;var fa={__name__:"bool"};n.bool=fa;var R=function(e){if(isNaN(e))throw"ValueError";return+e};R.__name__="float";n.float=R;var V=function(e){return R(e)|0};V.__name__="int";n.int=V;var U=function(e){try{return e.__class__}catch(m){var l=typeof e;return"boolean"==l?fa:"number"==l?
0==e%1?V:R:l}};n.type=U;n.isinstance=function(e,l){function m(h){if(h==l)return!0;for(var e=0;e<h.__bases__.length;e++)if(m(h.__bases__[e],l))return!0;return!1}return m(e.__class__)};var ca=function(e){try{return e.__repr__()}catch(d){try{return e.__str__()}catch(k){try{if(e.constructor==Object){var l="{",m=!1,h;for(h in e)if(!M(h)){var t=h.isnumeric()?h:"'"+h+"'";m?l+=", ":m=!0;try{l+=t+": "+e[h].__repr__()}catch(c){l+=t+": "+e[h].toString()}}return l+"}"}return"boolean"==typeof e?e.toString().capitalize():
e.toString()}catch(c){return console.log("ERROR: Could not evaluate repr (<object of type "+typeof e+">)"),"???"}}}};n.repr=ca;n.chr=function(e){return String.fromCharCode(e)};var P=function(e){return e.charCodeAt(0)};n.org=P;var S=function(){var e=[].slice.call(arguments);return(0==e.length?[]:e.reduce(function(e,m){return e.length<m.length?e:m})).map(function(l,m){return e.map(function(h){return h[m]})})};n.zip=S;n.range=X;n.enumerate=function(e){return S(X(O(e)),e)};n.copy=T;n.deepcopy=Y;n.list=
H;Array.prototype.__class__=H;H.__name__="list";Array.prototype.__getslice__=function(e,l,m){0>e&&(e=this.length+e);null==l?l=this.length:0>l&&(l=this.length+l);for(var h=H([]);e<l;e+=m)h.push(this[e]);return h};Array.prototype.__setslice__=function(e,l,m,h){0>e&&(e=this.length+e);null==l?l=this.length:0>l&&(l=this.length+l);if(null==m)Array.prototype.splice.apply(this,[e,l-e].concat(h));else for(var t=0;e<l;e+=m)this[e]=h[t++]};Array.prototype.__repr__=function(){if(this.__class__==D&&!this.length)return"set()";
for(var e=this.__class__&&this.__class__!=H?this.__class__==y?"(":"{":"[",l=0;l<this.length;l++){l&&(e+=", ");try{e+=this[l].__repr__()}catch(m){e+=this[l].toString()}}this.__class__==y&&1==this.length&&(e+=",");return e+=this.__class__&&this.__class__!=H?this.__class__==y?")":"}":"]"};Array.prototype.__str__=Array.prototype.__repr__;Array.prototype.append=function(e){this.push(e)};Array.prototype.clear=function(){this.length=0};Array.prototype.extend=function(e){this.push.apply(this,e)};Array.prototype.insert=
function(e,l){this.splice(e,0,l)};Array.prototype.remove=function(e){e=this.indexOf(e);if(-1==e)throw"KeyError";this.splice(e,1)};Array.prototype.index=function(e){return this.indexOf(e)};Array.prototype.py_pop=function(e){return void 0==e?this.pop():this.splice(e,1)[0]};Array.prototype.py_sort=function(){ga.apply(null,[this].concat([].slice.apply(arguments)))};n.tuple=y;y.__name__="tuple";n.set=D;D.__name__="set";Array.prototype.__bindexOf__=function(e){e+="";for(var l=0,m=this.length-1;l<=m;){var h=
(l+m)/2|0,t=this[h]+"";if(t<e)l=h+1;else if(t>e)m=h-1;else return h}return-1};Array.prototype.add=function(e){-1==this.indexOf(e)&&this.push(e)};Array.prototype.discard=function(e){e=this.indexOf(e);-1!=e&&this.splice(e,1)};Array.prototype.isdisjoint=function(e){this.sort();for(var l=0;l<e.length;l++)if(-1!=this.__bindexOf__(e[l]))return!1;return!0};Array.prototype.issuperset=function(e){this.sort();for(var l=0;l<e.length;l++)if(-1==this.__bindexOf__(e[l]))return!1;return!0};Array.prototype.issubset=
function(e){return D(e.slice()).issuperset(this)};Array.prototype.union=function(e){for(var l=D(this.slice().sort()),m=0;m<e.length;m++)-1==l.__bindexOf__(e[m])&&l.push(e[m]);return l};Array.prototype.intersection=function(e){this.sort();for(var l=D(),m=0;m<e.length;m++)-1!=this.__bindexOf__(e[m])&&l.push(e[m]);return l};Array.prototype.difference=function(e){e=D(e.slice().sort());for(var l=D(),m=0;m<this.length;m++)-1==e.__bindexOf__(this[m])&&l.push(this[m]);return l};Array.prototype.symmetric_difference=
function(e){return this.union(e).difference(this.intersection(e))};Array.prototype.update=function(){var e=[].concat.apply(this.slice(),arguments).sort();this.clear();for(var l=0;l<e.length;l++)e[l]!=e[l-1]&&this.push(e[l])};n.__keys__=Z;n.__items__=aa;n.__del__=ba;n.dict=C;C.__name__="dict";n.str=K;String.prototype.__class__=K;K.__name__="str";String.prototype.__repr__=function(){return(-1==this.indexOf("'")?"'"+this+"'":'"'+this+'"').replace("\n","\\n")};String.prototype.__str__=function(){return this};
String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.endswith=function(e){return""==e||this.slice(-e.length)==e};String.prototype.find=function(e,l){return this.indexOf(e,l)};Object.defineProperty(String.prototype,"format",{get:function(){return q(this,function(e){var l=y([].slice.apply(arguments).slice(1)),m=0;return e.replace(/\{(\w*)\}/g,function(h,e){""==e&&(e=m++);if(e==+e)return"undefined"==l[e]?h:l[e];for(var d=0;d<l.length;d++)if("object"==
typeof l[d]&&"undefined"!=typeof l[d][e])return l[d][e];return h})})},enumerable:!0});String.prototype.isnumeric=function(){return!isNaN(parseFloat(this))&&isFinite(this)};String.prototype.join=function(e){return e.join(this)};String.prototype.lower=function(){return this.toLowerCase()};String.prototype.py_replace=function(e,l,m){return this.split(e,m).join(l)};String.prototype.lstrip=function(){return this.replace(/^\s*/g,"")};String.prototype.rfind=function(e,l){return this.lastIndexOf(e,l)};String.prototype.rsplit=
function(e,l){var m=this.split(e||/s+/);return l?[m.slice(0,-l).join(e)].concat(m.slice(-l)):m};String.prototype.rstrip=function(){return this.replace(/\s*$/g,"")};String.prototype.py_split=function(e,l){e||(e=" ");return this.split(e||/s+/,l)};String.prototype.startswith=function(e){return 0==this.indexOf(e)};String.prototype.strip=function(){return this.trim()};String.prototype.upper=function(){return this.toUpperCase()};n.__neg__=function(e){return"object"==typeof e&&"__neg__"in e?e.__neg__():
-e};n.__matmul__=function(e,l){return e.__matmul__(l)};n.__mul__=function(e,l){return"object"==typeof e&&"__mul__"in e?e.__mul__(l):"object"==typeof l&&"__rmul__"in l?l.__rmul__(e):e*l};n.__div__=function(e,l){return"object"==typeof e&&"__div__"in e?e.__div__(l):"object"==typeof l&&"__rdiv__"in l?l.__rdiv__(e):e/l};n.__add__=function(e,l){return"object"==typeof e&&"__add__"in e?e.__add__(l):"object"==typeof l&&"__radd__"in l?l.__radd__(e):e+l};n.__sub__=function(e,l){return"object"==typeof e&&"__sub__"in
e?e.__sub__(l):"object"==typeof l&&"__rsub__"in l?l.__rsub__(e):e-l};n.__getitem__=function(e,l){return"object"==typeof e&&"__getitem__"in e?e.__getitem__(l):e[l]};n.__setitem__=function(e,l,m){"object"==typeof e&&"__setitem__"in e?e.__setitem__(l,m):e[l]=m};n.__getslice__=function(e,l,m,h){return"object"==typeof e&&"__getitem__"in e?e.__getitem__([l,m,h]):e.__getslice__(l,m,h)};n.__setslice__=function(e,l,m,h,t){"object"==typeof e&&"__setitem__"in e?e.__setitem__([l,m,h],t):e.__setslice__(l,m,h,
t)};n.__call__=function(){var e=[].slice.apply(arguments);return"object"==typeof e[0]&&"__call__"in e[0]?e[0].__call__.apply(null,e.slice(1)):e[0].apply(null,e.slice(1))};L(n,"com.fabricjs",{__all__:{__inited__:!1,__init__:function(e){var l=function(){var e={},h=h||{version:"1.5.0"};"undefined"!==typeof e&&(e.fabric=h);"undefined"!==typeof document&&"undefined"!==typeof window?(h.document=document,h.window=window,window.fabric=h):(h.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),
h.window=h.document.createWindow?h.document.createWindow():h.document.parentWindow);h.isTouchSupported="ontouchstart"in h.document.documentElement;h.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;h.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");h.DPI=96;h.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";(function(){function e(a,b){this.__eventListeners[a]&&
(b?h.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function d(a,b){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var g in a)this.on(g,a[g]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function k(a,b){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===typeof arguments[0])for(var g in a)e.call(this,g,a[g]);
else e.call(this,a,b);return this}}function c(a,b){if(this.__eventListeners){var g=this.__eventListeners[a];if(g){for(var f=0,c=g.length;f<c;f++)g[f].call(this,b||{});return this}}}h.Observable={observe:d,stopObserving:k,fire:c,on:d,off:k,trigger:c}})();h.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var e=0,d=arguments.length;e<d;e++)this._onObjectAdded(arguments[e]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(e,d,k){var c=this.getObjects();
k?c[d]=e:c.splice(d,0,e);this._onObjectAdded(e);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var e=this.getObjects(),d,k=0,c=arguments.length;k<c;k++)d=e.indexOf(arguments[k]),-1!==d&&(e.splice(d,1),this._onObjectRemoved(arguments[k]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(e,d){for(var k=this.getObjects(),c=k.length;c--;)e.call(d,k[c],c,k);return this},getObjects:function(e){return"undefined"===typeof e?this._objects:this._objects.filter(function(d){return d.type===
e})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(e){return-1<this.getObjects().indexOf(e)},complexity:function(){return this.getObjects().reduce(function(e,d){return e+=d.complexity?d.complexity():0},0)}};(function(e){var d=Math.sqrt,k=Math.atan2,c=Math.PI/180;h.util={removeFromArray:function(a,b){var g=a.indexOf(b);-1!==g&&a.splice(g,1);return a},getRandomInt:function(a,b){return Math.floor(Math.random()*
(b-a+1))+a},degreesToRadians:function(a){return a*c},radiansToDegrees:function(a){return a/c},rotatePoint:function(a,b,g){var f=Math.sin(g);g=Math.cos(g);a.subtractEquals(b);return(new h.Point(a.x*g-a.y*f,a.x*f+a.y*g)).addEquals(b)},transformPoint:function(a,b,g){return g?new h.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new h.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},invertTransform:function(a){var b=a.slice(),b=1/(a[0]*a[3]-a[1]*a[2]),b=[b*a[3],-b*a[1],-b*a[2],b*a[0],0,0];a=h.util.transformPoint({x:a[4],
y:a[5]},b);b[4]=-a.x;b[5]=-a.y;return b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var g=/\D{0,2}$/.exec(a),f=parseFloat(a);b||(b=h.Text.DEFAULT_SVG_FONT_SIZE);switch(g[0]){case "mm":return f*h.DPI/25.4;case "cm":return f*h.DPI/2.54;case "in":return f*h.DPI;case "pt":return f*h.DPI/72;case "pc":return f*h.DPI/72*12;case "em":return f*b;default:return f}},falseFunction:function(){return!1},getKlass:function(a,b){a=h.util.string.camelize(a.charAt(0).toUpperCase()+
a.slice(1));return h.util.resolveNamespace(b)[a]},resolveNamespace:function(a){if(!a)return h;a=a.split(".");for(var b=a.length,g=e||h.window,f=0;f<b;++f)g=g[a[f]];return g},loadImage:function(a,b,g,f){if(a){var c=h.util.createImage();c.onload=function(){b&&b.call(g,c);c=c.onload=c.onerror=null};c.onerror=function(){h.log("Error loading "+c.src);b&&b.call(g,null,!0);c=c.onload=c.onerror=null};0!==a.indexOf("data")&&"undefined"!==typeof f&&(c.crossOrigin=f);c.src=a}else b&&b.call(g,a)},enlivenObjects:function(a,
b,g,f){function c(){++k===e&&b&&b(d)}a=a||[];var d=[],k=0,e=a.length;e?a.forEach(function(a,b){if(a&&a.type){var k=h.util.getKlass(a.type,g);k.async?k.fromObject(a,function(g,k){k||(d[b]=g,f&&f(a,d[b]));c()}):(d[b]=k.fromObject(a),f&&f(a,d[b]),c())}else c()}):b&&b(d)},groupSVGElements:function(a,b,g){a=new h.PathGroup(a,b);"undefined"!==typeof g&&a.setSourcePath(g);return a},populateWithProperties:function(a,b,g){if(g&&"[object Array]"===Object.prototype.toString.call(g))for(var f=0,c=g.length;f<
c;f++)g[f]in a&&(b[g[f]]=a[g[f]])},drawDashedLine:function(a,b,g,f,c,w){f-=b;var e=c-g;c=d(f*f+e*e);f=k(e,f);var e=w.length,h=0,t=!0;a.save();a.translate(b,g);a.moveTo(0,0);a.rotate(f);for(b=0;c>b;)b+=w[h++%e],b>c&&(b=c),a[t?"lineTo":"moveTo"](b,0),t=!t;a.restore()},createCanvasElement:function(a){a||(a=h.document.createElement("canvas"));a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a);return a},createImage:function(){return h.isLikelyNode?new (require("canvas").Image):
h.document.createElement("img")},createAccessors:function(a){a=a.prototype;for(var b=a.stateProperties.length;b--;){var g=a.stateProperties[b],f=g.charAt(0).toUpperCase()+g.slice(1),c="set"+f,f="get"+f;a[f]||(a[f]=new Function('return this.get("'+g+'")'));a[c]||(a[c]=new Function("value",'return this.set("'+g+'", value)'))}},clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],
a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,g,f){0<f&&(b=b>f?b-f:0,g=g>f?g-f:0);var c=!0;a=a.getImageData(b,g,2*f||1,2*f||1);b=3;for(g=a.data.length;b<g&&(c=0>=a.data[b],!1!==c);b+=4);return c}}})("undefined"!==typeof e?e:this);(function(){function e(g,b,c,h,t,l,ha){var W=f.call(arguments);if(a[W])return a[W];var I=Math.PI,m=ha*I/180,E=Math.sin(m),m=Math.cos(m),
n=0,B=0;c=Math.abs(c);h=Math.abs(h);var r=-m*g*.5-E*b*.5,z=-m*b*.5+E*g*.5,q=c*c,x=h*h,G=z*z,v=r*r,u=q*x-q*G-x*v,y=0;0>u?(q=Math.sqrt(1-u/(q*x)),c*=q,h*=q):y=(t===l?-1:1)*Math.sqrt(u/(q*G+x*v));G=y*c*z/h;v=-y*h*r/c;y=m*G-E*v+.5*g;q=E*G+m*v+.5*b;x=k(1,0,(r-G)/c,(z-v)/h);z=k((r-G)/c,(z-v)/h,(-r-G)/c,(-z-v)/h);0===l&&0<z?z-=2*I:1===l&&0>z&&(z+=2*I);I=Math.ceil(Math.abs(z/I*2));r=[];z/=I;G=8/3*Math.sin(z/4)*Math.sin(z/4)/Math.sin(z/2);v=x+z;for(u=0;u<I;u++)r[u]=d(x,v,m,E,c,h,y,q,G,n,B),n=r[u][4],B=r[u][5],
x=v,v+=z;return a[W]=r}function d(g,a,c,d,k,e,h,t,l,m,E){var n=f.call(arguments);if(b[n])return b[n];var B=Math.cos(g),r=Math.sin(g),q=Math.cos(a),u=Math.sin(a),x=c*k*q-d*e*u+h,y=d*k*q+c*e*u+t;b[n]=[m+l*(-c*k*r-d*e*B),E+l*(-d*k*r+c*e*B),x+l*(c*k*u+d*e*q),y+l*(d*k*u-c*e*q),x,y];return b[n]}function k(g,f,a,b){g=Math.atan2(f,g);a=Math.atan2(b,a);return a>=g?a-g:2*Math.PI-(g-a)}function c(a,b,c,d,k,e,h,t){var l=f.call(arguments);if(g[l])return g[l];var m=Math.sqrt,E=Math.min,n=Math.max,B=Math.abs,r=
[],q=[[],[]],u,x,y,v,C;x=6*a-12*c+6*k;u=-3*a+9*c-9*k+3*h;y=3*c-3*a;for(var D=0;2>D;++D)0<D&&(x=6*b-12*d+6*e,u=-3*b+9*d-9*e+3*t,y=3*d-3*b),1E-12>B(u)?1E-12>B(x)||(v=-y/x,0<v&&1>v&&r.push(v)):(v=x*x-4*y*u,0>v||(C=m(v),v=(-x+C)/(2*u),0<v&&1>v&&r.push(v),v=(-x-C)/(2*u),0<v&&1>v&&r.push(v)));for(B=m=r.length;m--;)v=r[m],x=1-v,u=x*x*x*a+3*x*x*v*c+3*x*v*v*k+v*v*v*h,q[0][m]=u,u=x*x*x*b+3*x*x*v*d+3*x*v*v*e+v*v*v*t,q[1][m]=u;q[0][B]=a;q[1][B]=b;q[0][B+1]=h;q[1][B+1]=t;E=[{x:E.apply(null,q[0]),y:E.apply(null,
q[1])},{x:n.apply(null,q[0]),y:n.apply(null,q[1])}];return g[l]=E}var a={},b={},g={},f=Array.prototype.join;h.util.drawArc=function(g,f,a,b){var c=[[],[],[],[]];b=e(b[5]-f,b[6]-a,b[0],b[1],b[3],b[4],b[2]);for(var d=0,k=b.length;d<k;d++)c[d][0]=b[d][0]+f,c[d][1]=b[d][1]+a,c[d][2]=b[d][2]+f,c[d][3]=b[d][3]+a,c[d][4]=b[d][4]+f,c[d][5]=b[d][5]+a,g.bezierCurveTo.apply(g,c[d])};h.util.getBoundsOfArc=function(g,f,a,b,d,k,h,l,I){var m=0,n=0,q=[],B=[];a=e(l-g,I-f,a,b,k,h,d);b=[[],[]];d=0;for(k=a.length;d<
k;d++)q=c(m,n,a[d][0],a[d][1],a[d][2],a[d][3],a[d][4],a[d][5]),b[0].x=q[0].x+g,b[0].y=q[0].y+f,b[1].x=q[1].x+g,b[1].y=q[1].y+f,B.push(b[0]),B.push(b[1]),m=a[d][4],n=a[d][5];return B};h.util.getBoundsOfCurve=c})();(function(){function e(d,c,a){if(d&&0!==d.length){var b=d.length-1,g=c?d[b][c]:d[b];if(c)for(;b--;)a(d[b][c],g)&&(g=d[b][c]);else for(;b--;)a(d[b],g)&&(g=d[b]);return g}}var d=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(d){if(void 0===this||null===this)throw new TypeError;
var c=Object(this),a=c.length>>>0;if(0===a)return-1;var b=0;0<arguments.length&&(b=Number(arguments[1]),b!==b?b=0:0!==b&&b!==Number.POSITIVE_INFINITY&&b!==Number.NEGATIVE_INFINITY&&(b=(0<b||-1)*Math.floor(Math.abs(b))));if(b>=a)return-1;for(b=0<=b?b:Math.max(a-Math.abs(b),0);b<a;b++)if(b in c&&c[b]===d)return b;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(d,c){for(var a=0,b=this.length>>>0;a<b;a++)a in this&&d.call(c,this[a],a,this)});Array.prototype.map||(Array.prototype.map=
function(d,c){for(var a=[],b=0,g=this.length>>>0;b<g;b++)b in this&&(a[b]=d.call(c,this[b],b,this));return a});Array.prototype.every||(Array.prototype.every=function(d,c){for(var a=0,b=this.length>>>0;a<b;a++)if(a in this&&!d.call(c,this[a],a,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(d,c){for(var a=0,b=this.length>>>0;a<b;a++)if(a in this&&d.call(c,this[a],a,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(d,c){for(var a=[],b,
g=0,f=this.length>>>0;g<f;g++)g in this&&(b=this[g],d.call(c,b,g,this)&&a.push(b));return a});Array.prototype.reduce||(Array.prototype.reduce=function(d){var c=this.length>>>0,a=0,b;if(1<arguments.length)b=arguments[1];else{do{if(a in this){b=this[a++];break}if(++a>=c)throw new TypeError;}while(1)}for(;a<c;a++)a in this&&(b=d.call(null,b,this[a],a,this));return b});h.util.array={invoke:function(k,c){for(var a=d.call(arguments,2),b=[],g=0,f=k.length;g<f;g++)b[g]=a.length?k[g][c].apply(k[g],a):k[g][c].call(k[g]);
return b},min:function(d,c){return e(d,c,function(a,b){return a<b})},max:function(d,c){return e(d,c,function(a,b){return a>=b})}}})();(function(){function e(d,k){for(var c in k)d[c]=k[c];return d}h.util.object={extend:e,clone:function(d){return e({},d)}}})();(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});h.util.string={camelize:function(e){return e.replace(/-+(.)?/g,function(d,k){return k?k.toUpperCase():""})},capitalize:function(e,
d){return e.charAt(0).toUpperCase()+(d?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var e=Array.prototype.slice,d=Function.prototype.apply,k=function(){};Function.prototype.bind||(Function.prototype.bind=function(c){var a=this,b=e.call(arguments,1),g;g=b.length?function(){return d.call(a,this instanceof k?this:c,b.concat(e.call(arguments)))}:function(){return d.call(a,
this instanceof k?this:c,arguments)};k.prototype=this.prototype;g.prototype=new k;return g})})();(function(){function e(){}function d(g){var f=this.constructor.superclass.prototype[g];return 1<arguments.length?f.apply(this,k.call(arguments,1)):f.call(this)}var k=Array.prototype.slice,c=function(){},a=function(){for(var g in{toString:1})if("toString"===g)return!1;return!0}(),b=function(g,f,b){for(var c in f)c in g.prototype&&"function"===typeof g.prototype[c]&&-1<(f[c]+"").indexOf("callSuper")?g.prototype[c]=
function(g){return function(){var a=this.constructor.superclass;this.constructor.superclass=b;var c=f[g].apply(this,arguments);this.constructor.superclass=a;if("initialize"!==g)return c}}(c):g.prototype[c]=f[c],a&&(f.toString!==Object.prototype.toString&&(g.prototype.toString=f.toString),f.valueOf!==Object.prototype.valueOf&&(g.prototype.valueOf=f.valueOf))};h.util.createClass=function(){function g(){this.initialize.apply(this,arguments)}var f=null,a=k.call(arguments,0);"function"===typeof a[0]&&
(f=a.shift());g.superclass=f;g.subclasses=[];f&&(e.prototype=f.prototype,g.prototype=new e,f.subclasses.push(g));for(var h=0,A=a.length;h<A;h++)b(g,a[h],f);g.prototype.initialize||(g.prototype.initialize=c);g.prototype.constructor=g;g.prototype.callSuper=d;return g}})();(function(){function e(g){var f=Array.prototype.slice.call(arguments,1),a,b,c=f.length;for(b=0;b<c;b++)if(a=typeof g[f[b]],!/^(?:function|object|unknown)$/.test(a))return!1;return!0}function d(g,f){return function(b){f.call(a(g),b||
h.window.event)}}function k(g,f){return function(a){if(A[g]&&A[g][f])for(var b=A[g][f],c=0,d=b.length;c<d;c++)b[c].call(this,a||h.window.event)}}function c(g,f,a){var b="touchend"===g.type?"changedTouches":"touches";return g[b]&&g[b][0]?g[b][0][f]-(g[b][0][f]-g[b][0][a])||g[a]:g[a]}var a,b,g=function(){var g=0;return function(f){return f.__uniqueID||(f.__uniqueID="uniqueID__"+g++)}}();(function(){var g={};a=function(f){return g[f]};b=function(f,a){g[f]=a}})();var f=e(h.document.documentElement,"addEventListener",
"removeEventListener")&&e(h.window,"addEventListener","removeEventListener"),p=e(h.document.documentElement,"attachEvent","detachEvent")&&e(h.window,"attachEvent","detachEvent"),w={},A={};f?(f=function(g,f,a){g.addEventListener(f,a,!1)},p=function(g,f,a){g.removeEventListener(f,a,!1)}):p?(f=function(f,a,c){var k=g(f);b(k,f);w[k]||(w[k]={});w[k][a]||(w[k][a]=[]);c={handler:c,wrappedHandler:d(k,c)};w[k][a].push(c);f.attachEvent("on"+a,c.wrappedHandler)},p=function(f,a,b){var c=g(f),d;if(w[c]&&w[c][a])for(var k=
0,p=w[c][a].length;k<p;k++)(d=w[c][a][k])&&d.handler===b&&(f.detachEvent("on"+a,d.wrappedHandler),w[c][a][k]=null)}):(f=function(f,a,b){var c=g(f);A[c]||(A[c]={});if(!A[c][a]){A[c][a]=[];var d=f["on"+a];d&&A[c][a].push(d);f["on"+a]=k(c,a)}A[c][a].push(b)},p=function(f,a,b){f=g(f);if(A[f]&&A[f][a]){a=A[f][a];f=0;for(var c=a.length;f<c;f++)a[f]===b&&a.splice(f,1)}});h.util.addListener=f;h.util.removeListener=p;var l=function(g){return"unknown"!==typeof g.clientX?g.clientX:0},m=function(g){return"unknown"!==
typeof g.clientY?g.clientY:0};h.isTouchSupported&&(l=function(g){return c(g,"pageX","clientX")},m=function(g){return c(g,"pageY","clientY")});h.util.getPointer=function(g,f){g||(g=h.window.event);var a=h.util.getScrollLeftTop(g.target||("unknown"!==typeof g.srcElement?g.srcElement:null),f);return{x:l(g)+a.left,y:m(g)+a.top}};h.util.object.extend(h.util,h.Observable)})();(function(){var e=h.document.createElement("div"),d="string"===typeof e.style.filter,k=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=
function(a){return a};"string"===typeof e.style.opacity?c=function(a,b){a.style.opacity=b;return a}:d&&(c=function(a,b){var g=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(g.zoom=1);k.test(g.filter)?g.filter=g.filter.replace(k,.9999<=b?"":"alpha(opacity="+100*b+")"):g.filter+=" alpha(opacity="+100*b+")";return a});h.util.setStyle=function(a,b){var g=a.style;if(!g)return a;if("string"===typeof b)return a.style.cssText+=";"+b,-1<b.indexOf("opacity")?c(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;
for(var f in b)"opacity"===f?c(a,b[f]):g["float"===f||"cssFloat"===f?"undefined"===typeof g.styleFloat?"cssFloat":"styleFloat":f]=b[f];return a}})();(function(){function e(a,g){var f=h.document.createElement(a),c;for(c in g)"class"===c?f.className=g[c]:"for"===c?f.htmlFor=g[c]:f.setAttribute(c,g[c]);return f}var d=Array.prototype.slice,k,c=function(a){return d.call(a,0)};try{k=c(h.document.childNodes)instanceof Array}catch(b){}k||(c=function(a){for(var g=Array(a.length),f=a.length;f--;)g[f]=a[f];
return g});var a;a=h.document.defaultView&&h.document.defaultView.getComputedStyle?function(a,g){var f=h.document.defaultView.getComputedStyle(a,null);return f?f[g]:void 0}:function(a,g){var f=a.style[g];!f&&a.currentStyle&&(f=a.currentStyle[g]);return f};(function(){var a=h.document.documentElement.style,g="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";h.util.makeElementUnselectable=function(f){"undefined"!==
typeof f.onselectstart&&(f.onselectstart=h.util.falseFunction);g?f.style[g]="none":"string"===typeof f.unselectable&&(f.unselectable="on");return f};h.util.makeElementSelectable=function(f){"undefined"!==typeof f.onselectstart&&(f.onselectstart=null);g?f.style[g]="":"string"===typeof f.unselectable&&(f.unselectable="");return f}})();(function(){h.util.getScript=function(a,g){var f=h.document.getElementsByTagName("head")[0],c=h.document.createElement("script"),d=!0;c.onload=c.onreadystatechange=function(f){!d||
"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!1,g(f||h.window.event),c=c.onload=c.onreadystatechange=null)};c.src=a;f.appendChild(c)}})();h.util.getById=function(a){return"string"===typeof a?h.document.getElementById(a):a};h.util.toArray=c;h.util.makeElement=e;h.util.addClass=function(a,g){a&&-1===(" "+a.className+" ").indexOf(" "+g+" ")&&(a.className+=(a.className?" ":"")+g)};h.util.wrapElement=function(a,g,f){"string"===typeof g&&(g=e(g,f));a.parentNode&&
a.parentNode.replaceChild(g,a);g.appendChild(a);return g};h.util.getScrollLeftTop=function(a,g){var f,c,d=0,k=0,e=h.document.documentElement,l=h.document.body||{scrollLeft:0,scrollTop:0};for(c=a;a&&a.parentNode&&!f;)a=a.parentNode,1===a.nodeType&&"fixed"===h.util.getElementStyle(a,"position")&&(f=a),1===a.nodeType&&c!==g&&"absolute"===h.util.getElementStyle(a,"position")?k=d=0:a===h.document?(d=l.scrollLeft||e.scrollLeft||0,k=l.scrollTop||e.scrollTop||0):(d+=a.scrollLeft||0,k+=a.scrollTop||0);return{left:d,
top:k}};h.util.getElementOffset=function(b){var g;g=b&&b.ownerDocument;var f={left:0,top:0},c={left:0,top:0},d={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!g)return{left:0,top:0};for(var k in d)c[d[k]]+=parseInt(a(b,k),10)||0;g=g.documentElement;"undefined"!==typeof b.getBoundingClientRect&&(f=b.getBoundingClientRect());b=h.util.getScrollLeftTop(b,null);return{left:f.left+b.left-(g.clientLeft||0)+c.left,top:f.top+b.top-(g.clientTop||0)+c.top}};h.util.getElementStyle=
a})();(function(){function e(c,a){return c+(/\?/.test(c)?"&":"?")+a}function d(){}var k=function(){for(var c=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],a=c.length;a--;)try{if(c[a]())return c[a]}catch(b){}}();h.util.request=function(c,a){a||(a={});var b=a.method?a.method.toUpperCase():"GET",g=a.onComplete||function(){},f=k(),p;f.onreadystatechange=
function(){4===f.readyState&&(g(f),f.onreadystatechange=d)};"GET"===b&&(p=null,"string"===typeof a.parameters&&(c=e(c,a.parameters)));f.open(b,c,!0);"POST"!==b&&"PUT"!==b||f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.send(p);return f}})();h.log=function(){};h.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(e){"undefined"!==typeof console[e]&&"function"===typeof console[e].apply&&(h[e]=function(){return console[e].apply(console,arguments)})});
(function(e){function d(d,c){this.x=d;this.y=c}e=e.fabric||(e.fabric={});e.Point?e.warn("fabric.Point is already defined"):(e.Point=d,d.prototype={constructor:d,add:function(k){return new d(this.x+k.x,this.y+k.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(k){return new d(this.x+k,this.y+k)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(k){return new d(this.x-k.x,this.y-k.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},
scalarSubtract:function(k){return new d(this.x-k,this.y-k)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(k){return new d(this.x*k,this.y*k)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(k){return new d(this.x/k,this.y/k)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return this.x===d.x&&this.y===d.y},lt:function(d){return this.x<d.x&&this.y<d.y},lte:function(d){return this.x<=d.x&&this.y<=d.y},gt:function(d){return this.x>
d.x&&this.y>d.y},gte:function(d){return this.x>=d.x&&this.y>=d.y},lerp:function(k,c){return new d(this.x+(k.x-this.x)*c,this.y+(k.y-this.y)*c)},distanceFrom:function(d){var c=this.x-d.x;d=this.y-d.y;return Math.sqrt(c*c+d*d)},midPointFrom:function(k){return new d(this.x+(k.x-this.x)/2,this.y+(k.y-this.y)/2)},min:function(k){return new d(Math.min(this.x,k.x),Math.min(this.y,k.y))},max:function(k){return new d(Math.max(this.x,k.x),Math.max(this.y,k.y))},toString:function(){return this.x+","+this.y},
setXY:function(d,c){this.x=d;this.y=c},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(d){var c=this.x,a=this.y;this.x=d.x;this.y=d.y;d.x=c;d.y=a}})})("undefined"!==typeof e?e:this);(function(e){function d(c){this.status=c;this.points=[]}var k=e.fabric||(e.fabric={});k.Intersection?k.warn("fabric.Intersection is already defined"):(k.Intersection=d,k.Intersection.prototype={appendPoint:function(c){this.points.push(c)},appendPoints:function(c){this.points=this.points.concat(c)}},k.Intersection.intersectLineLine=
function(c,a,b,g){var f,p=(g.x-b.x)*(c.y-b.y)-(g.y-b.y)*(c.x-b.x);f=(a.x-c.x)*(c.y-b.y)-(a.y-c.y)*(c.x-b.x);b=(g.y-b.y)*(a.x-c.x)-(g.x-b.x)*(a.y-c.y);0!==b?(p/=b,f/=b,0<=p&&1>=p&&0<=f&&1>=f?(f=new d("Intersection"),f.points.push(new k.Point(c.x+p*(a.x-c.x),c.y+p*(a.y-c.y)))):f=new d):f=0===p||0===f?new d("Coincident"):new d("Parallel");return f},k.Intersection.intersectLinePolygon=function(c,a,b){for(var g=new d,f=b.length,k=0;k<f;k++){var e=d.intersectLineLine(c,a,b[k],b[(k+1)%f]);g.appendPoints(e.points)}0<
g.points.length&&(g.status="Intersection");return g},k.Intersection.intersectPolygonPolygon=function(c,a){for(var b=new d,g=c.length,f=0;f<g;f++){var k=d.intersectLinePolygon(c[f],c[(f+1)%g],a);b.appendPoints(k.points)}0<b.points.length&&(b.status="Intersection");return b},k.Intersection.intersectPolygonRectangle=function(c,a,b){var g=a.min(b),f=a.max(b);b=new k.Point(f.x,g.y);var p=new k.Point(g.x,f.y);a=d.intersectLinePolygon(g,b,c);b=d.intersectLinePolygon(b,f,c);f=d.intersectLinePolygon(f,p,c);
c=d.intersectLinePolygon(p,g,c);g=new d;g.appendPoints(a.points);g.appendPoints(b.points);g.appendPoints(f.points);g.appendPoints(c.points);0<g.points.length&&(g.status="Intersection");return g})})("undefined"!==typeof e?e:this);(function(e){function d(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function k(a,b,g){0>g&&(g+=1);1<g&&--g;return g<1/6?a+6*(b-a)*g:.5>g?b:g<2/3?a+(b-a)*(2/3-g)*6:a}var c=e.fabric||(e.fabric={});c.Color?c.warn("fabric.Color is already defined."):(c.Color=d,c.Color.prototype=
{_tryParsingColor:function(a){var b;a in d.colorNameMap&&(a=d.colorNameMap[a]);"transparent"===a?this.setSource([255,255,255,0]):((b=d.sourceFromHex(a))||(b=d.sourceFromRgb(a)),b||(b=d.sourceFromHsl(a)),b&&this.setSource(b))},_rgbToHsl:function(a,b,g){a/=255;b/=255;g/=255;var f,d,k,e=c.util.array.max([a,b,g]);d=c.util.array.min([a,b,g]);k=(e+d)/2;if(e===d)f=d=0;else{var h=e-d;d=.5<k?h/(2-e-d):h/(e+d);switch(e){case a:f=(b-g)/h+(b<g?6:0);break;case b:f=(g-a)/h+2;break;case g:f=(a-b)/h+4}f/=6}return[Math.round(360*
f),Math.round(100*d),Math.round(100*k)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+
","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),b,g;b=a[0].toString(16);b=1===b.length?"0"+b:b;g=a[1].toString(16);g=1===g.length?"0"+g:g;a=a[2].toString(16);a=1===a.length?"0"+a:a;return b.toUpperCase()+g.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([b,
b,b,a[3]]);return this},toBlackWhite:function(a){var b=this.getSource(),g=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),b=b[3],g=Number(g)<Number(a||127)?0:255;this.setSource([g,g,g,b]);return this},overlayWith:function(a){a instanceof d||(a=new d(a));var b=[],g=this.getAlpha(),f=this.getSource();a=a.getSource();for(var c=0;3>c;c++)b.push(Math.round(.5*f[c]+.5*a[c]));b[3]=g;this.setSource(b);return this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,
c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(a){return d.fromSource(d.sourceFromRgb(a))},
c.Color.sourceFromRgb=function(a){if(a=a.match(d.reRGBa)){var b=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),g=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),f=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(b,10),parseInt(g,10),parseInt(f,10),a[4]?parseFloat(a[4]):1]}},c.Color.fromRgba=d.fromRgb,c.Color.fromHsl=function(a){return d.fromSource(d.sourceFromHsl(a))},c.Color.sourceFromHsl=function(a){if(a=a.match(d.reHSLa)){var b=
(parseFloat(a[1])%360+360)%360/360,g=parseFloat(a[2])/(/%$/.test(a[2])?100:1),f=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===g)f=g=b=f;else var c=.5>=f?f*(g+1):f+g-f*g,e=2*f-c,f=k(e,c,b+1/3),g=k(e,c,b),b=k(e,c,b-1/3);return[Math.round(255*f),Math.round(255*g),Math.round(255*b),a[4]?parseFloat(a[4]):1]}},c.Color.fromHsla=d.fromHsl,c.Color.fromHex=function(a){return d.fromSource(d.sourceFromHex(a))},c.Color.sourceFromHex=function(a){if(a.match(d.reHex)){var b=a.slice(a.indexOf("#")+1),g=3===b.length;
a=g?b.charAt(0)+b.charAt(0):b.substring(0,2);var f=g?b.charAt(1)+b.charAt(1):b.substring(2,4),b=g?b.charAt(2)+b.charAt(2):b.substring(4,6);return[parseInt(a,16),parseInt(f,16),parseInt(b,16),1]}},c.Color.fromSource=function(a){var b=new d;b.setSource(a);return b})})("undefined"!==typeof e?e:this);(function(){if(h.StaticCanvas)h.warn("fabric.StaticCanvas is already defined.");else{var e=h.util.object.extend,d=h.util.getElementOffset,k=h.util.removeFromArray,c=Error("Could not initialize `canvas` element");
h.StaticCanvas=h.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);h.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);
this._initOptions(b);this._setImageSmoothing();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=d(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,g){return this.__setBgOverlayImage("overlayImage",
a,b,g)},setBackgroundImage:function(a,b,g){return this.__setBgOverlayImage("backgroundImage",a,b,g)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled;a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;a.mozImageSmoothingEnabled=this.imageSmoothingEnabled;a.msImageSmoothingEnabled=
this.imageSmoothingEnabled;a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,g,f){"string"===typeof b?h.util.loadImage(b,function(b){this[a]=new h.Image(b,f);g&&g()},this,f&&f.crossOrigin):(f&&b.setOptions(f),this[a]=b,g&&g());return this},__setBgOverlayColor:function(a,b,g){if(b&&b.source){var f=this;h.util.loadImage(b.source,function(c){f[a]=new h.Pattern({source:c,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});g&&g()})}else this[a]=b,g&&g();return this},
_createCanvasElement:function(){var a=h.document.createElement("canvas");a.style||(a.style={});if(!a)throw c;this._initCanvasElement(a);return a},_initCanvasElement:function(a){h.util.createCanvasElement(a);if("undefined"===typeof a.getContext)throw c;},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,
this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=h.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);h.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},
getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var g;b=b||{};for(var f in a)g=a[f],b.cssOnly||(this._setBackstoreDimension(f,a[f]),g+="px"),b.backstoreOnly||this._setCssDimension(f,g);b.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&
(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var b=this.getActiveGroup();this.viewportTransform=a;this.renderAll();a=0;for(var g=this._objects.length;a<g;a++)this._objects[a].setCoords();
b&&b.setCoords();return this},zoomToPoint:function(a,b){var g=a;a=h.util.transformPoint(a,h.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=b;var f=h.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=g.x-f.x;this.viewportTransform[5]+=g.y-f.y;this.renderAll();g=0;for(f=this._objects.length;g<f;g++)this._objects[g].setCoords();return this},setZoom:function(a){this.zoomToPoint(new h.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=
-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new h.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var g=this.viewportTransform;a.transform(g[0],g[1],g[2],g[3],g[4],g[5]);this._shouldRenderObject(b)&&
b.render(a);a.restore();this.controlsAboveOverlay||b._renderControls(a)}},_shouldRenderObject:function(a){return a?a!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(a){this.stateful&&a.setupState();a.canvas=this;a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",
{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var b=this[!0===a&&this.interactive?
"contextTop":"contextContainer"],g=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);a||this.clearContext(b);this.fire("before:render");this.clipTo&&h.util.clipContext(this,b);this._renderBackground(b);this._renderObjects(b,g);this._renderActiveGroup(b,g);this.clipTo&&b.restore();this._renderOverlay(b);this.controlsAboveOverlay&&this.interactive&&this.drawControls(b);this.fire("after:render");return this},_renderObjects:function(a,b){var g,
f;if(!b||this.preserveObjectStacking)for(g=0,f=this._objects.length;g<f;++g)this._draw(a,this._objects[g]);else for(g=0,f=this._objects.length;g<f;++g)this._objects[g]&&!b.contains(this._objects[g])&&this._draw(a,this._objects[g])},_renderActiveGroup:function(a,b){if(b){var g=[];this.forEachObject(function(f){b.contains(f)&&g.push(f)});b._set("objects",g);this._draw(a,b)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,
a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(a,this.overlayImage)},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);
this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(a);this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new h.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new h.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},
centerObject:function(a){var b=this.getCenter();this._centerObject(a,new h.Point(b.left,b.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var g={objects:this._toObjects(a,b)};e(g,this.__serializeBgOverlay());
h.util.populateWithProperties(this,g,b);return g},_toObjects:function(a,b){return this.getObjects().map(function(g){return this._toObject(g,a,b)},this)},_toObject:function(a,b,g){var f;this.includeDefaultValues||(f=a.includeDefaultValues,a.includeDefaultValues=!1);var c=this._realizeGroupTransformOnObject(a);b=a[b](g);this.includeDefaultValues||(a.includeDefaultValues=f);this._unwindGroupTransformOnObject(a,c);return b},_realizeGroupTransformOnObject:function(a){var b="angle flipX flipY height left scaleX scaleY top width".split(" ");
if(a.group&&a.group===this.getActiveGroup()){var g={};b.forEach(function(f){g[f]=a[f]});this.getActiveGroup().realizeTransform(a);return g}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=
this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var g=[];this._setSVGPreamble(g,a);this._setSVGHeader(g,a);this._setSVGBgOverlayColor(g,"backgroundColor");this._setSVGBgOverlayImage(g,"backgroundImage");this._setSVGObjects(g,b);this._setSVGBgOverlayColor(g,"overlayColor");this._setSVGBgOverlayImage(g,"overlayImage");g.push("</svg>");return g.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||
a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var g,f,c;b.viewBox?(g=b.viewBox.width,f=b.viewBox.height):(g=this.width,f=this.height,this.svgViewportTransformation||(c=this.viewportTransform,g/=c[0],f/=c[3]));a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',
g,'" ','height="',f,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,b.viewBox?'viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",h.version,"</desc>","<defs>",h.createSVGFontFacesMarkup(this.getObjects()),h.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,b){for(var g=0,f=this.getObjects(),c=f.length;g<c;g++){var d=
f[g],k=this._realizeGroupTransformOnObject(d);a.push(d.toSVG(b));this._unwindGroupTransformOnObject(d,k)}},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:
this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>")},sendToBack:function(a){k(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){k(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var g=this._objects.indexOf(a);0!==g&&(g=this._findNewLowerIndex(a,
g,b),k(this._objects,a),this._objects.splice(g,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,g){if(g)for(g=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){g=b;break}}else g=b-1;return g},bringForward:function(a,b){var g=this._objects.indexOf(a);g!==this._objects.length-1&&(g=this._findNewUpperIndex(a,g,b),k(this._objects,a),this._objects.splice(g,0,a),this.renderAll&&
this.renderAll());return this},_findNewUpperIndex:function(a,b,g){if(g)for(g=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){g=b;break}}else g=b+1;return g},moveTo:function(a,b){k(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+
this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});e(h.StaticCanvas.prototype,h.Observable);e(h.StaticCanvas.prototype,h.Collection);e(h.StaticCanvas.prototype,h.DataURLExporter);e(h.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=h.util.createCanvasElement();if(!b||!b.getContext)return null;var g=b.getContext("2d");if(!g)return null;switch(a){case "getImageData":return"undefined"!==typeof g.getImageData;case "setLineDash":return"undefined"!==
typeof g.setLineDash;case "toDataURL":return"undefined"!==typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(f){}return!1;default:return null}}});h.StaticCanvas.prototype.toJSON=h.StaticCanvas.prototype.toObject}})();(function(){var e=h.util.getPointer,d=h.util.degreesToRadians,k=h.util.radiansToDegrees,c=Math.atan2,a=Math.abs;h.Canvas=h.util.createClass(h.StaticCanvas,{initialize:function(g,f){f||(f={});this._initStatic(g,f);this._initInteractive();this._createCacheCanvas();
h.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=
this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=h.PencilBrush&&new h.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(g){var f=this._currentTransform;f.target.set({scaleX:f.original.scaleX,scaleY:f.original.scaleY,left:f.original.left,top:f.original.top});this._shouldCenterTransform(g,f.target)?"rotate"===f.action?this._setOriginToCenter(f.target):("center"!==f.originX&&(f.mouseXSign="right"===f.originX?
-1:1),"center"!==f.originY&&(f.mouseYSign="bottom"===f.originY?-1:1),f.originX="center",f.originY="center"):(f.originX=f.original.originX,f.originY=f.original.originY)},containsPoint:function(g,f){var a=this.getPointer(g,!0),b=this._normalizePointer(f,a);return f.containsPoint(b)||f._findTargetCorner(a)},_normalizePointer:function(g,f){var a=this.getActiveGroup(),b=f.x,c=f.y;a&&"group"!==g.type&&a.contains(g)&&(a=new h.Point(a.left,a.top),a=h.util.transformPoint(a,this.viewportTransform,!0),b-=a.x,
c-=a.y);return{x:b,y:c}},isTargetTransparent:function(g,f,a){var b=g.hasBorders,c=g.transparentCorners;g.hasBorders=g.transparentCorners=!1;this._draw(this.contextCache,g);g.hasBorders=b;g.transparentCorners=c;g=h.util.isTransparent(this.contextCache,f,a,this.targetFindTolerance);this.clearContext(this.contextCache);return g},_shouldClearSelection:function(g,f){var a=this.getActiveGroup(),b=this.getActiveObject();return!f||f&&a&&!a.contains(f)&&a!==f&&!g.shiftKey||f&&!f.evented||f&&!f.selectable&&
b&&b!==f},_shouldCenterTransform:function(g,f){if(f){var a=this._currentTransform,b;"scale"===a.action||"scaleX"===a.action||"scaleY"===a.action?b=this.centeredScaling||f.centeredScaling:"rotate"===a.action&&(b=this.centeredRotation||f.centeredRotation);return b?!g.altKey:g.altKey}},_getOriginFromCorner:function(g,f){var a={x:g.originX,y:g.originY};if("ml"===f||"tl"===f||"bl"===f)a.x="right";else if("mr"===f||"tr"===f||"br"===f)a.x="left";if("tl"===f||"mt"===f||"tr"===f)a.y="bottom";else if("bl"===
f||"mb"===f||"br"===f)a.y="top";return a},_getActionFromCorner:function(g,f){var a="drag";f&&(a="ml"===f||"mr"===f?"scaleX":"mt"===f||"mb"===f?"scaleY":"mtr"===f?"rotate":"scale");return a},_setupCurrentTransform:function(g,f){if(f){var a=this.getPointer(g),b=f._findTargetCorner(this.getPointer(g,!0)),c=this._getActionFromCorner(f,b),b=this._getOriginFromCorner(f,b);this._currentTransform={target:f,action:c,scaleX:f.scaleX,scaleY:f.scaleY,offsetX:a.x-f.left,offsetY:a.y-f.top,originX:b.x,originY:b.y,
ex:a.x,ey:a.y,left:f.left,top:f.top,theta:d(f.angle),width:f.width*f.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:f.left,top:f.top,scaleX:f.scaleX,scaleY:f.scaleY,originX:b.x,originY:b.y};this._resetCurrentTransform(g)}},_translateObject:function(g,f){var a=this._currentTransform.target;a.get("lockMovementX")||a.set("left",g-this._currentTransform.offsetX);a.get("lockMovementY")||a.set("top",f-this._currentTransform.offsetY)},_scaleObject:function(g,f,a){var b=this._currentTransform,
c=b.target,d=c.get("lockScalingX"),k=c.get("lockScalingY"),e=c.get("lockScalingFlip");if(!d||!k){var l=c.translateToOriginPoint(c.getCenterPoint(),b.originX,b.originY);g=c.toLocalPoint(new h.Point(g,f),b.originX,b.originY);this._setLocalMouse(g,b);this._setObjectScale(g,b,d,k,a,e);c.setPositionByOrigin(l,b.originX,b.originY)}},_setObjectScale:function(g,a,b,c,d,k){var e=a.target,h=!1,l=!1,t=e.stroke?e.strokeWidth:0;a.newScaleX=g.x/(e.width+t/2);a.newScaleY=g.y/(e.height+t/2);k&&0>=a.newScaleX&&a.newScaleX<
e.scaleX&&(h=!0);k&&0>=a.newScaleY&&a.newScaleY<e.scaleY&&(l=!0);"equally"!==d||b||c?d?"x"!==d||e.get("lockUniScaling")?"y"!==d||e.get("lockUniScaling")||l||c||e.set("scaleY",a.newScaleY):h||b||e.set("scaleX",a.newScaleX):(h||b||e.set("scaleX",a.newScaleX),l||c||e.set("scaleY",a.newScaleY)):h||l||this._scaleObjectEqually(g,e,a);h||l||this._flipObject(a,d)},_scaleObjectEqually:function(a,f,b){a=a.y+a.x;var c=f.stroke?f.strokeWidth:0,c=(f.height+c/2)*b.original.scaleY+(f.width+c/2)*b.original.scaleX;
b.newScaleX=b.original.scaleX*a/c;b.newScaleY=b.original.scaleY*a/c;f.set("scaleX",b.newScaleX);f.set("scaleY",b.newScaleY)},_flipObject:function(a,f){0>a.newScaleX&&"y"!==f&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&"x"!==f&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(g,f){var b=f.target;"right"===f.originX?g.x*=-1:"center"===f.originX&&(g.x=2*g.x*f.mouseXSign,0>g.x&&(f.mouseXSign=-f.mouseXSign));
"bottom"===f.originY?g.y*=-1:"center"===f.originY&&(g.y=2*g.y*f.mouseYSign,0>g.y&&(f.mouseYSign=-f.mouseYSign));a(g.x)>b.padding?g.x=0>g.x?g.x+b.padding:g.x-b.padding:g.x=0;a(g.y)>b.padding?g.y=0>g.y?g.y+b.padding:g.y-b.padding:g.y=0},_rotateObject:function(a,f){var b=this._currentTransform;if(!b.target.get("lockRotation")){var d=c(b.ey-b.top,b.ex-b.left),e=c(f-b.top,a-b.left),d=k(e-d+b.theta);0>d&&(d=360+d);b.target.angle=d%360}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=
1;a.scaleY=1;a.setAngle(0)},_drawSelection:function(){var g=this.contextTop,f=this._groupSelector,b=f.left,c=f.top,d=a(b),k=a(c);g.fillStyle=this.selectionColor;g.fillRect(f.ex-(0<b?0:-b),f.ey-(0<c?0:-c),d,k);g.lineWidth=this.selectionLineWidth;g.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(b=f.ex+.5-(0<b?0:d),f=f.ey+.5-(0<c?0:k),g.beginPath(),h.util.drawDashedLine(g,b,f,b+d,f,this.selectionDashArray),h.util.drawDashedLine(g,b,f+k-1,b+d,f+k-1,this.selectionDashArray),h.util.drawDashedLine(g,
b,f,b,f+k,this.selectionDashArray),h.util.drawDashedLine(g,b+d-1,f,b+d-1,f+k,this.selectionDashArray),g.closePath(),g.stroke()):g.strokeRect(f.ex+.5-(0<b?0:d),f.ey+.5-(0<c?0:k),d,k)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,
!0))},findTarget:function(a,f){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var b=this.getActiveGroup();if(b&&!f&&this.containsPoint(a,b))return b;b=this._searchPossibleTargets(a);this._fireOverOutEvents(b);return b}},_fireOverOutEvents:function(a){a?this._hoveredTarget!==a&&(this.fire("mouse:over",{target:a}),a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),
this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,f,b){if(f&&f.visible&&f.evented&&this.containsPoint(a,f)&&(!this.perPixelTargetFind&&!f.perPixelTargetFind||f.isEditing||!this.isTargetTransparent(f,b.x,b.y)))return!0},_searchPossibleTargets:function(a){for(var f,b=this.getPointer(a,!0),c=this._objects.length;c--;)if(!this._objects[c].group&&this._checkTarget(a,this._objects[c],
b)){this.relatedTarget=this._objects[c];f=this._objects[c];break}return f},getPointer:function(a,f,b){b||(b=this.upperCanvasEl);a=e(a,b);var c=b.getBoundingClientRect(),d=c.width||0,k=c.height||0;d&&k||("top"in c&&"bottom"in c&&(k=Math.abs(c.top-c.bottom)),"right"in c&&"left"in c&&(d=Math.abs(c.right-c.left)));this.calcOffset();a.x-=this._offset.left;a.y-=this._offset.top;f||(a=h.util.transformPoint(a,h.util.invertTransform(this.viewportTransform)));0===d||0===k?b=f=1:(f=b.width/d,b=b.height/k);return{x:a.x*
f,y:a.y*b}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();h.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",
this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=h.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});h.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});h.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var f=this.getWidth()||a.width,b=this.getHeight()||a.height;h.util.setStyle(a,
{position:"absolute",width:f+"px",height:b+"px",left:0,top:0});a.width=f;a.height=b;h.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,f){f.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},setActiveObject:function(a,f){this._setActiveObject(a);this.renderAll();this.fire("object:selected",
{target:a,e:f});a.fire("selected",{e:f});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",!0)},setActiveGroup:function(a,f){this._setActiveGroup(a);a&&(this.fire("object:selected",
{target:a,e:f}),a.fire("selected",{e:f}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=this.getObjects(),f=0,b=a.length;f<b;f++)a[f].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){var f=
this.getActiveGroup()||this.getActiveObject();f&&this.fire("before:selection:cleared",{target:f,e:a});this.deactivateAll();f&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var f=this.getActiveGroup();f?this._drawGroupControls(a,f):this._drawObjectsControls(a)},_drawGroupControls:function(a,f){f._renderControls(a)},_drawObjectsControls:function(a){for(var f=0,b=this._objects.length;f<b;++f)this._objects[f]&&this._objects[f].active&&(this._objects[f]._renderControls(a),
this.lastRenderedObjectWithControlsAboveOverlay=this._objects[f])}});for(var b in h.StaticCanvas)"prototype"!==b&&(h.Canvas[b]=h.StaticCanvas[b]);h.isTouchSupported&&(h.Canvas.prototype._setCursorFromEvent=function(){});h.Element=h.Canvas})();(function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},d=h.util.addListener,k=h.util.removeListener;h.util.object.extend(h.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();
d(h.window,"resize",this._onResize);d(this.upperCanvasEl,"mousedown",this._onMouseDown);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"mousewheel",this._onMouseWheel);d(this.upperCanvasEl,"touchstart",this._onMouseDown);d(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",
this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);
this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){k(h.window,"resize",this._onResize);k(this.upperCanvasEl,"mousedown",this._onMouseDown);k(this.upperCanvasEl,"mousemove",this._onMouseMove);k(this.upperCanvasEl,"mousewheel",this._onMouseWheel);k(this.upperCanvasEl,"touchstart",this._onMouseDown);k(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,
"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(c,a){this.__onTransformGesture&&this.__onTransformGesture(c,a)},_onDrag:function(c,a){this.__onDrag&&this.__onDrag(c,a)},_onMouseWheel:function(c,a){this.__onMouseWheel&&this.__onMouseWheel(c,a)},_onOrientationChange:function(c,
a){this.__onOrientationChange&&this.__onOrientationChange(c,a)},_onShake:function(c,a){this.__onShake&&this.__onShake(c,a)},_onLongPress:function(c,a){this.__onLongPress&&this.__onLongPress(c,a)},_onMouseDown:function(c){this.__onMouseDown(c);d(h.document,"touchend",this._onMouseUp);d(h.document,"touchmove",this._onMouseMove);k(this.upperCanvasEl,"mousemove",this._onMouseMove);k(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===c.type?k(this.upperCanvasEl,"mousedown",this._onMouseDown):
(d(h.document,"mouseup",this._onMouseUp),d(h.document,"mousemove",this._onMouseMove))},_onMouseUp:function(c){this.__onMouseUp(c);k(h.document,"mouseup",this._onMouseUp);k(h.document,"touchend",this._onMouseUp);k(h.document,"mousemove",this._onMouseMove);k(h.document,"touchmove",this._onMouseMove);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"touchmove",this._onMouseMove);if("touchend"===c.type){var a=this;setTimeout(function(){d(a.upperCanvasEl,"mousedown",a._onMouseDown)},
400)}},_onMouseMove:function(c){!this.allowTouchScrolling&&c.preventDefault&&c.preventDefault();this.__onMouseMove(c)},_onResize:function(){this.calcOffset()},_shouldRender:function(c,a){var b=this.getActiveGroup()||this.getActiveObject();return!!(c&&(c.isMoving||c!==b)||!c&&b||!c&&!b&&!this._groupSelector||a&&this._previousPointer&&this.selection&&(a.x!==this._previousPointer.x||a.y!==this._previousPointer.y))},__onMouseUp:function(c){var a;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(c);
else{this._currentTransform?(this._finalizeCurrentTransform(),a=this._currentTransform.target):a=this.findTarget(c,!0);var b=this._shouldRender(a,this.getPointer(c));this._maybeGroupObjects(c);a&&(a.isMoving=!1);b&&this.renderAll();this._handleCursorAndEvent(c,a)}},_handleCursorAndEvent:function(c,a){this._setCursorFromEvent(c,a);var b=this;setTimeout(function(){b._setCursorFromEvent(c,a)},50);this.fire("mouse:up",{target:a,e:c});a&&a.fire("mouseup",{e:c})},_finalizeCurrentTransform:function(){var c=
this._currentTransform.target;c._scaling&&(c._scaling=!1);c.setCoords();this.stateful&&c.hasStateChanged()&&(this.fire("object:modified",{target:c}),c.fire("modified"));this._restoreOriginXY(c)},_restoreOriginXY:function(c){if(this._previousOriginX&&this._previousOriginY){var a=c.translateToOriginPoint(c.getCenterPoint(),this._previousOriginX,this._previousOriginY);c.originX=this._previousOriginX;c.originY=this._previousOriginY;c.left=a.x;c.top=a.y;this._previousOriginY=this._previousOriginX=null}},
_onMouseDownInDrawingMode:function(c){this._isCurrentlyDrawing=!0;this.discardActiveObject(c).renderAll();this.clipTo&&h.util.clipContext(this,this.contextTop);var a=h.util.invertTransform(this.viewportTransform),a=h.util.transformPoint(this.getPointer(c,!0),a);this.freeDrawingBrush.onMouseDown(a);this.fire("mouse:down",{e:c});a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mousedown",{e:c,target:a})},_onMouseMoveInDrawingMode:function(c){if(this._isCurrentlyDrawing){var a=h.util.invertTransform(this.viewportTransform),
a=h.util.transformPoint(this.getPointer(c,!0),a);this.freeDrawingBrush.onMouseMove(a)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:c});a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mousemove",{e:c,target:a})},_onMouseUpInDrawingMode:function(c){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:c});var a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mouseup",{e:c,target:a})},__onMouseDown:function(c){if(("which"in
c?1===c.which:1===c.button)||h.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(c);else if(!this._currentTransform){var a=this.findTarget(c),b=this.getPointer(c,!0);this._previousPointer=b;var g=this._shouldRender(a,b),f=this._shouldGroup(c,a);this._shouldClearSelection(c,a)?this._clearSelection(c,a,b):f&&(this._handleGrouping(c,a),a=this.getActiveGroup());a&&a.selectable&&!f&&(this._beforeTransform(c,a),this._setupCurrentTransform(c,a));g&&this.renderAll();this.fire("mouse:down",
{target:a,e:c});a&&a.fire("mousedown",{e:c})}},_beforeTransform:function(c,a){this.stateful&&a.saveState();if(a._findTargetCorner(this.getPointer(c)))this.onBeforeScaleRotate(a);a!==this.getActiveGroup()&&a!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(a,c))},_clearSelection:function(c,a,b){this.deactivateAllWithDispatch(c);a&&a.selectable?this.setActiveObject(a,c):this.selection&&(this._groupSelector={ex:b.x,ey:b.y,top:0,left:0})},_setOriginToCenter:function(c){this._previousOriginX=
this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var a=c.getCenterPoint();c.originX="center";c.originY="center";c.left=a.x;c.top=a.y;this._currentTransform.left=c.left;this._currentTransform.top=c.top},_setCenterToOrigin:function(c){var a=c.translateToOriginPoint(c.getCenterPoint(),this._previousOriginX,this._previousOriginY);c.originX=this._previousOriginX;c.originY=this._previousOriginY;c.left=a.x;c.top=a.y;this._previousOriginY=this._previousOriginX=
null},__onMouseMove:function(c){var a,b;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(c);else if(!("undefined"!==typeof c.touches&&1<c.touches.length)){var g=this._groupSelector;g?(b=this.getPointer(c,!0),g.left=b.x-g.ex,g.top=b.y-g.ey,this.renderTop()):this._currentTransform?this._transformObject(c):(a=this.findTarget(c),!a||a&&!a.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(c,a));this.fire("mouse:move",{target:a,e:c});a&&a.fire("mousemove",{e:c})}},_transformObject:function(c){var a=
this.getPointer(c),b=this._currentTransform;b.reset=!1;b.target.isMoving=!0;this._beforeScaleTransform(c,b);this._performTransformAction(c,b,a);this.renderAll()},_performTransformAction:function(c,a,b){var g=b.x;b=b.y;var f=a.target,d=a.action;"rotate"===d?(this._rotateObject(g,b),this._fire("rotating",f,c)):"scale"===d?(this._onScale(c,a,g,b),this._fire("scaling",f,c)):"scaleX"===d?(this._scaleObject(g,b,"x"),this._fire("scaling",f,c)):"scaleY"===d?(this._scaleObject(g,b,"y"),this._fire("scaling",
f,c)):(this._translateObject(g,b),this._fire("moving",f,c),this.setCursor(this.moveCursor))},_fire:function(c,a,b){this.fire("object:"+c,{target:a,e:b});a.fire(c,{e:b})},_beforeScaleTransform:function(c,a){if("scale"===a.action||"scaleX"===a.action||"scaleY"===a.action){var b=this._shouldCenterTransform(c,a.target);if(b&&("center"!==a.originX||"center"!==a.originY)||!b&&"center"===a.originX&&"center"===a.originY)this._resetCurrentTransform(c),a.reset=!0}},_onScale:function(c,a,b,g){!c.shiftKey&&!this.uniScaleTransform||
a.target.get("lockUniScaling")?(a.reset||"scale"!==a.currentAction||this._resetCurrentTransform(c,a.target),a.currentAction="scaleEqually",this._scaleObject(b,g,"equally")):(a.currentAction="scale",this._scaleObject(b,g))},_setCursorFromEvent:function(c,a){if(a&&a.selectable){var b=this.getActiveGroup();(b=a._findTargetCorner&&(!b||!b.contains(a))&&a._findTargetCorner(this.getPointer(c,!0)))?this._setCornerCursor(b,a):this.setCursor(a.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),
!1;return!0},_setCornerCursor:function(c,a){if(c in e)this.setCursor(this._getRotatedCornerCursor(c,a));else if("mtr"===c&&a.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(c,a){var b=Math.round(a.getAngle()%360/45);0>b&&(b+=8);b+=e[c];return this.cursorMap[b%8]}})})();(function(){var e=Math.min,d=Math.max;h.util.object.extend(h.Canvas.prototype,{_shouldGroup:function(d,c){var a=this.getActiveObject();return d.shiftKey&&
(this.getActiveGroup()||a&&a!==c)&&this.selection},_handleGrouping:function(d,c){if(c===this.getActiveGroup()&&(c=this.findTarget(d,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,d):this._createActiveGroup(c,d);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(d,c){var a=this.getActiveGroup();if(a.contains(d)){if(a.removeWithUpdate(d),this._resetObjectTransform(a),d.set("active",!1),1===a.size()){this.discardActiveGroup(c);this.setActiveObject(a.item(0));
return}}else a.addWithUpdate(d),this._resetObjectTransform(a);this.fire("selection:created",{target:a,e:c});a.set("active",!0)},_createActiveGroup:function(d,c){if(this._activeObject&&d!==this._activeObject){var a=this._createGroup(d);a.addWithUpdate();this.setActiveGroup(a);this._activeObject=null;this.fire("selection:created",{target:a,e:c})}d.set("active",!0)},_createGroup:function(d){var c=this.getObjects();d=c.indexOf(this._activeObject)<c.indexOf(d)?[this._activeObject,d]:[d,this._activeObject];
return new h.Group(d,{canvas:this})},_groupSelectedObjects:function(d){var c=this._collectObjects();1===c.length?this.setActiveObject(c[0],d):1<c.length&&(c=new h.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,d),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){var k=[],c;c=this._groupSelector.ex;for(var a=this._groupSelector.ey,b=c+this._groupSelector.left,g=a+this._groupSelector.top,f=new h.Point(e(c,b),e(a,g)),p=new h.Point(d(c,
b),d(a,g)),a=c===b&&a===g,b=this._objects.length;b--&&!((c=this._objects[b])&&c.selectable&&c.visible&&(c.intersectsWithRect(f,p)||c.isContainedWithinRect(f,p)||c.containsPoint(f)||c.containsPoint(p))&&(c.set("active",!0),k.push(c),a)););return k},_maybeGroupObjects:function(d){this.selection&&this._groupSelector&&this._groupSelectedObjects(d);if(d=this.getActiveGroup())d.setObjectsCoords().setCoords(),d.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
h.util.object.extend(h.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var d=e.format||"png",k=e.quality||1,c=e.multiplier||1;e={left:e.left,top:e.top,width:e.width,height:e.height};return 1!==c?this.__toDataURLWithMultiplier(d,k,e,c):this.__toDataURL(d,k,e)},__toDataURL:function(e,d,k){this.renderAll(!0);var c=this.upperCanvasEl||this.lowerCanvasEl;k=this.__getCroppedCanvas(c,k);"jpg"===e&&(e="jpeg");e=h.StaticCanvas.supports("toDataURLWithQuality")?(k||c).toDataURL("image/"+e,d):(k||c).toDataURL("image/"+
e);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return e},__getCroppedCanvas:function(e,d){var k,c;if("left"in d||"top"in d||"width"in d||"height"in d)k=h.util.createCanvasElement(),c=k.getContext("2d"),k.width=d.width||this.width,k.height=d.height||this.height,c.drawImage(e,-d.left||0,-d.top||0);return k},__toDataURLWithMultiplier:function(e,d,k,c){var a=this.getWidth(),b=this.getHeight(),g=a*c,f=b*c,h=this.getActiveObject(),w=this.getActiveGroup(),A=this.contextTop||this.contextContainer;
1<c&&this.setWidth(g).setHeight(f);A.scale(c,c);k.left&&(k.left*=c);k.top&&(k.top*=c);k.width?k.width*=c:1>c&&(k.width=g);k.height?k.height*=c:1>c&&(k.height=f);w?this._tempRemoveBordersControlsFromGroup(w):h&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);e=this.__toDataURL(e,d,k);this.width=a;this.height=b;A.scale(1/c,1/c);this.setWidth(a).setHeight(b);w?this._restoreBordersControlsOnGroup(w):h&&this.setActiveObject&&this.setActiveObject(h);this.contextTop&&this.clearContext(this.contextTop);
this.renderAll();return e},toDataURLWithMultiplier:function(e,d,k){return this.toDataURL({format:e,multiplier:d,quality:k})},_tempRemoveBordersControlsFromGroup:function(e){e.origHasControls=e.hasControls;e.origBorderColor=e.borderColor;e.hasControls=!0;e.borderColor="rgba(0,0,0,0)";e.forEachObject(function(d){d.origBorderColor=d.borderColor;d.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(e){e.hideControls=e.origHideControls;e.borderColor=e.origBorderColor;e.forEachObject(function(d){d.borderColor=
d.origBorderColor;delete d.origBorderColor})}});(function(e){var d=e.fabric||(e.fabric={});e=d.util.object.extend;var k=d.util.toFixed,c=d.util.string.capitalize,a=d.util.degreesToRadians,b=d.StaticCanvas.supports("setLineDash");d.Object||(d.Object=d.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",
centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,
lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||!a.fill.colorStops||
a.fill instanceof d.Gradient||this.set("fill",new d.Gradient(a.fill))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof d.Pattern||this.set("fill",new d.Pattern(a.fill));!a.stroke||!a.stroke.source||a.stroke instanceof d.Pattern||this.set("stroke",new d.Pattern(a.stroke))},_initClipping:function(a){a.clipTo&&"string"===typeof a.clipTo&&(a=d.util.getFunctionBody(a.clipTo),"undefined"!==typeof a&&(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var f in a)this.set(f,
a[f]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(g,f){var b=f?this._getLeftTopCoords():this.getCenterPoint();g.translate(b.x,b.y);g.rotate(a(this.angle));g.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var f=d.Object.NUM_FRACTION_DIGITS,f={type:this.type,originX:this.originX,originY:this.originY,left:k(this.left,f),top:k(this.top,f),width:k(this.width,f),height:k(this.height,f),fill:this.fill&&this.fill.toObject?
this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:k(this.strokeWidth,f),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:k(this.strokeMiterLimit,f),scaleX:k(this.scaleX,f),scaleY:k(this.scaleY,f),angle:k(this.getAngle(),f),flipX:this.flipX,flipY:this.flipY,opacity:k(this.opacity,f),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,
visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};this.includeDefaultValues||(f=this._removeDefaultValues(f));d.util.populateWithProperties(this,f,a);return f},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var f=d.util.getKlass(a.type).prototype;f.stateProperties.forEach(function(b){a[b]===f[b]&&delete a[b]});return a},toString:function(){return"#<fabric."+
c(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var f in a)this._set(f,a[f])},set:function(a,f){"object"===typeof a?this._setObject(a):"function"===typeof f&&"clipTo"!==a?this._set(a,f(this.get(a))):this._set(a,f);return this},_set:function(a,f){if("scaleX"===a||"scaleY"===a)f=this._constrainScale(f);"scaleX"===a&&0>f?(this.flipX=!this.flipX,f*=-1):"scaleY"===a&&0>f?(this.flipY=!this.flipY,f*=-1):"width"===a||"height"===a?this.minScaleLimit=k(Math.min(.1,1/Math.max(this.width,
this.height)),2):"shadow"!==a||!f||f instanceof d.Shadow||(f=new d.Shadow(f));this[a]=f;return this},toggle:function(a){var f=this.get(a);"boolean"===typeof f&&this.set(a,!f);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(a,f){0===this.width&&0===this.height||!this.visible||(a.save(),this._setupCompositeOperation(a),f||this.transform(a),
this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&d.util.clipContext(this,a),this._render(a,f),this.clipTo&&a.restore(),this._removeShadow(a),this._restoreCompositeOperation(a),a.restore())},_setOpacity:function(a){this.group&&this.group._setOpacity(a);a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=
this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_renderControls:function(g,f){if(this.active&&!f){var b=this.getViewportTransform();g.save();var c;this.group&&(c=d.util.transformPoint(this.group.getCenterPoint(),b),g.translate(c.x,c.y),g.rotate(a(this.group.angle)));c=d.util.transformPoint(this.getCenterPoint(),b,
null!=this.group);this.group&&(c.x*=this.group.scaleX,c.y*=this.group.scaleY);g.translate(c.x,c.y);g.rotate(a(this.angle));this.drawBorders(g);this.drawControls(g);g.restore()}},_setShadow:function(a){if(this.shadow){var f=this.canvas&&this.canvas.viewportTransform[0]||1,b=this.canvas&&this.canvas.viewportTransform[3]||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*(f+b)*(this.scaleX+this.scaleY)/4;a.shadowOffsetX=this.shadow.offsetX*f*this.scaleX;a.shadowOffsetY=this.shadow.offsetY*
b*this.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&(a.save(),this.fill.gradientTransform&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&
0!==this.strokeWidth&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),b?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?this._stroke(a):a.stroke()),this._removeShadow(a),a.restore())},clone:function(a,f){return this.constructor.fromObject?
this.constructor.fromObject(this.toObject(f),a):new d.Object(this.toObject(f))},cloneAsImage:function(a){var f=this.toDataURL();d.util.loadImage(f,function(f){a&&a(new d.Image(f))});return this},toDataURL:function(a){a||(a={});var f=d.util.createCanvasElement(),b=this.getBoundingRect();f.width=b.width;f.height=b.height;d.util.wrapElement(f,"div");b=new d.StaticCanvas(f);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(b.backgroundColor="#fff");var c={active:this.get("active"),left:this.getLeft(),
top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new d.Point(f.width/2,f.height/2),"center","center");f=this.canvas;b.add(this);a=b.toDataURL(a);this.set(c).setCoords();this.canvas=f;b.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,f){f||(f={});var b={colorStops:[]};b.type=f.type||(f.r1||f.r2?"radial":"linear");b.coords={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2};if(f.r1||f.r2)b.coords.r1=
f.r1,b.coords.r2=f.r2;for(var c in f.colorStops){var e=new d.Color(f.colorStops[c]);b.colorStops.push({offset:c,color:e.toRgb(),opacity:e.getAlpha()})}return this.set(a,d.Gradient.forObject(this,b))},setPatternFill:function(a){return this.set("fill",new d.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new d.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var f=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;f&&this._setOriginToCenter();
this.set("angle",a);f&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,f){f=f||this.canvas.getPointer(a);var b=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:f.x-b.x,y:f.y-b.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&
(this._prevGlobalCompositeOperation=a.globalCompositeOperation,a.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(a){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(a.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),d.util.createAccessors(d.Object),d.Object.prototype.rotate=d.Object.prototype.setAngle,e(d.Object.prototype,d.Observable),d.Object.NUM_FRACTION_DIGITS=2,d.Object.__uid=0)})("undefined"!==typeof e?e:this);(function(){var e=
h.util.degreesToRadians;h.util.object.extend(h.Object.prototype,{translateToCenterPoint:function(d,k,c){var a=d.x,b=d.y,g=this.stroke?this.strokeWidth:0;"left"===k?a=d.x+(this.getWidth()+g*this.scaleX)/2:"right"===k&&(a=d.x-(this.getWidth()+g*this.scaleX)/2);"top"===c?b=d.y+(this.getHeight()+g*this.scaleY)/2:"bottom"===c&&(b=d.y-(this.getHeight()+g*this.scaleY)/2);return h.util.rotatePoint(new h.Point(a,b),d,e(this.angle))},translateToOriginPoint:function(d,k,c){var a=d.x,b=d.y,g=this.stroke?this.strokeWidth:
0;"left"===k?a=d.x-(this.getWidth()+g*this.scaleX)/2:"right"===k&&(a=d.x+(this.getWidth()+g*this.scaleX)/2);"top"===c?b=d.y-(this.getHeight()+g*this.scaleY)/2:"bottom"===c&&(b=d.y+(this.getHeight()+g*this.scaleY)/2);return h.util.rotatePoint(new h.Point(a,b),d,e(this.angle))},getCenterPoint:function(){var d=new h.Point(this.left,this.top);return this.translateToCenterPoint(d,this.originX,this.originY)},getPointByOrigin:function(d,e){var c=this.getCenterPoint();return this.translateToOriginPoint(c,
d,e)},toLocalPoint:function(d,k,c){var a=this.getCenterPoint(),b=this.stroke?this.strokeWidth:0;k&&c?(k="left"===k?a.x-(this.getWidth()+b*this.scaleX)/2:"right"===k?a.x+(this.getWidth()+b*this.scaleX)/2:a.x,c="top"===c?a.y-(this.getHeight()+b*this.scaleY)/2:"bottom"===c?a.y+(this.getHeight()+b*this.scaleY)/2:a.y):(k=this.left,c=this.top);return h.util.rotatePoint(new h.Point(d.x,d.y),a,-e(this.angle)).subtractEquals(new h.Point(k,c))},setPositionByOrigin:function(d,e,c){d=this.translateToCenterPoint(d,
e,c);d=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",d.x);this.set("top",d.y)},adjustPosition:function(d){var k=e(this.angle),c=this.getWidth()/2,a=Math.cos(k)*c,c=Math.sin(k)*c,b=this.getWidth(),g=Math.cos(k)*b,k=Math.sin(k)*b;"center"===this.originX&&"left"===d||"right"===this.originX&&"center"===d?(this.left-=a,this.top-=c):"left"===this.originX&&"center"===d||"center"===this.originX&&"right"===d?(this.left+=a,this.top+=c):"left"===this.originX&&"right"===d?(this.left+=
g,this.top+=k):"right"===this.originX&&"left"===d&&(this.left-=g,this.top-=k);this.setCoords();this.originX=d},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var d=this.getCenterPoint();this.originY=this.originX="center";this.left=d.x;this.top=d.y},_resetOrigin:function(){var d=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=
d.x;this.top=d.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var e=h.util.degreesToRadians;h.util.object.extend(h.Object.prototype,{oCoords:null,intersectsWithRect:function(d,e){var c=this.oCoords,a=new h.Point(c.tl.x,c.tl.y),b=new h.Point(c.tr.x,c.tr.y),g=new h.Point(c.bl.x,c.bl.y),c=new h.Point(c.br.x,c.br.y);return"Intersection"===h.Intersection.intersectPolygonRectangle([a,
b,c,g],d,e).status},intersectsWithObject:function(d){function e(a){return{tl:new h.Point(a.tl.x,a.tl.y),tr:new h.Point(a.tr.x,a.tr.y),bl:new h.Point(a.bl.x,a.bl.y),br:new h.Point(a.br.x,a.br.y)}}var c=e(this.oCoords);d=e(d.oCoords);return"Intersection"===h.Intersection.intersectPolygonPolygon([c.tl,c.tr,c.br,c.bl],[d.tl,d.tr,d.br,d.bl]).status},isContainedWithinObject:function(d){var e=d.getBoundingRect();d=new h.Point(e.left,e.top);e=new h.Point(e.left+e.width,e.top+e.height);return this.isContainedWithinRect(d,
e)},isContainedWithinRect:function(d,e){var c=this.getBoundingRect();return c.left>=d.x&&c.left+c.width<=e.x&&c.top>=d.y&&c.top+c.height<=e.y},containsPoint:function(d){var e=this._getImageLines(this.oCoords);d=this._findCrossPoints(d,e);return 0!==d&&1===d%2},_getImageLines:function(d){return{topline:{o:d.tl,d:d.tr},rightline:{o:d.tr,d:d.br},bottomline:{o:d.br,d:d.bl},leftline:{o:d.bl,d:d.tl}}},_findCrossPoints:function(d,e){var c,a,b,g=0,f;for(f in e)if(b=e[f],!(b.o.y<d.y&&b.d.y<d.y||b.o.y>=d.y&&
b.d.y>=d.y)&&(b.o.x===b.d.x&&b.o.x>=d.x?c=b.o.x:(c=(b.d.y-b.o.y)/(b.d.x-b.o.x),a=d.y-0*d.x,b=b.o.y-c*b.o.x,c=-(a-b)/(0-c)),c>=d.x&&(g+=1),2===g))break;return g},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var d=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],e=h.util.array.min(d),d=h.util.array.max(d),d=Math.abs(e-d),c=
[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],a=h.util.array.min(c),c=h.util.array.max(c);return{left:e,top:a,width:d,height:Math.abs(a-c)}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(d){return Math.abs(d)<this.minScaleLimit?0>d?-this.minScaleLimit:this.minScaleLimit:d},scale:function(d){d=this._constrainScale(d);0>d&&(this.flipX=!this.flipX,this.flipY=!this.flipY,d*=-1);this.scaleY=this.scaleX=
d;this.setCoords();return this},scaleToWidth:function(d){var e=this.getBoundingRectWidth()/this.getWidth();return this.scale(d/this.width/e)},scaleToHeight:function(d){var e=this.getBoundingRectHeight()/this.getHeight();return this.scale(d/this.height/e)},setCoords:function(){var d=e(this.angle),k=this.getViewportTransform(),c=function(a){return h.util.transformPoint(a,k)},a=this._calculateCurrentDimensions(!1),b=a.x,g=a.y;0>b&&(b=Math.abs(b));var a=Math.sqrt(Math.pow(b/2,2)+Math.pow(g/2,2)),f=Math.atan(isFinite(g/
b)?g/b:0),p=Math.cos(f+d)*a,f=Math.sin(f+d)*a,a=Math.sin(d),d=Math.cos(d),w=this.getCenterPoint(),g=new h.Point(b,g),w=new h.Point(w.x-p,w.y-f),f=new h.Point(w.x+g.x*d,w.y+g.x*a),b=c(new h.Point(w.x-g.y*a,w.y+g.y*d)),p=c(new h.Point(f.x-g.y*a,f.y+g.y*d)),g=c(w),c=c(f),f=new h.Point((g.x+b.x)/2,(g.y+b.y)/2),w=new h.Point((c.x+g.x)/2,(c.y+g.y)/2),A=new h.Point((p.x+c.x)/2,(p.y+c.y)/2),l=new h.Point((p.x+b.x)/2,(p.y+b.y)/2),a=new h.Point(w.x+a*this.rotatingPointOffset,w.y-d*this.rotatingPointOffset);
this.oCoords={tl:g,tr:c,br:p,bl:b,ml:f,mt:w,mr:A,mb:l,mtr:a};this._setCornerCoords&&this._setCornerCoords();return this}})})();h.util.object.extend(h.Object.prototype,{sendToBack:function(){this.group?h.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?h.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(e){this.group?h.StaticCanvas.prototype.sendBackwards.call(this.group,
this,e):this.canvas.sendBackwards(this,e);return this},bringForward:function(e){this.group?h.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e);return this},moveTo:function(e){this.group?h.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e);return this}});h.util.object.extend(h.Object.prototype,{getSvgStyles:function(){var e=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",d=this.fillRule,k=this.stroke?
this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",c=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",k,"; stroke-width: ",c,"; stroke-dasharray: ",a,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",e,"; fill-rule: ",d,"; opacity: ","undefined"!==
typeof this.opacity?this.opacity:"1",";",this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var e=h.util.toFixed,d=this.getAngle(),k=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],c=h.util.transformPoint(this.getCenterPoint(),k),a=h.Object.NUM_FRACTION_DIGITS,c="path-group"===this.type?"":"translate("+e(c.x,a)+" "+
e(c.y,a)+")",d=0!==d?" rotate("+e(d,a)+")":"",e=1===this.scaleX&&1===this.scaleY&&1===k[0]&&1===k[3]?"":" scale("+e(this.scaleX*k[0],a)+" "+e(this.scaleY*k[3],a)+")",a="path-group"===this.type?this.width*k[0]:0,k="path-group"===this.type?this.height*k[3]:0;return[c,d,e,this.flipX?" matrix(-1 0 0 1 "+a+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+k+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var e=
[];this.fill&&this.fill.toLive&&e.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&e.push(this.stroke.toSVG(this,!1));this.shadow&&e.push(this.shadow.toSVG(this));return e}});h.util.object.extend(h.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(e){return this.get(e)!==this.originalState[e]},this)},saveState:function(e){this.stateProperties.forEach(function(d){this.originalState[d]=this.get(d)},this);e&&e.stateProperties&&e.stateProperties.forEach(function(d){this.originalState[d]=
this.get(d)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var e=h.util.degreesToRadians;h.util.object.extend(h.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(d){if(!this.hasControls||!this.active)return!1;var e=d.x;d=d.y;var c,a;for(a in this.oCoords)if(this.isControlVisible(a)&&("mtr"!==a||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==a&&"mr"!==a&&"mb"!==a&&"ml"!==a)&&(c=this._getImageLines(this.oCoords[a].corner),
c=this._findCrossPoints({x:e,y:d},c),0!==c&&1===c%2))return this.__corner=a;return!1},_setCornerCoords:function(){var d=this.oCoords,k=e(45-this.angle),c=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,a=c*Math.cos(k),k=c*Math.sin(k),b,g;for(g in d)c=d[g].x,b=d[g].y,d[g].corner={tl:{x:c-k,y:b-a},tr:{x:c+a,y:b-k},bl:{x:c-a,y:b+k},br:{x:c+k,y:b+a}}},_calculateCurrentDimensions:function(d){var e=this.getViewportTransform(),c=this.strokeWidth,a=this.width,b=this.height,g="round"===this.strokeLineCap||"square"===
this.strokeLineCap,f="line"===this.type&&0===this.width,p="line"===this.type&&0===this.height,w=f||p;f?a=c:p&&(b=c);(g&&p||!w)&&(a+=0>a?-c:c);(g&&f||!w)&&(b+=0>b?-c:c);a=a*this.scaleX+2*this.padding;b=b*this.scaleY+2*this.padding;return d?h.util.transformPoint(new h.Point(a,b),e,!0):{x:a,y:b}},drawBorders:function(d){if(!this.hasBorders)return this;d.save();d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;d.strokeStyle=this.borderColor;d.lineWidth=1/this.borderScaleFactor;var e=this._calculateCurrentDimensions(!0),
c=e.x,e=e.y;this.group&&(c*=this.group.scaleX,e*=this.group.scaleY);d.strokeRect(~~-(c/2)-.5,~~-(e/2)-.5,~~c+1,~~e+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(c=-e/2,d.beginPath(),d.moveTo(0,c),d.lineTo(0,c-this.rotatingPointOffset),d.closePath(),d.stroke());d.restore();return this},drawControls:function(d){if(!this.hasControls)return this;var e=this._calculateCurrentDimensions(!0),c=e.x,e=e.y,a=-(c/2),b=-(e/2),g=this.cornerSize/2,f=this.transparentCorners?
"strokeRect":"fillRect";d.save();d.lineWidth=1;d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;d.strokeStyle=d.fillStyle=this.cornerColor;this._drawControl("tl",d,f,a-g,b-g);this._drawControl("tr",d,f,a+c-g,b-g);this._drawControl("bl",d,f,a-g,b+e-g);this._drawControl("br",d,f,a+c-g,b+e-g);this.get("lockUniScaling")||(this._drawControl("mt",d,f,a+c/2-g,b-g),this._drawControl("mb",d,f,a+c/2-g,b+e-g),this._drawControl("mr",d,f,a+c-g,b+e/2-g),this._drawControl("ml",d,f,a-g,b+e/2-g));this.hasRotatingPoint&&
this._drawControl("mtr",d,f,a+c/2-g,b-this.rotatingPointOffset-g);d.restore();return this},_drawControl:function(d,e,c,a,b){this.isControlVisible(d)&&(d=this.cornerSize,"undefined"!==typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(a,b,d,d),e[c](a,b,d,d))},isControlVisible:function(d){return this._getControlsVisibility()[d]},setControlVisible:function(d,e){this._getControlsVisibility()[d]=e;return this},setControlsVisibility:function(d){d||(d={});for(var e in d)this.setControlVisible(e,
d[e]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();(function(e){function d(a,f){var b=a.origin,c=a.axis1,d=a.axis2,e=a.dimension,k=f.nearest,h=f.center,l=f.farthest;return function(){switch(this.get(b)){case k:return Math.min(this.get(c),this.get(d));case h:return Math.min(this.get(c),this.get(d))+.5*this.get(e);case l:return Math.max(this.get(c),this.get(d))}}}
var k=e.fabric||(e.fabric={}),c=k.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},b=k.StaticCanvas.supports("setLineDash");k.Line?k.warn("fabric.Line is already defined"):(k.Line=k.util.createClass(k.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,f){f=f||{};a||(a=[0,0,0,0]);this.callSuper("initialize",f);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(f)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=
Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(b,f){this.callSuper("_set",b,f);"undefined"!==typeof a[b]&&this._setWidthHeight();return this},_getLeftToOriginX:d({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:d({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,
f){a.beginPath();if(f){var c=this.getCenterPoint();a.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&b)c=this.calcLinePoints(),a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2);a.lineWidth=this.strokeWidth;c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=c},_renderDashedStroke:function(a){var f=this.calcLinePoints();a.beginPath();k.util.drawDashedLine(a,f.x1,f.y1,f.x2,f.y2,this.strokeDashArray);a.closePath()},
toObject:function(a){return c(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,f=this.y1<=this.y2?-1:1;return{x1:a*this.width*.5,x2:a*this.width*-.5,y1:f*this.height*.5,y2:f*this.height*-.5}},toSVG:function(a){var f=this._createBaseSVGMarkup(),b={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||(b=this.calcLinePoints());f.push("<line ",'x1="',b.x1,'" y1="',b.y1,'" x2="',b.x2,'" y2="',b.y2,'" style="',
this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(f.join("")):f.join("")},complexity:function(){return 1}}),k.Line.ATTRIBUTE_NAMES=k.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),k.Line.fromElement=function(a,f){var b=k.parseAttributes(a,k.Line.ATTRIBUTE_NAMES);return new k.Line([b.x1||0,b.y1||0,b.x2||0,b.y2||0],c(b,f))},k.Line.fromObject=function(a){return new k.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof e?e:this);(function(e){var d=
e.fabric||(e.fabric={}),k=Math.PI,c=d.util.object.extend;d.Circle?d.warn("fabric.Circle is already defined."):(d.Circle=d.util.createClass(d.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*k,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){this.callSuper("_set",a,b);"radius"===a&&this.setRadius(b);return this},toObject:function(a){return c(this.callSuper("toObject",
a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var b=this._createBaseSVGMarkup(),g=0,f=0,c=(this.endAngle-this.startAngle)%(2*k);0===c?(this.group&&"path-group"===this.group.type&&(g=this.left+this.radius,f=this.top+this.radius),b.push("<circle ",'cx="'+g+'" cy="'+f+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')):b.push('<path d="M '+Math.cos(this.startAngle)*
this.radius+" "+Math.sin(this.startAngle)*this.radius," A "+this.radius+" "+this.radius," 0 ",+(c>k?1:0)+" 1"," "+Math.cos(this.endAngle)*this.radius+" "+Math.sin(this.endAngle)*this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},
getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),d.Circle.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),d.Circle.fromElement=function(a,b){b||(b={});var g=d.parseAttributes(a,d.Circle.ATTRIBUTE_NAMES);if(!("radius"in g&&0<=g.radius))throw Error("value of `r` attribute is required and can not be negative");
g.left=g.left||0;g.top=g.top||0;g=new d.Circle(c(g,b));g.left-=g.radius;g.top-=g.radius;return g},d.Circle.fromObject=function(a){return new d.Circle(a)})})("undefined"!==typeof e?e:this);(function(e){var d=e.fabric||(e.fabric={});d.Triangle?d.warn("fabric.Triangle is already defined"):(d.Triangle=d.util.createClass(d.Object,{type:"triangle",initialize:function(d){d=d||{};this.callSuper("initialize",d);this.set("width",d.width||100).set("height",d.height||100)},_render:function(d){var c=this.width/
2,a=this.height/2;d.beginPath();d.moveTo(-c,a);d.lineTo(0,-a);d.lineTo(c,a);d.closePath();this._renderFill(d);this._renderStroke(d)},_renderDashedStroke:function(e){var c=this.width/2,a=this.height/2;e.beginPath();d.util.drawDashedLine(e,-c,a,0,-a,this.strokeDashArray);d.util.drawDashedLine(e,0,-a,c,a,this.strokeDashArray);d.util.drawDashedLine(e,c,a,-c,a,this.strokeDashArray);e.closePath()},toSVG:function(d){var c=this._createBaseSVGMarkup(),a=this.width/2,b=this.height/2,a=[-a+" "+b,"0 "+-b,a+" "+
b].join();c.push("<polygon ",'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return d?d(c.join("")):c.join("")},complexity:function(){return 1}}),d.Triangle.fromObject=function(e){return new d.Triangle(e)})})("undefined"!==typeof e?e:this);(function(e){var d=e.fabric||(e.fabric={}),k=2*Math.PI,c=d.util.object.extend;d.Ellipse?d.warn("fabric.Ellipse is already defined."):(d.Ellipse=d.util.createClass(d.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=
a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){this.callSuper("_set",a,b);switch(a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return c(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),
g=0,f=0;this.group&&"path-group"===this.group.type&&(g=this.left+this.rx,f=this.top+this.ry);b.push("<ellipse ",'cx="',g,'" cy="',f,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,k,!1);a.restore();this._renderFill(a);
this._renderStroke(a)},complexity:function(){return 1}}),d.Ellipse.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),d.Ellipse.fromElement=function(a,b){b||(b={});var g=d.parseAttributes(a,d.Ellipse.ATTRIBUTE_NAMES);g.left=g.left||0;g.top=g.top||0;g=new d.Ellipse(c(g,b));g.top-=g.ry;g.left-=g.rx;return g},d.Ellipse.fromObject=function(a){return new d.Ellipse(a)})})("undefined"!==typeof e?e:this);(function(e){var d=e.fabric||(e.fabric={}),k=d.util.object.extend;d.Rect?console.warn("fabric.Rect is already defined"):
(e=d.Object.prototype.stateProperties.concat(),e.push("rx","ry","x","y"),d.Rect=d.util.createClass(d.Object,{stateProperties:e,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(c){c=c||{};this.callSuper("initialize",c);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(c,a){if(1===this.width&&1===this.height)c.fillRect(0,0,1,1);else{var b=this.rx?Math.min(this.rx,this.width/2):0,g=this.ry?Math.min(this.ry,this.height/
2):0,f=this.width,d=this.height,e=a?this.left:-this.width/2,k=a?this.top:-this.height/2,h=0!==b||0!==g;c.beginPath();c.moveTo(e+b,k);c.lineTo(e+f-b,k);h&&c.bezierCurveTo(e+f-.4477152502*b,k,e+f,k+.4477152502*g,e+f,k+g);c.lineTo(e+f,k+d-g);h&&c.bezierCurveTo(e+f,k+d-.4477152502*g,e+f-.4477152502*b,k+d,e+f-b,k+d);c.lineTo(e+b,k+d);h&&c.bezierCurveTo(e+.4477152502*b,k+d,e,k+d-.4477152502*g,e,k+d-g);c.lineTo(e,k+g);h&&c.bezierCurveTo(e,k+.4477152502*g,e+.4477152502*b,k,e+b,k);c.closePath();this._renderFill(c);
this._renderStroke(c)}},_renderDashedStroke:function(c){var a=-this.width/2,b=-this.height/2,g=this.width,f=this.height;c.beginPath();d.util.drawDashedLine(c,a,b,a+g,b,this.strokeDashArray);d.util.drawDashedLine(c,a+g,b,a+g,b+f,this.strokeDashArray);d.util.drawDashedLine(c,a+g,b+f,a,b+f,this.strokeDashArray);d.util.drawDashedLine(c,a,b+f,a,b,this.strokeDashArray);c.closePath()},toObject:function(c){c=k(this.callSuper("toObject",c),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||
this._removeDefaultValues(c);return c},toSVG:function(c){var a=this._createBaseSVGMarkup(),b=this.left,g=this.top;this.group&&"path-group"===this.group.type||(b=-this.width/2,g=-this.height/2);a.push("<rect ",'x="',b,'" y="',g,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return c?c(a.join("")):a.join("")},complexity:function(){return 1}}),
d.Rect.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),d.Rect.fromElement=function(c,a){if(!c)return null;a=a||{};var b=d.parseAttributes(c,d.Rect.ATTRIBUTE_NAMES);b.left=b.left||0;b.top=b.top||0;b=new d.Rect(k(a?d.util.object.clone(a):{},b));b.visible=0<b.width&&0<b.height;return b},d.Rect.fromObject=function(c){return new d.Rect(c)})})("undefined"!==typeof e?e:this);(function(e){var d=e.fabric||(e.fabric={});d.Polyline?d.warn("fabric.Polyline is already defined"):
(d.Polyline=d.util.createClass(d.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(e,c){return d.Polygon.prototype.initialize.call(this,e,c)},_calcDimensions:function(){return d.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return d.Polygon.prototype._applyPointOffset.call(this)},toObject:function(e){return d.Polygon.prototype.toObject.call(this,e)},toSVG:function(e){return d.Polygon.prototype.toSVG.call(this,e)},_render:function(e){d.Polygon.prototype.commonRender.call(this,
e)&&(this._renderFill(e),this._renderStroke(e))},_renderDashedStroke:function(e){var c,a;e.beginPath();for(var b=0,g=this.points.length;b<g;b++)c=this.points[b],a=this.points[b+1]||c,d.util.drawDashedLine(e,c.x,c.y,a.x,a.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),d.Polyline.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(),d.Polyline.fromElement=function(e,c){if(!e)return null;c||(c={});var a=d.parsePointsAttribute(e.getAttribute("points")),b=d.parseAttributes(e,
d.Polyline.ATTRIBUTE_NAMES);return new d.Polyline(a,d.util.object.extend(b,c))},d.Polyline.fromObject=function(e){return new d.Polyline(e.points,e,!0)})})("undefined"!==typeof e?e:this);(function(e){var d=e.fabric||(e.fabric={}),k=d.util.object.extend,c=d.util.array.min,a=d.util.array.max,b=d.util.toFixed;d.Polygon?d.warn("fabric.Polygon is already defined"):(d.Polygon=d.util.createClass(d.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,f){f=f||{};this.points=a||[];this.callSuper("initialize",
f);this._calcDimensions();"top"in f||(this.top=this.minY);"left"in f||(this.left=this.minX)},_calcDimensions:function(){var b=this.points,f=c(b,"x"),d=c(b,"y"),e=a(b,"x"),b=a(b,"y");this.width=e-f||0;this.height=b-d||0;this.minX=f||0;this.minY=d||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return k(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var f=[],c=this._createBaseSVGMarkup(),
d=0,e=this.points.length;d<e;d++)f.push(b(this.points[d].x,2),",",b(this.points[d].y,2)," ");c.push("<",this.type," ",'points="',f.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a)&&(this._renderFill(a),this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},commonRender:function(a){var f,b=this.points.length;if(!b||isNaN(this.points[b-
1].y))return!1;a.beginPath();this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);a.moveTo(this.points[0].x,this.points[0].y);for(var c=0;c<b;c++)f=this.points[c],a.lineTo(f.x,f.y);return!0},_renderDashedStroke:function(a){d.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),d.Polygon.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(),d.Polygon.fromElement=function(a,
f){if(!a)return null;f||(f={});var b=d.parsePointsAttribute(a.getAttribute("points")),c=d.parseAttributes(a,d.Polygon.ATTRIBUTE_NAMES);return new d.Polygon(b,k(c,f))},d.Polygon.fromObject=function(a){return new d.Polygon(a.points,a,!0)})})("undefined"!==typeof e?e:this);(function(e){var d=e.fabric||(e.fabric={}),k=d.util.array.min,c=d.util.array.max,a=d.util.object.extend,b=Object.prototype.toString,g=d.util.drawArc,f={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"};d.Path?d.warn("fabric.Path is already defined"):
(d.Path=d.util.createClass(d.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,f){f=f||{};this.setOptions(f);if(!a)throw Error("`path` argument is required");var c="[object Array]"===b.call(a);if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))c||(this.path=this._parsePath()),this._setPositionDimensions(),f.sourcePath&&this.setSourcePath(f.sourcePath)},_setPositionDimensions:function(){var a=this._parseDimensions();this.minX=a.left;this.minY=a.top;this.width=a.width;
this.height=a.height;a.left+="center"===this.originX?this.width/2:"right"===this.originX?this.width:0;a.top+="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0;this.top=this.top||a.top;this.left=this.left||a.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var f,b=null,c=0,d=0,e=0,k=0,h=0,l=0,p,m,n=-this.pathOffset.x,r=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(r=n=0);a.beginPath();for(var q=
0,t=this.path.length;q<t;++q){f=this.path[q];switch(f[0]){case "l":e+=f[1];k+=f[2];a.lineTo(e+n,k+r);break;case "L":e=f[1];k=f[2];a.lineTo(e+n,k+r);break;case "h":e+=f[1];a.lineTo(e+n,k+r);break;case "H":e=f[1];a.lineTo(e+n,k+r);break;case "v":k+=f[1];a.lineTo(e+n,k+r);break;case "V":k=f[1];a.lineTo(e+n,k+r);break;case "m":e+=f[1];k+=f[2];c=e;d=k;a.moveTo(e+n,k+r);break;case "M":e=f[1];k=f[2];c=e;d=k;a.moveTo(e+n,k+r);break;case "c":p=e+f[5];m=k+f[6];h=e+f[3];l=k+f[4];a.bezierCurveTo(e+f[1]+n,k+f[2]+
r,h+n,l+r,p+n,m+r);e=p;k=m;break;case "C":e=f[5];k=f[6];h=f[3];l=f[4];a.bezierCurveTo(f[1]+n,f[2]+r,h+n,l+r,e+n,k+r);break;case "s":p=e+f[3];m=k+f[4];null===b[0].match(/[CcSs]/)?(h=e,l=k):(h=2*e-h,l=2*k-l);a.bezierCurveTo(h+n,l+r,e+f[1]+n,k+f[2]+r,p+n,m+r);h=e+f[1];l=k+f[2];e=p;k=m;break;case "S":p=f[3];m=f[4];null===b[0].match(/[CcSs]/)?(h=e,l=k):(h=2*e-h,l=2*k-l);a.bezierCurveTo(h+n,l+r,f[1]+n,f[2]+r,p+n,m+r);e=p;k=m;h=f[1];l=f[2];break;case "q":p=e+f[3];m=k+f[4];h=e+f[1];l=k+f[2];a.quadraticCurveTo(h+
n,l+r,p+n,m+r);e=p;k=m;break;case "Q":p=f[3];m=f[4];a.quadraticCurveTo(f[1]+n,f[2]+r,p+n,m+r);e=p;k=m;h=f[1];l=f[2];break;case "t":p=e+f[1];m=k+f[2];null===b[0].match(/[QqTt]/)?(h=e,l=k):(h=2*e-h,l=2*k-l);a.quadraticCurveTo(h+n,l+r,p+n,m+r);e=p;k=m;break;case "T":p=f[1];m=f[2];null===b[0].match(/[QqTt]/)?(h=e,l=k):(h=2*e-h,l=2*k-l);a.quadraticCurveTo(h+n,l+r,p+n,m+r);e=p;k=m;break;case "a":g(a,e+n,k+r,[f[1],f[2],f[3],f[4],f[5],f[6]+e+n,f[7]+k+r]);e+=f[6];k+=f[7];break;case "A":g(a,e+n,k+r,[f[1],f[2],
f[3],f[4],f[5],f[6]+n,f[7]+r]);e=f[6];k=f[7];break;case "z":case "Z":e=c,k=d,a.closePath()}b=f}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(f){f=a(this.callSuper("toObject",f),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(f.sourcePath=this.sourcePath);this.transformMatrix&&(f.transformMatrix=this.transformMatrix);return f},
toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var f=[],b=this._createBaseSVGMarkup(),c="",d=0,g=this.path.length;d<g;d++)f.push(this.path[d].join(" "));f=f.join(" ");this.group&&"path-group"===this.group.type||(c=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");b.push("<path ",'d="',f,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),c,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',
"/>\n");return a?a(b.join("")):b.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,d,g=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,e,k=0,l=this.path.length;k<l;k++){c=this.path[k];e=c.slice(1).trim();for(b.length=0;d=g.exec(e);)b.push(d[0]);c=[c.charAt(0)];e=0;for(var m=b.length;e<m;e++)d=parseFloat(b[e]),isNaN(d)||c.push(d);d=c[0];e=f[d.toLowerCase()];m=h[d]||d;if(c.length-1>e)for(var n=1,q=c.length;n<q;n+=e)a.push([d].concat(c.slice(n,n+
e))),d=m;else a.push(c)}return a},_parseDimensions:function(){for(var a=[],f=[],b,g=null,e=0,h=0,l=0,p=0,m=0,n=0,q,t,r,u=0,y=this.path.length;u<y;++u){b=this.path[u];switch(b[0]){case "l":l+=b[1];p+=b[2];r=[];break;case "L":l=b[1];p=b[2];r=[];break;case "h":l+=b[1];r=[];break;case "H":l=b[1];r=[];break;case "v":p+=b[1];r=[];break;case "V":p=b[1];r=[];break;case "m":l+=b[1];p+=b[2];e=l;h=p;r=[];break;case "M":l=b[1];p=b[2];e=l;h=p;r=[];break;case "c":q=l+b[5];t=p+b[6];m=l+b[3];n=p+b[4];r=d.util.getBoundsOfCurve(l,
p,l+b[1],p+b[2],m,n,q,t);l=q;p=t;break;case "C":l=b[5];p=b[6];m=b[3];n=b[4];r=d.util.getBoundsOfCurve(l,p,b[1],b[2],m,n,l,p);break;case "s":q=l+b[3];t=p+b[4];null===g[0].match(/[CcSs]/)?(m=l,n=p):(m=2*l-m,n=2*p-n);r=d.util.getBoundsOfCurve(l,p,m,n,l+b[1],p+b[2],q,t);m=l+b[1];n=p+b[2];l=q;p=t;break;case "S":q=b[3];t=b[4];null===g[0].match(/[CcSs]/)?(m=l,n=p):(m=2*l-m,n=2*p-n);r=d.util.getBoundsOfCurve(l,p,m,n,b[1],b[2],q,t);l=q;p=t;m=b[1];n=b[2];break;case "q":q=l+b[3];t=p+b[4];m=l+b[1];n=p+b[2];r=
d.util.getBoundsOfCurve(l,p,m,n,m,n,q,t);l=q;p=t;break;case "Q":m=b[1];n=b[2];r=d.util.getBoundsOfCurve(l,p,m,n,m,n,b[3],b[4]);l=b[3];p=b[4];break;case "t":q=l+b[1];t=p+b[2];null===g[0].match(/[QqTt]/)?(m=l,n=p):(m=2*l-m,n=2*p-n);r=d.util.getBoundsOfCurve(l,p,m,n,m,n,q,t);l=q;p=t;break;case "T":q=b[1];t=b[2];null===g[0].match(/[QqTt]/)?(m=l,n=p):(m=2*l-m,n=2*p-n);r=d.util.getBoundsOfCurve(l,p,m,n,m,n,q,t);l=q;p=t;break;case "a":r=d.util.getBoundsOfArc(l,p,b[1],b[2],b[3],b[4],b[5],b[6]+l,b[7]+p);l+=
b[6];p+=b[7];break;case "A":r=d.util.getBoundsOfArc(l,p,b[1],b[2],b[3],b[4],b[5],b[6],b[7]);l=b[6];p=b[7];break;case "z":case "Z":l=e,p=h}g=b;r.forEach(function(b){a.push(b.x);f.push(b.y)});a.push(l);f.push(p)}b=k(a);g=k(f);e=c(a);h=c(f);return{left:b,top:g,width:e-b,height:h-g}}}),d.Path.fromObject=function(a,f){"string"===typeof a.path?d.loadSVGFromURL(a.path,function(b){b=b[0];var c=a.path;delete a.path;d.util.object.extend(b,a);b.setSourcePath(c);f(b)}):f(new d.Path(a.path,a))},d.Path.ATTRIBUTE_NAMES=
d.SHARED_ATTRIBUTES.concat(["d"]),d.Path.fromElement=function(f,b,c){f=d.parseAttributes(f,d.Path.ATTRIBUTE_NAMES);b&&b(new d.Path(f.d,a(f,c)))},d.Path.async=!0)})("undefined"!==typeof e?e:this);(function(e){var d=e.fabric||(e.fabric={}),k=d.util.object.extend,c=d.util.array.invoke,a=d.Object.prototype.toObject;d.PathGroup?d.warn("fabric.PathGroup is already defined"):(d.PathGroup=d.util.createClass(d.Path,{type:"path-group",fill:"",initialize:function(a,c){c=c||{};this.paths=a||[];for(var f=this.paths.length;f--;)this.paths[f].group=
this;c.toBeParsed&&(this.parseDimensionsFromPaths(c),delete c.toBeParsed);this.setOptions(c);this.setCoords();c.sourcePath&&this.setSourcePath(c.sourcePath)},parseDimensionsFromPaths:function(a){for(var c,f,e=[],k=[],h,l=this.transformMatrix,m=this.paths.length;m--;)for(c=this.paths[m],f=c.height+c.strokeWidth,h=c.width+c.strokeWidth,c=[{x:c.left,y:c.top},{x:c.left+h,y:c.top},{x:c.left,y:c.top+f},{x:c.left+h,y:c.top+f}],h=0;h<c.length;h++)f=c[h],l&&(f=d.util.transformPoint(f,l,!1)),e.push(f.x),k.push(f.y);
a.width=Math.max.apply(null,e);a.height=Math.max.apply(null,k)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&d.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var c=0,f=this.paths.length;c<f;++c)this.paths[c].render(a,!0);this.clipTo&&a.restore();this._removeShadow(a);a.restore()}},_set:function(a,c){if("fill"===a&&c&&this.isSameColor())for(var f=this.paths.length;f--;)this.paths[f]._set(a,
c);return this.callSuper("_set",a,c)},toObject:function(b){b=k(a.call(this,b),{paths:c(this.getObjects(),"toObject",b)});this.sourcePath&&(b.sourcePath=this.sourcePath);return b},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){for(var c=this.getObjects(),f=this.getPointByOrigin("left","top"),f="translate("+f.x+" "+f.y+")",f=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),f,this.getSvgTransform(),
'" ',">\n"],d=0,e=c.length;d<e;d++)f.push(c[d].toSVG(a));f.push("</g>\n");return a?a(f.join("")):f.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(c){return(c.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,c){return a+(c&&c.complexity?c.complexity():0)},
0)},getObjects:function(){return this.paths}}),d.PathGroup.fromObject=function(a,c){"string"===typeof a.paths?d.loadSVGFromURL(a.paths,function(f){var e=a.paths;delete a.paths;f=d.util.groupSVGElements(f,a,e);c(f)}):d.util.enlivenObjects(a.paths,function(f){delete a.paths;c(new d.PathGroup(f,a))})},d.PathGroup.async=!0)})("undefined"!==typeof e?e:this);(function(e){var d=e.fabric||(e.fabric={}),k=d.util.object.extend,c=d.util.array.min,a=d.util.array.max,b=d.util.array.invoke;if(!d.Group){var g={lockMovementX:!0,
lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};d.Group=d.util.createClass(d.Object,d.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;this.originalState={};this.callSuper("initialize");b.originX&&(this.originX=b.originX);b.originY&&(this.originY=b.originY);this._calcBounds();this._updateObjectsCoords();this.callSuper("initialize",b);this.setCoords();this.saveCoords()},
_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop(),d=this.getCenterPoint();a.set({originalLeft:b,originalTop:c,left:b-d.x,top:c-d.y});a.setCoords();a.__origHasControls=a.hasControls;a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();a&&(this._objects.push(a),a.group=this);this.forEachObject(this._setObjectActive,this);
this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,
fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties)for(var c=this._objects.length;c--;)this._objects[c].set(a,b);this.callSuper("_set",a,b)},toObject:function(a){return k(this.callSuper("toObject",a),{objects:b(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();this.clipTo&&d.util.clipContext(this,a);this.transform(a);for(var b=0,c=this._objects.length;b<c;b++)this._renderObject(this._objects[b],
a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;c<d;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){var c=a.hasRotatingPoint;a.visible&&(a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=c)},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){this._moveFlippedObject(a);this._setObjectPosition(a);return a},
_moveFlippedObject:function(a){var b=a.get("originX"),c=a.get("originY"),d=a.getCenterPoint();a.set({originX:"center",originY:"center",left:d.x,top:d.y});this._toggleFlipping(a);d=a.getPointByOrigin(b,c);a.set({originX:b,originY:c,left:d.x,top:d.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);
a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getCenterPoint(),c=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b.x+c.left,top:b.y+c.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+
Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});
return this},_calcBounds:function(a){for(var b=[],c=[],d,e,g=["tr","br","bl","tl"],k=0,h=this._objects.length;k<h;++k){d=this._objects[k];d.setCoords();for(var l=0;l<g.length;l++)e=g[l],b.push(d.oCoords[e].x),c.push(d.oCoords[e].y)}this.set(this._getBounds(b,c,a))},_getBounds:function(f,b,e){var g=d.util.invertTransform(this.getViewportTransform()),k=d.util.transformPoint(new d.Point(c(f),c(b)),g);f=d.util.transformPoint(new d.Point(a(f),a(b)),g);f={width:f.x-k.x||0,height:f.y-k.y||0};e||(f.left=
k.x||0,f.top=k.y||0,"center"===this.originX&&(f.left+=f.width/2),"right"===this.originX&&(f.left+=f.width),"center"===this.originY&&(f.top+=f.height/2),"bottom"===this.originY&&(f.top+=f.height));return f},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,d=this._objects.length;c<d;c++)b.push(this._objects[c].toSVG(a));b.push("</g>\n");return a?a(b.join("")):b.join("")},get:function(a){if(a in g){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;
return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});d.Group.fromObject=function(a,b){d.util.enlivenObjects(a.objects,function(c){delete a.objects;b&&b(new d.Group(c,a))})};d.Group.async=!0}})("undefined"!==typeof e?e:this);(function(e){var d=h.util.object.extend;e.fabric||(e.fabric={});e.fabric.Image?h.warn("fabric.Image is already defined."):(h.Image=h.util.createClass(h.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",
_lastScaleX:1,_lastScaleY:1,initialize:function(d,c){c||(c={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",c);this._initElement(d,c);this._initConfig(c);c.filters&&(this.filters=c.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(d,c,a){this._originalElement=this._element=d;this._initConfig(a);0!==this.filters.length?this.applyFilters(c):c&&c();return this},setCrossOrigin:function(d){this.crossOrigin=d;this._element.crossOrigin=d;return this},
getOriginalSize:function(){var d=this.getElement();return{width:d.width,height:d.height}},_stroke:function(d){d.save();this._setStrokeStyles(d);d.beginPath();d.strokeRect(-this.width/2,-this.height/2,this.width,this.height);d.closePath();d.restore()},_renderDashedStroke:function(d){var c=-this.width/2,a=-this.height/2,b=this.width,e=this.height;d.save();this._setStrokeStyles(d);d.beginPath();h.util.drawDashedLine(d,c,a,c+b,a,this.strokeDashArray);h.util.drawDashedLine(d,c+b,a,c+b,a+e,this.strokeDashArray);
h.util.drawDashedLine(d,c+b,a+e,c,a+e,this.strokeDashArray);h.util.drawDashedLine(d,c,a+e,c,a,this.strokeDashArray);d.closePath();d.restore()},toObject:function(e){return d(this.callSuper("toObject",e),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(c){return c&&c.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(d){var c=[],a=-this.width/2,b=-this.height/2,e="none";this.group&&
"path-group"===this.group.type&&(a=this.left,b=this.top);"none"!==this.alignX&&"none"!==this.alignY&&(e="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);c.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',a,'" y="',b,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',e,'"',"></image>\n");if(this.stroke||this.strokeDashArray)e=this.fill,this.fill=null,c.push("<rect ",
'x="',a,'" y="',b,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=e;c.push("</g>\n");return d?d(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(d,c,a){h.util.loadImage(d,function(b){return this.setElement(b,c,a)},this,a&&a.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(d,c){this.constructor.fromObject(this.toObject(c),
d)},applyFilters:function(d,c,a,b){c=c||this.filters;if(a=a||this._originalElement){var e=a,f=h.util.createCanvasElement(),l=h.util.createImage(),m=this;f.width=e.width;f.height=e.height;f.getContext("2d").drawImage(e,0,0,e.width,e.height);if(0===c.length)return this._element=a,d&&d(),f;c.forEach(function(a){a&&a.applyTo(f,a.scaleX||m.scaleX,a.scaleY||m.scaleY);!b&&a&&"Resize"===a.type&&(m.width*=a.scaleX,m.height*=a.scaleY)});l.width=f.width;l.height=f.height;h.isLikelyNode?(l.src=f.toBuffer(void 0,
h.Image.pngCompression),m._element=l,!b&&(m._filteredEl=l),d&&d()):(l.onload=function(){m._element=l;!b&&(m._filteredEl=l);d&&d();l.onload=f=e=null},l.src=f.toDataURL("image/png"));return f}},_render:function(d,c){var a,b,e=this._findMargins(),f;a=c?this.left:-this.width/2;b=c?this.top:-this.height/2;"slice"===this.meetOrSlice&&(d.beginPath(),d.rect(a,b,this.width,this.height),d.clip());!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=
this.scaleY,f=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):f=this._element;f&&d.drawImage(f,a+e.marginX,b+e.marginY,e.width,e.height);this._renderStroke(d)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var d=this.width,c=this.height,a=0,b=0;if("none"!==this.alignX||"none"!==this.alignY)d=[this.width/this._element.width,this.height/this._element.height],c="meet"===this.meetOrSlice?Math.min.apply(null,
d):Math.max.apply(null,d),d=this._element.width*c,c*=this._element.height,"Mid"===this.alignX&&(a=(this.width-d)/2),"Max"===this.alignX&&(a=this.width-d),"Mid"===this.alignY&&(b=(this.height-c)/2),"Max"===this.alignY&&(b=this.height-c);return{width:d,height:c,marginX:a,marginY:b}},_resetWidthHeight:function(){var d=this.getElement();this.set("width",d.width);this.set("height",d.height)},_initElement:function(d){this.setElement(h.util.getById(d));h.util.addClass(this.getElement(),h.Image.CSS_CANVAS)},
_initConfig:function(d){d||(d={});this.setOptions(d);this._setWidthHeight(d);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(d,c){d.filters&&d.filters.length?h.util.enlivenObjects(d.filters,function(a){c&&c(a)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(d){this.width="width"in d?d.width:this.getElement()?this.getElement().width||0:0;this.height="height"in d?d.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),
h.Image.CSS_CANVAS="canvas-img",h.Image.prototype.getSvgSrc=h.Image.prototype.getSrc,h.Image.fromObject=function(d,c){h.util.loadImage(d.src,function(a){h.Image.prototype._initFilters.call(d,d,function(b){d.filters=b||[];b=new h.Image(a,d);c&&c(b)})},null,d.crossOrigin)},h.Image.fromURL=function(d,c,a){h.util.loadImage(d,function(b){c&&c(new h.Image(b,a))},null,a&&a.crossOrigin)},h.Image.ATTRIBUTE_NAMES=h.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),h.Image.fromElement=
function(e,c,a){e=h.parseAttributes(e,h.Image.ATTRIBUTE_NAMES);var b="xMidYMid",g="meet",f;e.preserveAspectRatio&&(f=e.preserveAspectRatio.split(" "));f&&f.length&&(g=f.pop(),"meet"!==g&&"slice"!==g?(b=g,g="meet"):f.length&&(b=f.pop()));f="none"!==b?b.slice(1,4):"none";b="none"!==b?b.slice(5,8):"none";e.alignX=f;e.alignY=b;e.meetOrSlice=g;h.Image.fromURL(e["xlink:href"],c,d(a?h.util.object.clone(a):{},e))},h.Image.async=!0,h.Image.pngCompression=1)})("undefined"!==typeof e?e:this);(function(e){var d=
e.fabric||(e.fabric={}),h=d.util.object.extend,c=d.util.object.clone,a=d.util.toFixed,b=d.StaticCanvas.supports("setLineDash");d.Text?d.warn("fabric.Text is already defined"):(e=d.Object.prototype.stateProperties.concat(),e.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),d.Text=d.util.createClass(d.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,
text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:e,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,f){f=f||{};this.text=a;this.__skipDimension=!0;this.setOptions(f);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(a){if(!this.__skipDimension){a||(a=d.util.createCanvasElement().getContext("2d"),
this._setTextStyles(a));this._textLines=this.text.split(this._reNewline);this._clearCache();var f=this.textAlign;this.textAlign="left";this.width=this._getTextWidth(a);this.textAlign=f;this.height=this._getTextHeight(a)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&d.util.clipContext(this,a);this._renderTextBackground(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&
a.restore()},_renderText:function(a){a.save();this._translateForTextAlign(a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a);this._renderTextStroke(a);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&a.translate("center"===this.textAlign?this.width/2:this.width,0)},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=
this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var f=this._getLineWidth(a,0),b=1,d=this._textLines.length;b<d;b++){var c=this._getLineWidth(a,b);c>f&&(f=c)}return f},_renderChars:function(a,f,b,d,c){f[a](b,d,c)},_renderTextLine:function(a,f,b,d,c,e){c-=this.fontSize*this._fontSizeFraction;if("justify"!==this.textAlign)this._renderChars(a,f,b,d,c,e);else{var h=this._getLineWidth(f,e),
k=this.width;if(k>=h){h=b.split(/\s+/);b=this._getWidthOfWords(f,b,e);for(var k=(k-b)/(h.length-1),l=b=0,m=h.length;l<m;l++)this._renderChars(a,f,h[l],d+b,c,e),b+=f.measureText(h[l]).width+k}else this._renderChars(a,f,b,d,c,e)}},_getWidthOfWords:function(a,f){return a.measureText(f.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck){for(var f=0,b=0,d=this._textLines.length;b<
d;b++){var c=this._getHeightOfLine(a,b),e=c/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[b],this._getLeftOffset(),this._getTopOffset()+f+e,b);f+=c}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var f=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),b&&a.setLineDash(this.strokeDashArray));
a.beginPath();for(var d=0,c=this._textLines.length;d<c;d++){var e=this._getHeightOfLine(a,d),h=e/this.lineHeight;this._renderTextLine("strokeText",a,this._textLines[d],this._getLeftOffset(),this._getTopOffset()+f+h,d);f+=e}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),
a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},_renderTextLinesBackground:function(a){var f=0,b=this._getHeightOfLine();if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;for(var d=0,c=this._textLines.length;d<c;d++){if(""!==this._textLines[d]){var e=this._getLineWidth(a,d),h=this._getLineLeftOffset(e);a.fillRect(this._getLeftOffset()+h,this._getTopOffset()+f,e,this.fontSize*this._fontSizeMult)}f+=
b}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__lineOffsets=[]},_shouldClearCache:function(){var a=!1,b;for(b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return this.__lineWidths[b];this.__lineWidths[b]=a.measureText(this._textLines[b]).width;
return this.__lineWidths[b]},_renderTextDecoration:function(a){if(this.textDecoration){var b=this.height/2,d=[];-1<this.textDecoration.indexOf("underline")&&d.push(.85);-1<this.textDecoration.indexOf("line-through")&&d.push(.43);-1<this.textDecoration.indexOf("overline")&&d.push(-.12);if(0<d.length){var c,e=0,h,k,l;c=0;for(h=this._textLines.length;c<h;c++){var m=this._getLineWidth(a,c),n=this._getLineLeftOffset(m),q=this._getHeightOfLine(a,c);k=0;for(l=d.length;k<l;k++)a.fillRect(this._getLeftOffset()+
n,e+(this._fontSizeMult-1+d[k])*this.fontSize-b,m,this.fontSize/15);e+=q}}}},_getFontDeclaration:function(){return[d.isLikelyNode?this.fontWeight:this.fontStyle,d.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",d.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&
a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._render(a),a.restore())},toObject:function(a){a=h(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});this.includeDefaultValues||this._removeDefaultValues(a);
return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),d=this._getSVGLeftTopOffsets(this.ctx),d=this._getSVGTextAndBg(d.textTop,d.textLeft);this._wrapSVGTextAndBg(b,d);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(a,b){a.push('\t<g transform="',this.getSvgTransform(),
this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',b.textSpans.join(""),"</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,b){var d=[],c=[],e=
0;this._setSVGBg(c);for(var h=0,k=this._textLines.length;h<k;h++)this.textBackgroundColor&&this._setSVGTextLineBg(c,h,b,a,e),this._setSVGTextLineText(h,d,e,b,a,c),e+=this._getHeightOfLine(this.ctx,h);return{textSpans:d,textBgRects:c}},_setSVGTextLineText:function(b,f,c,e,h){c=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-h+c-this.height/2;f.push('<tspan x="',a(e+this._getLineLeftOffset(this.__lineWidths[b]),4),'" ','y="',a(c,4),'" ',this._getFillAttributes(this.fill),">",d.util.string.escapeXml(this._textLines[b]),
"</tspan>")},_setSVGTextLineBg:function(b,f,d,c,e){b.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(d+this._getLineLeftOffset(this.__lineWidths[f]),4),'" y="',a(e-this.height/2,4),'" width="',a(this.__lineWidths[f],4),'" height="',a(this._getHeightOfLine(this.ctx,f)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(b){this.backgroundColor&&b.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,4),'" y="',a(-this.height/2,4),'" width="',
a(this.width,4),'" height="',a(this.height,4),'"></rect>\n')},_getFillAttributes:function(a){var b=a&&"string"===typeof a?new d.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),d.Text.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),
d.Text.DEFAULT_SVG_FONT_SIZE=16,d.Text.fromElement=function(a,b){if(!a)return null;var c=d.parseAttributes(a,d.Text.ATTRIBUTE_NAMES);b=d.util.object.extend(b?d.util.object.clone(b):{},c);b.top=b.top||0;b.left=b.left||0;"dx"in c&&(b.left+=c.dx);"dy"in c&&(b.top+=c.dy);"fontSize"in b||(b.fontSize=d.Text.DEFAULT_SVG_FONT_SIZE);b.originX||(b.originX="left");var c=a.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),c=new d.Text(c,b),e=0;"left"===c.originX&&(e=c.getWidth()/2);"right"===c.originX&&
(e=-c.getWidth()/2);c.set({left:c.getLeft()+e,top:c.getTop()-c.getHeight()/2+c.fontSize*(.18+c._fontSizeFraction)});return c},d.Text.fromObject=function(a){return new d.Text(a.text,c(a))},d.util.createAccessors(d.Text))})("undefined"!==typeof e?e:this);delete window.fabric;return e}().fabric;e.fabric=l}}});(function(){var e=Q(n.com.fabricjs).fabric,l=y([13,27,32]),m=l[0],h=l[1],t=l[2],d=F("Attribute",[N],{get __init__(){return q(this,function(a,b){a.game=b;a.game.attributes.append(a);a.install();
a.reset()})},get reset(){return q(this,function(a){a.commit()})},get predict(){return q(this,function(a){})},get interact(){return q(this,function(a){})},get commit(){return q(this,function(a){})}}),k=F("Sprite",[d],{get __init__(){return q(this,function(a,b,c,e){a.width=c;a.height=e;d.__init__(a,b)})},get install(){return q(this,function(a){a.image=new e.Rect(C({width:a.game.scaleX(a.width),height:a.game.scaleY(a.height),originX:"center",originY:"center",fill:"white"}))})},get reset(){return q(this,
function(a,b,c,e,g){if("undefined"==typeof b||null!=b&&b.__class__==u)b=0;if("undefined"==typeof c||null!=c&&c.__class__==u)c=0;if("undefined"==typeof e||null!=e&&e.__class__==u)e=0;if("undefined"==typeof g||null!=g&&g.__class__==u)g=0;if(arguments.length){var h=arguments.length-1;if(arguments[h]&&arguments[h].__class__==u){var h=arguments[h--],k;for(k in h)switch(k){case "self":a=h[k];break;case "vX":b=h[k];break;case "vY":c=h[k];break;case "x":e=h[k];break;case "y":g=h[k]}}}a.vX=b;a.vY=c;a.x=e;
a.y=g;d.reset(a)})},get predict(){return q(this,function(a){a.x+=a.vX*a.game.deltaT;a.y+=a.vY*a.game.deltaT})},get commit(){return q(this,function(a){a.image.left=a.game.orthoX(a.x);a.image.top=a.game.orthoY(a.y)})},get draw(){return q(this,function(a){a.game.canvas.add(a.image)})}}),c=F("Paddle",[k],{get __init__(){return q(this,function(a,b,c){a.index=c;k.__init__(a,b,a.width,a.height)})},get reset(){return q(this,function(a){k.reset(a,u({x:a.index?Math.floor(500)-a.margin:Math.floor(-500)+a.margin,
y:0}))})},get predict(){return q(this,function(a){a.vY=0;a.index?J(P("K"),a.game.keySet)?a.vY=a.speed:J(P("M"),a.game.keySet)&&(a.vY=-a.speed):J(P("A"),a.game.keySet)?a.vY=a.speed:J(P("Z"),a.game.keySet)&&(a.vY=-a.speed);k.predict(a)})},get interact(){return q(this,function(a){a.y=Math.max(Math.floor(a.height/2)-Math.floor(325),Math.min(a.y,Math.floor(325)-Math.floor(a.height/2)));a.y-Math.floor(a.height/2)<a.game.ball.y&&a.game.ball.y<a.y+Math.floor(a.height/2)&&(0==a.index&&a.game.ball.x<a.x||1==
a.index&&a.game.ball.x>a.x)&&(a.game.ball.x=a.x,a.game.ball.vX=-a.game.ball.vX,a.game.ball.speedUp(a))})}});c.margin=30;c.width=10;c.height=100;c.speed=400;var a=F("Ball",[k],{get __init__(){return q(this,function(a,b){k.__init__(a,b,a.side,a.side)})},get reset(){return q(this,function(a){var b=a.game.serviceIndex*Math.PI+(.5<Math.random()?1:-1)*Math.random()*Math.atan(.65);k.reset(a,u({vX:a.speed*Math.cos(b),vY:a.speed*Math.sin(b)}))})},get predict(){return q(this,function(a){k.predict(a);a.x<Math.floor(-500)?
a.game.scored(1):a.x>Math.floor(500)&&a.game.scored(0);a.y>Math.floor(325)?(a.y=Math.floor(325),a.vY=-a.vY):a.y<Math.floor(-325)&&(a.y=Math.floor(-325),a.vY=-a.vY)})},get speedUp(){return q(this,function(a,b){var c=1+.15*Math.pow(1-Math.abs(a.y-b.y)/Math.floor(b.height/2),2);Math.abs(a.vX)<3*a.speed&&(a.vX*=c,a.vY*=c)})}});a.side=8;a.speed=300;var b=F("Scoreboard",[d],{get install(){return q(this,function(a){for(var b=[],c=y([y(["AZ keys:",-.4375]),y(["KM keys:",.0625])]),d=0;d<c.length;d++){var g=
c[d],h=g[1];b.append(new e.Text("Player {}".format(g[0]),C({fill:"white",fontFamily:"arial",fontSize:"30",left:a.game.orthoX(1E3*h),top:a.game.orthoY(Math.floor(325)+a.nameShift)})))}a.playerLabels=b;a.hintLabel=new e.Text("[spacebar] starts game, [enter] resets score",C({fill:"white",fontFamily:"arial",fontSize:"12",left:a.game.orthoX(-437.5),top:a.game.orthoY(Math.floor(325)+a.hintShift)}));a.image=new e.Line(H([a.game.orthoX(Math.floor(-500)),a.game.orthoY(Math.floor(325)),a.game.orthoX(Math.floor(500)),
a.game.orthoY(Math.floor(325))]),C({stroke:"white"}))})},get increment(){return q(this,function(a,b){a.scores[b]++})},get reset(){return q(this,function(a){a.scores=H([0,0]);d.reset(a)})},get commit(){return q(this,function(a){for(var b=[],c=S(a.scores,y([-.125,.375])),d=0;d<c.length;d++){var g=c[d],h=g[1];b.append(new e.Text("{}".format(g[0]),C({fill:"white",fontFamily:"arial",fontSize:"30",left:a.game.orthoX(1E3*h),top:a.game.orthoY(Math.floor(325)+a.nameShift)})))}a.scoreLabels=b})},get draw(){return q(this,
function(a){for(var b=S(a.playerLabels,a.scoreLabels),c=0;c<b.length;c++){var d=b[c],e=d[1];a.game.canvas.add(d[0]);a.game.canvas.add(e);a.game.canvas.add(a.hintLabel)}a.game.canvas.add(a.image)})}});b.nameShift=75;b.hintShift=25;var l=F("Game",[N],{get __init__(){return q(this,function(d){d.serviceIndex=.5<Math.random()?1:0;d.pause=!0;d.keySet=D();d.canvas=new e.Canvas("canvas",C({backgroundColor:"black",originX:"center",originY:"center"}));d.canvas.onWindowResize=d.resize;d.canvas.onWindowDraw=
d.draw;d.canvas.lineWidth=2;d.canvas.clear();d.attributes=H([]);for(var g=[],h=0;2>h;h++)g.append(c(d,h));d.paddles=g;d.ball=a(d);d.scoreboard=b(d);window.setInterval(d.update,10);window.setInterval(d.draw,20);window.addEventListener("keydown",d.keydown);window.addEventListener("keyup",d.keyup);d.time=+new Date})},get update(){return q(this,function(a){var b=a.time;a.time=+new Date;a.deltaT=(a.time-b)/1E3;if(a.pause)J(t,a.keySet)?a.pause=!1:J(m,a.keySet)&&a.scoreboard.reset();else{for(var b=a.attributes,
c=0;c<b.length;c++){var d=b[c];d.predict()}b=a.attributes;for(c=0;c<b.length;c++)d=b[c],d.interact();b=a.attributes;for(c=0;c<b.length;c++)d=b[c],d.commit()}})},get scored(){return q(this,function(a,b){a.scoreboard.increment(b);a.serviceIndex=1-b;for(var c=a.paddles,d=0;d<c.length;d++)c[d].reset();a.ball.reset();a.pause=!0})},get draw(){return q(this,function(a){a.canvas.clear();a=a.attributes;for(var b=0;b<a.length;b++)a[b].draw()})},get resize(){return q(this,function(a,b,c){})},get scaleX(){return q(this,
function(a,b){return a.canvas.width/1E3*b})},get scaleY(){return q(this,function(a,b){return a.canvas.height/750*b})},get orthoX(){return q(this,function(a,b){return a.scaleX(b+Math.floor(500))})},get orthoY(){return q(this,function(a,b){return a.scaleY(750-Math.floor(325)-b)})},get keydown(){return q(this,function(a,b){a.keySet.add(b.keyCode)})},get keyup(){return q(this,function(a,b){a.keySet.remove(b.keyCode)})}}),g=l();n.Attribute=d;n.Ball=a;n.Game=l;n.Paddle=c;n.Scoreboard=b;n.Sprite=k;n.enter=
m;n.esc=h;n.fieldHeight=650;n.game=g;n.orthoHeight=750;n.orthoWidth=1E3;n.space=t})();return n}window.pong=pong();

//# sourceMappingURL=extra/sourcemap/pong.min.js.map
