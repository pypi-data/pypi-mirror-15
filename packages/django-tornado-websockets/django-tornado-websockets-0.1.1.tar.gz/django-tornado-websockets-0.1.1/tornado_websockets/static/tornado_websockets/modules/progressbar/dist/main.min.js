!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.deepmerge=e()}(this,function(){return function t(e,s){var r=Array.isArray(s),o=r&&[]||{};return r?(e=e||[],o=o.concat(e),s.forEach(function(s,r){"undefined"==typeof o[r]?o[r]=s:"object"==typeof s?o[r]=t(e[r],s):-1===e.indexOf(s)&&o.push(s)})):(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){o[t]=e[t]}),Object.keys(s).forEach(function(r){o[r]="object"==typeof s[r]&&s[r]&&e[r]?t(e[r],s[r]):s[r]})),o}});var ProgressBarModuleEngine;ProgressBarModuleEngine=function(){function t(t,e){if(void 0===t||!(t instanceof HTMLElement))throw new TypeError("You must pass an HTML element as container during `ProgressBarModuleEngine` instantiation.");if(!(e instanceof Object))throw new TypeError("You must pass an Object as options during `ProgressBarModuleEngine` instantiation.");this.$container=t,this.options=e}return t.prototype.render=function(){throw new Error("`render` method should be overridden.")},t.prototype.onInit=function(t){throw new Error("`onInit` method should be overridden.")},t.prototype.onUpdate=function(t){throw new Error("`onUpdate` method should be overridden.")},t.prototype.updateLabel=function(t){throw new Error("`updateLabel` method should be overridden.")},t.prototype.updateProgression=function(t){throw new Error("`updateProgression` method should be overridden.")},t}();var ProgressBarModuleEngineBootstrap,extend=function(t,e){function s(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;ProgressBarModuleEngineBootstrap=function(t){function e(t,s){e.__super__.constructor.call(this,t,s),this._settings={}}return extend(e,t),e.prototype.render=function(){this._createElements(),this._renderElements()},e.prototype.onInit=function(t){var e,s,r,o;r=[0,100,100],s=r[0],e=r[1],o=r[2],t.indeterminate===!1&&(s=t.min,e=t.max,o=t.value),this._config("indeterminate",t.indeterminate),this._config("min",s),this._config("max",e),this._config("value",o),this.onUpdate({value:o})},e.prototype.onUpdate=function(t){this._config("value",t.value),this._config("progression",(this._settings.value/this._settings.max*100).toFixed()),this.$progressbar.style.width=this._settings.progression+"%",void 0!==t.label&&this.updateLabel(t.label),this.updateProgression(this._settings.progression)},e.prototype.updateLabel=function(t){this.$label.textContent=t},e.prototype.updateProgression=function(t){this.$progression.textContent=this.options.progression.format.replace(/\{\{ *percent *\}\}/g,t)},e.prototype._createElements=function(){var t,e,s,r,o;for(this.$progress=document.createElement("div"),this.$progress.classList.add("progress"),this.$progressbar=document.createElement("div"),this.$progressbar.classList.add("progress-bar"),this.$progressbar.setAttribute("role","progressbar"),("info"===(r=this.options.progressbar.context)||"success"===r||"warning"===r||"danger"===r)&&this.$progressbar.classList.add("progress-bar-"+this.options.progressbar.context),this.options.progressbar.striped===!0&&(this.$progressbar.classList.add("progress-bar-striped"),this.options.progressbar.animated===!0&&this.$progressbar.classList.add("active")),this.$progression=document.createElement("span"),this.options.progression.visible===!1&&this.$progression.classList.add("sr-only"),this.$label=document.createElement("span"),o=this.options.label.classes,e=0,s=o.length;s>e;e++)t=o[e],this.$label.classList.add(t);this.options.label.visible===!1&&(this.$label.style.display="none")},e.prototype._renderElements=function(){this.$progressbar.appendChild(this.$progression),this.$progress.appendChild(this.$progressbar),this.$container.appendChild(this.$progress),"top"===this.options.label.position?this.$container.insertBefore(this.$label,this.$progress):this.$container.appendChild(this.$label)},e.prototype._config=function(t,e){switch(this._settings[t]=e,t){case"min":case"max":case"value":"value"===t&&(t="now"),this.$progressbar.setAttribute("aria-value"+t,e);break;case"indeterminate":e===!0&&(this.$progressbar.classList.add("progress-bar-striped"),this.$progressbar.classList.add("active"),this.$progressbar.style.width="100%")}},e}(ProgressBarModuleEngine);var ProgressBarModuleEngineHtml5,extend=function(t,e){function s(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;ProgressBarModuleEngineHtml5=function(t){function e(t,s){e.__super__.constructor.call(this,t,s),this._settings={}}return extend(e,t),e.prototype.render=function(){this._createElements(),this._renderElements()},e.prototype.onInit=function(t){var e,s,r;return t.indeterminate?this._config("indeterminate",!0):(s=t.min,e=t.max,r=t.value,this._config("min",s),this._config("max",e),this._config("value",r),this.onUpdate({value:r}))},e.prototype.onUpdate=function(t){this._config("value",t.value),this._config("progression",(this._settings.value/this._settings.max*100).toFixed()),void 0!==t.label&&this.updateLabel(t.label),this.updateProgression(this._settings.progression)},e.prototype.updateLabel=function(t){this.$label.textContent=t},e.prototype.updateProgression=function(t){this.$progression.textContent=this.options.progression.format.replace(/\{\{ *percent *\}\}/g,t)},e.prototype._createElements=function(){var t,e,s,r;for(this.$progress=document.createElement("div"),this.$progress.classList.add("progress"),this.$progressbar=document.createElement("progress"),this.$progressbar.classList.add("progress-bar"),this.$progression=document.createElement("span"),this.options.progression.visible===!1&&(this.$progression.style.display="none"),this.$label=document.createElement("span"),r=this.options.label.classes,e=0,s=r.length;s>e;e++)t=r[e],this.$label.classList.add(t);this.options.label.visible===!1&&(this.$label.style.display="none")},e.prototype._renderElements=function(){this.$progress.appendChild(this.$progressbar),this.$container.appendChild(this.$progress),"top"===this.options.label.position?this.$container.insertBefore(this.$label,this.$progress):this.$container.appendChild(this.$label),"left"===this.options.progression.position?this.$progressbar.parentNode.insertBefore(this.$progression,this.$progressbar):this.$progressbar.parentNode.insertBefore(this.$progression,this.$progressbar.nextSibling)},e.prototype._config=function(t,e){switch(this._settings[t]=e,t){case"min":case"max":case"value":this.$progressbar.setAttribute(t,e);break;case"indeterminate":e===!0&&(this.$progressbar.removeAttribute("min"),this.$progressbar.removeAttribute("max"),this.$progressbar.removeAttribute("value"))}},e}(ProgressBarModuleEngine);var ProgressBarModule;ProgressBarModule=function(){function t(e,s,r){if(null==r&&(r={}),!(this instanceof t))return new t(e,s,r);if(void 0===e||"string"!=typeof e)throw new TypeError("You must pass 'path' parameter during 'ProgressBarModule' instantiation.");if(void 0===s||!(s instanceof HTMLElement))throw new TypeError("You must pass an HTML element as container during `ProgressBarModule` instantiation.");if(!(r instanceof Object))throw new TypeError("You must pass an Object as options during `ProgressBarModuleEngine` instantiation.");switch(this.path=e.trim(),this.path="/"===this.path[0]?this.path:"/"+this.path,this.container=s,this.options={websocket:{},type:"bootstrap",bootstrap:{label:{visible:!0,classes:["progressbar-label"],position:"top"},progressbar:{context:"info",striped:!1,animated:!1},progression:{visible:!0,format:"{{percent}}%"}},html5:{label:{visible:!0,classes:["progressbar-label"],position:"top"},progression:{visible:!0,format:"{{percent}}%",position:"right"}}},this.options=deepmerge(this.options,r),this.engine=null,this.options.type){case"bootstrap":this.engine=new ProgressBarModuleEngineBootstrap(this.container,this.options.bootstrap);break;case"html5":this.engine=new ProgressBarModuleEngineHtml5(this.container,this.options.html5);break;default:throw new Error("Given `type` should be equal to ``bootstrap`` or ``html5``.")}this.websocket=new TornadoWebSocket("/module/progress_bar"+this.path,this.options.websocket),this.init()}return t.prototype.init=function(){this.on("init",function(t){return function(e){return t.engine.onInit.apply(t.engine,[e])}}(this)),this.on("update",function(t){return function(e){return t.engine.onUpdate.apply(t.engine,[e])}}(this)),this.engine.render()},t.prototype.on=function(t,e){return this.websocket.on(t,e)},t.prototype.emit=function(t,e){return null==e&&(e={}),this.websocket.emit(t,e)},t}();