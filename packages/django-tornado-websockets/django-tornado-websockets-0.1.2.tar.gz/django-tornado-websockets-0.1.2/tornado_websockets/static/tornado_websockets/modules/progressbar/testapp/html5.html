<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TestApp for HTML5 Engine</title>
  <style>
    body > div {
      position: relative;
    }

    .process {
      position: absolute;
      top: 0;
      right: 10px;
    }

    .process[disabled] {
      opacity: 0.5;
    }
  </style>
</head>
<body>

<script src="https://cdn.rawgit.com/Kocal/dtws-client/master/dist/main.min.js"></script>
<script src="../dist/main.js"></script>
<script>
  var $btnProcess = document.querySelector('#process');
  var automations = [
    { type: 'html5', html5: { label: {} } },
    { type: 'html5', html5: { label: { position: 'top' } } },
    { type: 'html5', html5: { label: { position: 'bottom' } } },
    { type: 'html5', html5: { label: { position: 'top', visible: true } } },
    { type: 'html5', html5: { label: { position: 'top', visible: false } } },
    { type: 'html5', html5: { label: { position: 'bottom', visible: true } } },
    { type: 'html5', html5: { label: { position: 'bottom', visible: false } } },
    { type: 'html5', html5: { progression: {} } },
    { type: 'html5', html5: { progression: { format: '{{percent}}% ', position: 'left', visible: true } } },
    { type: 'html5', html5: { progression: { format: '{{percent}}% ', position: 'left', visible: false } } },
    { type: 'html5', html5: { progression: { format: ' {{percent}}% ', position: 'right', visible: true } } },
    { type: 'html5', html5: { progression: { format: ' {{percent}}%', position: 'right', visible: false } } },
    { type: 'html5', html5: { progression: { format: ' Progression: {{percent}}%' } } },
    { type: 'html5', html5: { progression: { position: 'left', format: 'Progression: {{percent}}% ' } } },
    { type: 'html5', html5: { progression: { position: 'right', format: ' Progression: {{percent}}%' } } },

  ];

  automations.forEach(function (automation, index) {
    var id = 'progress-bar--container-' + index;

    var $root = document.createElement('div');
    var $name = document.createElement('h4');
    var $container = document.createElement('div');
    var $btnProcess = document.createElement('button');
    var $hr = document.createElement('hr');

    var progressBar = new ProgressBarModule('/my_progress_bar/' + index, $container, automation);

    // --- Bind progress bar's events

    progressBar.on('open', function () {
      $btnProcess.removeAttribute('disabled');

      $btnProcess.addEventListener('click', function (e) {
        e.preventDefault();
        $btnProcess.setAttribute('disabled', 'disabled');
        $btnProcess.textContent = 'Working...';
        progressBar.emit('start');
      });
    });

    progressBar.on('error', function () {
    });
    progressBar.on('close', function () {
    });
    progressBar.on('before_init', function () {
      progressBar.engine.updateLabel('Connexion en cours...')
    });
    progressBar.on('after_init', function () {
      progressBar.engine.updateLabel('Connexion termin√©e.')
    });
    progressBar.on('before_update', function () {
    });
    progressBar.on('after_update', function () {
    });
    progressBar.on('done', function () {
      $btnProcess.removeAttribute('disabled');
      $btnProcess.textContent = 'Start'
    });

    progressBar.on('warning', function (data) {
      console.warn(data);
    });

    window.addEventListener('beforeunload', function () {
      //      progressBar.close();
    });

    // . . .

    $name.textContent = JSON.stringify(automation);
    $container.setAttribute('id', id);

    $btnProcess.classList.add('process');
    $btnProcess.setAttribute('disabled', 'disabled');
    $btnProcess.textContent = 'Start';

    $root.appendChild($name);
    $root.appendChild($container);
    $root.appendChild($btnProcess);
    $root.appendChild($hr);
    document.body.appendChild($root);
  }) </script>
</body>
</html>
