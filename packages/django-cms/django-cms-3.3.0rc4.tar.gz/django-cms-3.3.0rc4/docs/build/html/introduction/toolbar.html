

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extending the Toolbar &mdash; django cms 3.3.0.dev4 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="django cms 3.3.0.dev4 documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="Extending the navigation menu" href="menu.html"/>
        <link rel="prev" title="Integrating a third-party application" href="third_party.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> django cms
          

          
          </a>

          
            
            
              <div class="version">
                3.3.0.dev4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installing django CMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates_placeholders.html">Templates &amp; Placeholders</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="apphooks.html">Apphooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="third_party.html">Integrating a third-party application</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Extending the Toolbar</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#registering-toolbar-items">Registering toolbar items</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-the-toolbar">Create the toolbar</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-this-all-means">What this all means</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#see-it-at-work">See it at work</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="menu.html">Extending the navigation menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaced_apphooks.html">Namespaced Apphooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../how_to/index.html">How-to guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/index.html">Key topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Development &amp; community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade/index.html">Release notes &amp; upgrade information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">Using django CMS</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">django cms</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Tutorials</a> &raquo;</li>
      
    <li>Extending the Toolbar</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/introduction/toolbar.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extending-the-toolbar">
<h1>Extending the Toolbar<a class="headerlink" href="#extending-the-toolbar" title="Permalink to this headline">¶</a></h1>
<p>django CMS allows you to control what appears in the toolbar. This allows you
to integrate your application in the frontend editing mode of django CMS and
provide your users with a streamlined editing experience.</p>
<div class="section" id="registering-toolbar-items">
<h2>Registering toolbar items<a class="headerlink" href="#registering-toolbar-items" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to control what gets shown in the toolbar.</p>
<p>One is the <code class="docutils literal"><span class="pre">CMS_TOOLBARS</span></code> setting. This gives you full control over which
classes are loaded, but requires that you specify them all manually.</p>
<p>The other is to provide <code class="docutils literal"><span class="pre">cms_toolbars.py</span></code> files in your apps, which will be
automatically loaded as long <code class="docutils literal"><span class="pre">CMS_TOOLBARS</span></code> is not set (or set to <code class="docutils literal"><span class="pre">None</span></code>).
We&#8217;ll work with this second method.</p>
</div>
<div class="section" id="create-the-toolbar">
<h2>Create the toolbar<a class="headerlink" href="#create-the-toolbar" title="Permalink to this headline">¶</a></h2>
<p>Create a new <code class="docutils literal"><span class="pre">cms_toolbars.py</span></code> file in your Polls application (note: <em>not</em> in
the Polls Plugin application):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>
<span class="kn">from</span> <span class="nn">cms.utils.urlutils</span> <span class="kn">import</span> <span class="n">admin_reverse</span>
<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>


<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">PollToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>
    <span class="n">supported_apps</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;polls&#39;</span><span class="p">,</span>
        <span class="s">&#39;polls_plugin&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">watch_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">Poll</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_current_app</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="s">&#39;poll-app&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Polls&#39;</span><span class="p">))</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Poll list&#39;</span><span class="p">),</span>
            <span class="n">url</span><span class="o">=</span><span class="n">admin_reverse</span><span class="p">(</span><span class="s">&#39;polls_poll_changelist&#39;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">add_modal_item</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Add new poll&#39;</span><span class="p">),</span>
            <span class="n">url</span><span class="o">=</span><span class="n">admin_reverse</span><span class="p">(</span><span class="s">&#39;polls_poll_add&#39;</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="what-this-all-means">
<h3>What this all means<a class="headerlink" href="#what-this-all-means" title="Permalink to this headline">¶</a></h3>
<p>What we&#8217;re doing above is this:</p>
<ul class="simple">
<li>defining a <code class="docutils literal"><span class="pre">CMSToolbar</span></code> sub-class</li>
<li>registering the toolbar class with <code class="docutils literal"><span class="pre">&#64;toolbar_pool.register</span></code></li>
<li>defining a <code class="docutils literal"><span class="pre">populate()</span></code> method that adds an item to the menu</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">populate()</span></code> method:</p>
<ul class="simple">
<li>checks whether we&#8217;re in a page belonging to this application</li>
<li>if so, it creates a menu if one&#8217;s not already there</li>
<li>adds a menu item to list all polls in the overlay</li>
<li>adds a menu item to add a now poll as a modal window</li>
</ul>
<p>Your <code class="docutils literal"><span class="pre">cms_toolbars.py</span></code> file should contain classes that extend <code class="docutils literal"><span class="pre">cms.toolbar_base.CMSToolbar</span></code>
and are registered using <code class="docutils literal"><span class="pre">cms.toolbar_pool.toolbar_pool.register()</span></code>. The register function can be
used as a decorator, as in the example above.</p>
<p><code class="docutils literal"><span class="pre">CMSToolbar</span></code> instances will have these attributes:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">toolbar</span></code>: the toolbar object</li>
<li><code class="docutils literal"><span class="pre">request</span></code> the current request</li>
<li><code class="docutils literal"><span class="pre">is_current_app</span></code> a flag indicating whether the current request is handled
by the same app as the function is in (use <code class="docutils literal"><span class="pre">supported_apps</span></code> to add more
apps that should be considered the &#8220;active app&#8221;)</li>
<li><code class="docutils literal"><span class="pre">app_path</span></code> the name of the app used for the current request</li>
<li><code class="docutils literal"><span class="pre">watch_models</span></code> which allow the frontend editor to redirect the user to the model instance
<code class="docutils literal"><span class="pre">get_absolute_url</span></code> whenever an instance is created or saved through the frontend editor
(see <a class="reference internal" href="../how_to/toolbar.html#url-changes"><span>Detecting URL changes</span></a> for details)</li>
</ul>
<p><code class="docutils literal"><span class="pre">CMSToolbar</span></code> sub-classes must implement a <code class="docutils literal"><span class="pre">populate</span></code> method. The <code class="docutils literal"><span class="pre">populate</span></code>
method will only be called if the current user is a staff user.
<code class="docutils literal"><span class="pre">supported_apps</span></code> is a list of app names that should be considered as
<code class="docutils literal"><span class="pre">is_current_app</span></code>. Usually you don&#8217;t need to set <code class="docutils literal"><span class="pre">supported_apps</span></code>, but in
our case we need it so <code class="docutils literal"><span class="pre">is_current_app</span></code> can be detected properly (because the
views for the poll app are in <code class="docutils literal"><span class="pre">polls</span></code> and our <code class="docutils literal"><span class="pre">cms_toolbars.py</span></code> is in the
<code class="docutils literal"><span class="pre">polls_plugin</span></code> app).</p>
</div>
</div>
<div class="section" id="see-it-at-work">
<h2>See it at work<a class="headerlink" href="#see-it-at-work" title="Permalink to this headline">¶</a></h2>
<p>Visit your Polls page on your site, and you&#8217;ll see a new <em>Polls</em> item in the toolbar.</p>
<p>There&#8217;s a lot more to django CMS toolbar classes than this - see
<a class="reference internal" href="../how_to/toolbar.html"><em>Extending the Toolbar</em></a> for more.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="menu.html" class="btn btn-neutral float-right" title="Extending the navigation menu" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="third_party.html" class="btn btn-neutral" title="Integrating a third-party application" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2015, Patrick Lauber.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.3.0.dev4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>