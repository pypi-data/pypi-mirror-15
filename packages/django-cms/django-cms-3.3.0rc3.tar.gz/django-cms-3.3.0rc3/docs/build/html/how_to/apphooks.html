

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Apphooks &mdash; django cms 3.3.0.dev4 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="django cms 3.3.0.dev4 documentation" href="../index.html"/>
        <link rel="up" title="How-to guides" href="index.html"/>
        <link rel="next" title="Working with templates" href="templates.html"/>
        <link rel="prev" title="Customising navigation menus" href="menus.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> django cms
          

          
          </a>

          
            
            
              <div class="version">
                3.3.0.dev4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">How-to guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installing django CMS by hand</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_plugins.html">Custom Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="menus.html">Customising navigation menus</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Apphooks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#apphook-menus">Apphook menus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attaching-an-application-multiple-times">Attaching an application multiple times</a></li>
<li class="toctree-l3"><a class="reference internal" href="#apphook-permissions">Apphook permissions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automatically-restart-server-on-apphook-changes">Automatically restart server on apphook changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="templates.html">Working with templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending_page_title.html">Extending the page &amp; title models</a></li>
<li class="toctree-l2"><a class="reference internal" href="toolbar.html">Extending the Toolbar</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing Your Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="placeholders.html">Placeholders outside the CMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="caching.html">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="frontend_models.html">Frontend editing for Page and Django models</a></li>
<li class="toctree-l2"><a class="reference internal" href="sitemap.html">Sitemap Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_types.html">Page Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="wizards.html">Content creation wizards</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing a patch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../topics/index.html">Key topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Development &amp; community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade/index.html">Release notes &amp; upgrade information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">Using django CMS</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">django cms</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">How-to guides</a> &raquo;</li>
      
    <li>Apphooks</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/how_to/apphooks.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="apphooks">
<h1>Apphooks<a class="headerlink" href="#apphooks" title="Permalink to this headline">¶</a></h1>
<p>An <strong>apphook</strong> allows you to attach a Django application to a page. For example,
you might have a news application that you&#8217;d like integrated with django CMS. In
this case, you can create a normal django CMS page without any content of its
own, and attach the news application to the page; the news application&#8217;s content
will be delivered at the page&#8217;s URL.</p>
<p>To create an apphook place a <code class="docutils literal"><span class="pre">cms_apps.py</span></code> in your application. And in it write
the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.app_base</span> <span class="kn">import</span> <span class="n">CMSApp</span>
<span class="kn">from</span> <span class="nn">cms.apphook_pool</span> <span class="kn">import</span> <span class="n">apphook_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">MyApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>

<span class="n">apphook_pool</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyApphook</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Up to version 3.1 the module was named <code class="docutils literal"><span class="pre">cms_app.py</span></code>, please
update your existing modules to the new naming convention.
Support for the old name will be removed in version 3.4.</p>
</div>
<p>Replace <code class="docutils literal"><span class="pre">myapp.urls</span></code> with the path to your applications <code class="docutils literal"><span class="pre">urls.py</span></code>. Now edit
a page and open the advanced settings tab. Select your new apphook under
&#8220;Application&#8221;. Save the page.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Whenever you add or remove an apphook, change the slug of a page containing an apphook or the
slug if a page which has a descendant with an apphook, the server must restart to re-load the
URL caches.</p>
<p>If you have the <a class="reference internal" href="../reference/configuration.html#apphookreloadmiddleware"><span>cms.middleware.utils.ApphookReloadMiddleware</span></a> (recommended) installed, the server will
restart automatically. Otherwise, you will need to restart it manually.</p>
<p>If you have the</p>
<p class="last">An apphook won&#8217;t appear until it is published. Take note that this also
means all parent pages must also be published.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If at some point you want to remove this apphook after deleting the
<code class="docutils literal"><span class="pre">cms_apps.py</span></code> there is a cms management command called <code class="docutils literal"><span class="pre">uninstall</span> <span class="pre">apphooks</span></code> that
removes the specified apphook(s) from all pages by name. eg. <code class="docutils literal"><span class="pre">manage.py</span> <span class="pre">cms</span>
<span class="pre">uninstall</span> <span class="pre">apphooks</span> <span class="pre">MyApphook</span></code>. To find all names for uninstallable apphooks
there is a command for this as well <code class="docutils literal"><span class="pre">manage.py</span> <span class="pre">cms</span> <span class="pre">list</span> <span class="pre">apphooks</span></code>.</p>
</div>
<p>If you attached the app to a page with the url <code class="docutils literal"><span class="pre">/hello/world/</span></code> and the app has
a <code class="docutils literal"><span class="pre">urls.py</span></code> that looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">sampleapp.views</span> <span class="kn">import</span> <span class="n">main_view</span><span class="p">,</span> <span class="n">sample_view</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="n">main_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;app_main&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^sublevel/$&#39;</span><span class="p">,</span> <span class="n">sample_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;app_sublevel&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">main_view</span></code> should now be available at <code class="docutils literal"><span class="pre">/hello/world/</span></code> and the
<code class="docutils literal"><span class="pre">sample_view</span></code> has the URL <code class="docutils literal"><span class="pre">/hello/world/sublevel/</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">CMS pages <strong>below</strong> the page to which the apphook is attached to, <strong>can</strong> be visible,
provided that the apphook urlconf regexps are not too greedy. From a URL resolution
perspective, attaching an apphook works in same way as inserting the apphook urlconf
in the root urlconf at the same path as the page it&#8217;s attached to.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All views that are attached like this must return a
<a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/templates/api.html#django.template.RequestContext" title="(in Django v1.10)"><code class="xref py py-class docutils literal"><span class="pre">RequestContext</span></code></a> instance instead of the
default <a class="reference external" href="http://readthedocs.org/docs/django/en/latest/ref/templates/api.html#django.template.Context" title="(in Django v1.10)"><code class="xref py py-class docutils literal"><span class="pre">Context</span></code></a> instance.</p>
</div>
<div class="section" id="apphook-menus">
<h2>Apphook menus<a class="headerlink" href="#apphook-menus" title="Permalink to this headline">¶</a></h2>
<p>If you want to add a menu to that page as well that may represent some views
in your app add it to your apphook like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">myapp.menu</span> <span class="kn">import</span> <span class="n">MyAppMenu</span>

<span class="k">class</span> <span class="nc">MyApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>
    <span class="n">menus</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyAppMenu</span><span class="p">]</span>

<span class="n">apphook_pool</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyApphook</span><span class="p">)</span>
</pre></div>
</div>
<p>For an example if your app has a <code class="xref py py-class docutils literal"><span class="pre">Category</span></code> model and you want this
category model to be displayed in the menu when you attach the app to a page.
We assume the following model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">import</span> <span class="nn">mptt</span>

<span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;self&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;category_view&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">])</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">mptt</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Category</span><span class="p">)</span>
<span class="k">except</span> <span class="n">mptt</span><span class="o">.</span><span class="n">AlreadyRegistered</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>We would now create a menu out of these categories:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">menus.base</span> <span class="kn">import</span> <span class="n">NavigationNode</span>
<span class="kn">from</span> <span class="nn">menus.menu_pool</span> <span class="kn">import</span> <span class="n">menu_pool</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.menu_bases</span> <span class="kn">import</span> <span class="n">CMSAttachMenu</span>
<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="kn">import</span> <span class="n">Category</span>

<span class="k">class</span> <span class="nc">CategoryMenu</span><span class="p">(</span><span class="n">CMSAttachMenu</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;test menu&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;tree_id&quot;</span><span class="p">,</span> <span class="s">&quot;lft&quot;</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">NavigationNode</span><span class="p">(</span>
                <span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">category</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">(),</span>
                <span class="n">category</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                <span class="n">category</span><span class="o">.</span><span class="n">parent_id</span>
            <span class="p">)</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>

<span class="n">menu_pool</span><span class="o">.</span><span class="n">register_menu</span><span class="p">(</span><span class="n">CategoryMenu</span><span class="p">)</span>
</pre></div>
</div>
<p>If you add this menu now to your apphook:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">myapp.menus</span> <span class="kn">import</span> <span class="n">CategoryMenu</span>

<span class="k">class</span> <span class="nc">MyApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>
    <span class="n">menus</span> <span class="o">=</span> <span class="p">[</span><span class="n">MyAppMenu</span><span class="p">,</span> <span class="n">CategoryMenu</span><span class="p">]</span>
</pre></div>
</div>
<p>You get the static entries of <code class="xref py py-class docutils literal"><span class="pre">MyAppMenu</span></code> and the dynamic entries of
<code class="xref py py-class docutils literal"><span class="pre">CategoryMenu</span></code> both attached to the same page.</p>
</div>
<div class="section" id="attaching-an-application-multiple-times">
<span id="multi-apphook"></span><h2>Attaching an application multiple times<a class="headerlink" href="#attaching-an-application-multiple-times" title="Permalink to this headline">¶</a></h2>
<p>If you want to attach an application multiple times to different pages you have two different
possibilities:</p>
<ul class="simple">
<li>Give every application its own namespace in the advanced settings of a page.</li>
<li>Define an <code class="docutils literal"><span class="pre">app_name</span></code> attribute on the <code class="docutils literal"><span class="pre">CMSApp</span></code> class.</li>
</ul>
<p>The problem is that if you only define a namespace you need to have multiple templates per attached app.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>{% url &#39;my_view&#39; %}
</pre></div>
</div>
<p>Will not work any more when you namespace an app. You will need to do something like:</p>
<div class="highlight-python"><div class="highlight"><pre>{% url &#39;my_namespace:my_view&#39; %}
</pre></div>
</div>
<p>The problem is now if you attach apps to multiple pages your namespace will change.
The solution for this problem is <strong>application namespaces</strong>.</p>
<p>If you&#8217;d like to use application namespaces to reverse the URLs related to
your app, you can assign a value to the <cite>app_name</cite> attribute of your app
hook like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyNamespacedApphook</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;My Namespaced Apphook&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;myapp.urls&quot;</span><span class="p">]</span>
    <span class="n">app_name</span> <span class="o">=</span> <span class="s">&quot;myapp_namespace&quot;</span>

<span class="n">apphook_pool</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyNamespacedApphook</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do provide an <code class="docutils literal"><span class="pre">app_name</span></code>, then you will need to also give the app
a unique namespace in the <em>Advanced settings</em> of the page. If you do not, and
no other instance of the app exists using it, then the &#8216;default instance
namespace&#8217; will be automatically set for you. You can then either reverse
for the namespace(to target different apps) or the app_name (to target
links inside the same app).</p>
</div>
<p>If you use app namespace you will need to give all your view <code class="docutils literal"><span class="pre">context</span></code> a <code class="docutils literal"><span class="pre">current_app</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">resolve</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">request</span><span class="o">.</span><span class="n">current_app</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path_info</span><span class="p">)</span><span class="o">.</span><span class="n">namespace</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&quot;my_template.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You need to set the current_app explicitly in all your view contexts as Django does not allow
any other way of doing this.</p>
</div>
<p>You can reverse namespaced apps similarly and it &#8220;knows&#8221; in which app instance it is:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">url</span> <span class="nv">myapp_namespace</span><span class="o">:</span><span class="nv">app_main</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>If you want to access the same URL but in a different language use the language
template tag:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">language</span> <span class="s2">&quot;de&quot;</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">url</span> <span class="nv">myapp_namespace</span><span class="o">:</span><span class="nv">app_main</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endlanguage</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The official Django documentation has more details about application and
instance namespaces, the <code class="docutils literal"><span class="pre">current_app</span></code> scope and the reversing of such
URLs. You can look it up at <a class="reference external" href="https://docs.djangoproject.com/en/dev/topics/http/urls/#url-namespaces">https://docs.djangoproject.com/en/dev/topics/http/urls/#url-namespaces</a></p>
</div>
<p>When using the <code class="docutils literal"><span class="pre">reverse</span></code> function, the <code class="docutils literal"><span class="pre">current_app</span></code> must be explicitly passed
as an argument. You can do so by looking up the <code class="docutils literal"><span class="pre">current_app</span></code> attribute of
the request instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">myviews</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">current_app</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path_info</span><span class="p">)</span><span class="o">.</span><span class="n">namespace</span>

    <span class="n">reversed_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;myapp_namespace:app_main&#39;</span><span class="p">,</span>
            <span class="n">current_app</span><span class="o">=</span><span class="n">current_app</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Or, if you are rendering a plugin, of the context instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">CMSPluginBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">placeholder</span><span class="p">):</span>
        <span class="c"># ...</span>
        <span class="n">current_app</span> <span class="o">=</span> <span class="n">resolve</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path_info</span><span class="p">)</span><span class="o">.</span><span class="n">namespace</span>
        <span class="n">reversed_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;myapp_namespace:app_main&#39;</span><span class="p">,</span>
                <span class="n">current_app</span><span class="o">=</span><span class="n">current_app</span><span class="p">)</span>
        <span class="c"># ...</span>
</pre></div>
</div>
</div>
<div class="section" id="apphook-permissions">
<span id="id1"></span><h2>Apphook permissions<a class="headerlink" href="#apphook-permissions" title="Permalink to this headline">¶</a></h2>
<p>By default all apphooks have the same permissions set as the page they are assigned to.
So if you set login required on page the attached apphook and all its urls have the same
requirements.</p>
<p>To disable this behaviour set <code class="docutils literal"><span class="pre">permissions</span> <span class="pre">=</span> <span class="pre">False</span></code> on your apphook:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SampleApp</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Sample App&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;project.sampleapp.urls&quot;</span><span class="p">]</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>If you still want some of your views to have permission checks you can enable them via a decorator:</p>
<p><code class="docutils literal"><span class="pre">cms.utils.decorators.cms_perms</span></code></p>
<p>Here is a simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.utils.decorators</span> <span class="kn">import</span> <span class="n">cms_perms</span>

<span class="nd">@cms_perms</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If you have your own permission check in your app, or just don&#8217;t want to wrap some nested apps
with CMS permission decorator, then use <code class="docutils literal"><span class="pre">exclude_permissions</span></code> property of the apphook:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SampleApp</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Sample App&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;project.sampleapp.urls&quot;</span><span class="p">]</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">exclude_permissions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;some_nested_app&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>For example, <a class="reference external" href="https://github.com/tangentlabs/django-oscar">django-oscar</a> apphook integration needs to be used with <code class="docutils literal"><span class="pre">exclude_permissions</span></code> of the
dashboard app, because it uses the <a class="reference external" href="https://github.com/tangentlabs/django-oscar/blob/0.7.2/oscar/apps/dashboard/nav.py#L57">customisable access function</a>. So, your apphook in this case
will look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">OscarApp</span><span class="p">(</span><span class="n">CMSApp</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Oscar&quot;</span><span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="n">application</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">exclude_permissions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;dashboard&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="automatically-restart-server-on-apphook-changes">
<h2>Automatically restart server on apphook changes<a class="headerlink" href="#automatically-restart-server-on-apphook-changes" title="Permalink to this headline">¶</a></h2>
<p>As mentioned above, whenever you:</p>
<ul class="simple">
<li>add or remove an apphook</li>
<li>change the slug of a page containing an apphook</li>
<li>change the slug of a page with a descendant with an apphook</li>
</ul>
<p>The CMS the server will reload its URL caches. It does this by listening for
the signal: <code class="xref py py-obj docutils literal"><span class="pre">cms.signals.urls_need_reloading</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This signal does not actually do anything itself. For automated server
restarting you need to implement logic in your project that gets executed
whenever this signal is fired. Because there are many ways of deploying
Django applications, there is no way we can provide a generic solution for
this problem that will always work.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The signal is fired <strong>after</strong> a request. If you change something via an API
you&#8217;ll need a request for the signal to fire.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="templates.html" class="btn btn-neutral float-right" title="Working with templates" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="menus.html" class="btn btn-neutral" title="Customising navigation menus" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2015, Patrick Lauber.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.3.0.dev4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>