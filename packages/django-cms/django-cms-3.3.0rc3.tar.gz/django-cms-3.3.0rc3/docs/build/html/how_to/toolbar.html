

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extending the Toolbar &mdash; django cms 3.3.0.dev4 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="django cms 3.3.0.dev4 documentation" href="../index.html"/>
        <link rel="up" title="How-to guides" href="index.html"/>
        <link rel="next" title="Testing Your Extensions" href="testing.html"/>
        <link rel="prev" title="Extending the page &amp; title models" href="extending_page_title.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> django cms
          

          
          </a>

          
            
            
              <div class="version">
                3.3.0.dev4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">How-to guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Installing django CMS by hand</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_plugins.html">Custom Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="menus.html">Customising navigation menus</a></li>
<li class="toctree-l2"><a class="reference internal" href="apphooks.html">Apphooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html">Working with templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending_page_title.html">Extending the page &amp; title models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Extending the Toolbar</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#registering">Registering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-items">Adding items</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modifying-an-existing-toolbar">Modifying an existing toolbar</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-items-alphabetically">Adding Items Alphabetically</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-items-through-views">Adding items through views</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#frontend">Frontend</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing Your Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="placeholders.html">Placeholders outside the CMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="caching.html">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="frontend_models.html">Frontend editing for Page and Django models</a></li>
<li class="toctree-l2"><a class="reference internal" href="sitemap.html">Sitemap Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_types.html">Page Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="wizards.html">Content creation wizards</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing a patch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../topics/index.html">Key topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Development &amp; community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade/index.html">Release notes &amp; upgrade information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">Using django CMS</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">django cms</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">How-to guides</a> &raquo;</li>
      
    <li>Extending the Toolbar</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/how_to/toolbar.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extending-the-toolbar">
<h1>Extending the Toolbar<a class="headerlink" href="#extending-the-toolbar" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.0.</span></p>
</div>
<p>You can add and remove toolbar items. This allows you to integrate django CMS&#8217;s frontend editing
mode into your application, and provide your users with a streamlined editing experience.</p>
<p>For the toolbar API reference, please refer to <a class="reference internal" href="../reference/api_references.html#toolbar-api-reference"><span>cms.toolbar</span></a>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p><strong>Overlay</strong> and <strong>sideframe</strong></p>
<p>Then django CMS <em>sideframe</em> has been replaced with an <em>overlay</em> mechanism. The API still refers
to the <code class="docutils literal"><span class="pre">sideframe</span></code>, because it is invoked in the same way, and what has changed is merely the
behaviour in the user&#8217;s browser.</p>
<p class="last">In other words, <em>sideframe</em> and the <em>overlay</em> refer to different versions of the same thing.</p>
</div>
<div class="section" id="registering">
<h2>Registering<a class="headerlink" href="#registering" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to control what gets shown in the toolbar.</p>
<p>One is the <a class="reference internal" href="../reference/configuration.html#std:setting-CMS_TOOLBARS"><code class="xref std std-setting docutils literal"><span class="pre">CMS_TOOLBARS</span></code></a>. This gives you full control over which
classes are loaded, but requires that you specify them all manually.</p>
<p>The other is to provide <code class="docutils literal"><span class="pre">cms_toolbars.py</span></code> files in your apps, which will be
automatically loaded as long <a class="reference internal" href="../reference/configuration.html#std:setting-CMS_TOOLBARS"><code class="xref std std-setting docutils literal"><span class="pre">CMS_TOOLBARS</span></code></a> is not set (or is set to
<code class="docutils literal"><span class="pre">None</span></code>).</p>
<p>If you use the automated way, your <code class="docutils literal"><span class="pre">cms_toolbars.py</span></code> file should contain
classes that extend <code class="docutils literal"><span class="pre">cms.toolbar_base.CMSToolbar</span></code> and are registered using <code class="xref py py-meth docutils literal"><span class="pre">cms.toolbar_pool.toolbar_pool.register()</span></code>.
The register function can be used as a decorator.</p>
<p>These classes have four attributes:
* <code class="docutils literal"><span class="pre">toolbar</span></code> (the toolbar object)
* <code class="docutils literal"><span class="pre">request</span></code> (the current request)
* <code class="docutils literal"><span class="pre">is_current_app</span></code> (a flag indicating whether the current request is handled by the same app as the function is in)
* <code class="docutils literal"><span class="pre">app_path</span></code> (the name of the app used for the current request)</p>
<p>These classes must implement a <code class="docutils literal"><span class="pre">populate</span></code> or <code class="docutils literal"><span class="pre">post_template_populate</span></code> function. An optional
<code class="docutils literal"><span class="pre">request_hook</span></code> function is available for you to overwrite as well.</p>
<ul class="simple">
<li>The populate functions will only be called if the current user is a staff user.</li>
<li>The <code class="docutils literal"><span class="pre">populate</span></code> function will be called before the template and plugins are rendered.</li>
<li>The <code class="docutils literal"><span class="pre">post_template_populate</span></code> function will be called after the template is rendered.</li>
<li>The <code class="docutils literal"><span class="pre">request_hook</span></code> function is called before the view and may return a response. This way you
can issue redirects from a toolbar if needed</li>
</ul>
<p>These classes can define an optional <code class="docutils literal"><span class="pre">supported_apps</span></code> attribute, specifying which applications
the toolbar will work with. This is useful when the toolbar is defined in a different application
from the views it&#8217;s related to.</p>
<p><code class="docutils literal"><span class="pre">supported_apps</span></code> is a tuple of application dotted paths (e.g: <code class="docutils literal"><span class="pre">supported_apps</span> <span class="pre">=</span>
<span class="pre">('whatever.path.app',</span> <span class="pre">'another.path.app')</span></code>.</p>
<p>A simple example, registering a class that does nothing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">NoopModifier</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">post_template_populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">request_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Up to version 3.1 the module was named <code class="docutils literal"><span class="pre">cms_toolbar.py</span></code>. Please
update your existing modules to the new naming convention.
Support for the old name will be removed in version 3.4.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As the toolbar passed to <code class="docutils literal"><span class="pre">post_template_populate</span></code> has been already populated with items from
other applications, it might contain different items when processed by <code class="docutils literal"><span class="pre">populate</span></code>.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can change the toolbar or add items inside a plugin render method
(<code class="docutils literal"><span class="pre">context['request'].toolbar</span></code>) or inside a view (<code class="docutils literal"><span class="pre">request.toolbar</span></code>)</p>
</div>
</div>
<div class="section" id="adding-items">
<h2>Adding items<a class="headerlink" href="#adding-items" title="Permalink to this headline">¶</a></h2>
<p>Items can be added through the various <a class="reference internal" href="../reference/api_references.html#toolbar-api-reference"><span>APIs</span></a>
exposed by the toolbar and its items.</p>
<p>To add a <a class="reference internal" href="../reference/api_references.html#cms.toolbar.items.Menu" title="cms.toolbar.items.Menu"><code class="xref py py-class docutils literal"><span class="pre">cms.toolbar.items.Menu</span></code></a> to the toolbar, use
<a class="reference internal" href="../reference/api_references.html#cms.toolbar.toolbar.CMSToolbar.get_or_create_menu" title="cms.toolbar.toolbar.CMSToolbar.get_or_create_menu"><code class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.toolbar.CMSToolbar.get_or_create_menu()</span></code></a>.</p>
<p>Then, to add a link to your changelist that will open in the sideframe, use the
<a class="reference internal" href="../reference/api_references.html#cms.toolbar.items.ToolbarMixin.add_sideframe_item" title="cms.toolbar.items.ToolbarMixin.add_sideframe_item"><code class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.items.ToolbarMixin.add_sideframe_item()</span></code></a> method on the menu
object returned.</p>
<p>When adding items, all arguments other than the name or identifier should be
given as <strong>keyword arguments</strong>. This will help ensure that your custom toolbar
items survive upgrades.</p>
<p>Following our <a class="reference internal" href="../introduction/toolbar.html"><em>Extending the Toolbar</em></a>, let&#8217;s add the poll app
to the toolbar:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">PollToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_current_app</span><span class="p">:</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="s">&#39;poll-app&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Polls&#39;</span><span class="p">))</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_changelist&#39;</span><span class="p">)</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Poll overview&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>However, there&#8217;s already a menu added by the CMS which provides access to
various admin views, so you might want to add your menu as a sub menu there.
To do this, you can use positional insertion coupled with the fact that
<a class="reference internal" href="../reference/api_references.html#cms.toolbar.toolbar.CMSToolbar.get_or_create_menu" title="cms.toolbar.toolbar.CMSToolbar.get_or_create_menu"><code class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.toolbar.CMSToolbar.get_or_create_menu()</span></code></a> will return already existing
menus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar.items</span> <span class="kn">import</span> <span class="n">Break</span>
<span class="kn">from</span> <span class="nn">cms.cms_toolbars</span> <span class="kn">import</span> <span class="n">ADMIN_MENU_IDENTIFIER</span><span class="p">,</span> <span class="n">ADMINISTRATION_BREAK</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">PollToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">admin_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="n">ADMIN_MENU_IDENTIFIER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Site&#39;</span><span class="p">))</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">find_first</span><span class="p">(</span><span class="n">Break</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">ADMINISTRATION_BREAK</span><span class="p">)</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="s">&#39;poll-menu&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Polls&#39;</span><span class="p">),</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_changelist&#39;</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Poll overview&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
        <span class="n">admin_menu</span><span class="o">.</span><span class="n">add_break</span><span class="p">(</span><span class="s">&#39;poll-break&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">menu</span><span class="p">)</span>
</pre></div>
</div>
<p>If you wish to simply detect the presence of a menu without actually creating
it, you can use <code class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.toolbar.CMSToolbar.get_menu()</span></code>, which will
return the menu if it is present, or, if not, will return <code class="docutils literal"><span class="pre">None</span></code>.</p>
</div>
<div class="section" id="modifying-an-existing-toolbar">
<h2>Modifying an existing toolbar<a class="headerlink" href="#modifying-an-existing-toolbar" title="Permalink to this headline">¶</a></h2>
<p>If you need to modify an existing toolbar (say to change the <code class="docutils literal"><span class="pre">supported_apps</span></code> attribute) you can
do this by extending the original one, and modifying the appropriate attribute.</p>
<p>If <a class="reference internal" href="../reference/configuration.html#std:setting-CMS_TOOLBARS"><code class="xref std std-setting docutils literal"><span class="pre">CMS_TOOLBARS</span></code></a> is used to register the toolbars, add your own toolbar instead of the
original one, otherwise unregister the original and register your own:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">third.party.app.cms.toolbar_base</span> <span class="kn">import</span> <span class="n">FooToolbar</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">BarToolbar</span><span class="p">(</span><span class="n">FooToolbar</span><span class="p">):</span>
    <span class="n">supported_apps</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;third.party.app&#39;</span><span class="p">,</span> <span class="s">&#39;your.app&#39;</span><span class="p">)</span>

<span class="n">toolbar_pool</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">FooToolbar</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="adding-items-alphabetically">
<h3>Adding Items Alphabetically<a class="headerlink" href="#adding-items-alphabetically" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is desirable to add sub-menus from different applications
alphabetically. This can be challenging due to the non-obvious manner in which
your apps will be loaded into Django and is further complicated when you add new
applications over time.</p>
<p>To aid developers, django-cms exposes a <code class="xref py py-meth docutils literal"><span class="pre">cms.toolbar.items.ToolbarMixin.get_alphabetical_insert_position()</span></code>
method, which, if used consistently, can produce alphabetised sub-menus, even
when they come from multiple applications.</p>
<p>An example is shown here for an &#8216;Offices&#8217; app, which allows handy access to
certain admin functions for managing office locations in a project:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_base</span> <span class="kn">import</span> <span class="n">CMSToolbar</span>
<span class="kn">from</span> <span class="nn">cms.toolbar_pool</span> <span class="kn">import</span> <span class="n">toolbar_pool</span>
<span class="kn">from</span> <span class="nn">cms.toolbar.items</span> <span class="kn">import</span> <span class="n">Break</span><span class="p">,</span> <span class="n">SubMenu</span>
<span class="kn">from</span> <span class="nn">cms.cms_toolbars</span> <span class="kn">import</span> <span class="n">ADMIN_MENU_IDENTIFIER</span><span class="p">,</span> <span class="n">ADMINISTRATION_BREAK</span>

<span class="nd">@toolbar_pool.register</span>
<span class="k">class</span> <span class="nc">OfficesToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#</span>
        <span class="c"># &#39;Apps&#39; is the spot on the existing djang-cms toolbar admin_menu</span>
        <span class="c"># &#39;where we&#39;ll insert all of our applications&#39; menus.</span>
        <span class="c">#</span>
        <span class="n">admin_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span>
            <span class="n">ADMIN_MENU_IDENTIFIER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Apps&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># Let&#39;s check to see where we would insert an &#39;Offices&#39; menu in the</span>
        <span class="c"># admin_menu.</span>
        <span class="c">#</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">get_alphabetical_insert_position</span><span class="p">(</span>
            <span class="n">_</span><span class="p">(</span><span class="s">&#39;Offices&#39;</span><span class="p">),</span>
            <span class="n">SubMenu</span>
        <span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># If zero was returned, then we know we&#39;re the first of our</span>
        <span class="c"># applications&#39; menus to be inserted into the admin_menu, so, here</span>
        <span class="c"># we&#39;ll compute that we need to go after the first</span>
        <span class="c"># ADMINISTRATION_BREAK and, we&#39;ll insert our own break after our</span>
        <span class="c"># section.</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">position</span><span class="p">:</span>
            <span class="c"># OK, use the ADMINISTRATION_BREAK location + 1</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">find_first</span><span class="p">(</span>
                <span class="n">Break</span><span class="p">,</span>
                <span class="n">identifier</span><span class="o">=</span><span class="n">ADMINISTRATION_BREAK</span>
            <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c"># Insert our own menu-break, at this new position. We&#39;ll insert</span>
            <span class="c"># all subsequent menus before this, so it will ultimately come</span>
            <span class="c"># after all of our applications&#39; menus.</span>
            <span class="n">admin_menu</span><span class="o">.</span><span class="n">add_break</span><span class="p">(</span><span class="s">&#39;custom-break&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>

        <span class="c"># OK, create our office menu here.</span>
        <span class="n">office_menu</span> <span class="o">=</span> <span class="n">admin_menu</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span>
            <span class="s">&#39;offices-menu&#39;</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s">&#39;Offices ...&#39;</span><span class="p">),</span>
            <span class="n">position</span><span class="o">=</span><span class="n">position</span>
        <span class="p">)</span>

        <span class="c"># Let&#39;s add some sub-menus to our office menu that help our users</span>
        <span class="c"># manage office-related things.</span>

        <span class="c"># Take the user to the admin-listing for offices...</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:offices_office_changelist&#39;</span><span class="p">)</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Offices List&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="c"># Display a modal dialogue for creating a new office...</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:offices_office_add&#39;</span><span class="p">)</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_modal_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Add New Office&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="c"># Add a break in the sub-menus</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_break</span><span class="p">()</span>

        <span class="c"># More sub-menus...</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:offices_state_changelist&#39;</span><span class="p">)</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;States List&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:offices_state_add&#39;</span><span class="p">)</span>
        <span class="n">office_menu</span><span class="o">.</span><span class="n">add_modal_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Add New State&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is the resulting toolbar (with a few other menus sorted alphabetically
beside it)</p>
<p><img alt="alphabetized-toolbar-app-menus" src="../_images/alphabetized-toolbar-app-menus.png" /></p>
</div>
<div class="section" id="adding-items-through-views">
<h3>Adding items through views<a class="headerlink" href="#adding-items-through-views" title="Permalink to this headline">¶</a></h3>
<p>Another way to add items to the toolbar is through our own views (<code class="docutils literal"><span class="pre">polls/views.py</span></code>).
This method can be useful if you need to access certain variables, in our case e.g. the
selected poll and its sub-methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Poll</span>


<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="n">menu</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">get_or_create_menu</span><span class="p">(</span><span class="s">&#39;polls-app&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Polls&#39;</span><span class="p">))</span>
    <span class="n">menu</span><span class="o">.</span><span class="n">add_modal_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Change this Poll&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_change&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">poll_id</span><span class="p">]))</span>
    <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Show History of this Poll&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_history&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">poll_id</span><span class="p">]))</span>
    <span class="n">menu</span><span class="o">.</span><span class="n">add_sideframe_item</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Delete this Poll&#39;</span><span class="p">),</span> <span class="n">url</span><span class="o">=</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:polls_poll_delete&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">poll_id</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;polls/detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">poll</span><span class="p">})</span>
</pre></div>
</div>
<div class="section" id="detecting-url-changes">
<span id="url-changes"></span><h4>Detecting URL changes<a class="headerlink" href="#detecting-url-changes" title="Permalink to this headline">¶</a></h4>
<p>Sometimes toolbar entries allow you to change the URL of the current object displayed in the
website.</p>
<p>For example, suppose you are viewing a blog entry, and the toolbar allows the blog slug or URL to
be edited. The toolbar will watch the <code class="docutils literal"><span class="pre">django.contrib.admin.models.LogEntry</span></code> model and detect if
you create or edit an object in the admin via modal or sideframe view. After the modal or sideframe
closes it will redirect to the new URL of the object.</p>
<p>To set this behaviour manually you can set the <code class="docutils literal"><span class="pre">request.toolbar.set_object()</span></code> function on which you can set the current object.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;toolbar&#39;</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">set_object</span><span class="p">(</span><span class="n">poll</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;polls/detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;poll&#39;</span><span class="p">:</span> <span class="n">poll</span><span class="p">})</span>
</pre></div>
</div>
<p>If you want to watch for object creation or editing of models and redirect after they have been
added or changed add a <code class="docutils literal"><span class="pre">watch_models</span></code> attribute to your toolbar.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PollToolbar</span><span class="p">(</span><span class="n">CMSToolbar</span><span class="p">):</span>

    <span class="n">watch_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">Poll</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>After you add this every change to an instance of <code class="docutils literal"><span class="pre">Poll</span></code> via sideframe or modal window will
trigger a redirect to the URL of the poll instance that was edited, according to the toolbar
status: if in <em>draft</em> mode the <code class="docutils literal"><span class="pre">get_draft_url()</span></code> is returned (or <code class="docutils literal"><span class="pre">get_absolute_url()</span></code> if the
former does not exists), if in <em>live</em> mode and the method exists <code class="docutils literal"><span class="pre">get_public_url()</span></code> is returned.</p>
</div>
</div>
</div>
<div class="section" id="frontend">
<h2>Frontend<a class="headerlink" href="#frontend" title="Permalink to this headline">¶</a></h2>
<p>The toolbar adds a class <code class="docutils literal"><span class="pre">cms-ready</span></code> to the <strong>html</strong> tag when ready. Additionally we add
<code class="docutils literal"><span class="pre">cms-toolbar-expanded</span></code> when the toolbar is visible (expanded).</p>
<p>The toolbar also fires a JavaScript event called <strong>cms-ready</strong> on the document.
You can listen to this event using jQuery:</p>
<div class="highlight-python"><div class="highlight"><pre>CMS.$(document).on(&#39;cms-ready&#39;, function () { ... });
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="testing.html" class="btn btn-neutral float-right" title="Testing Your Extensions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="extending_page_title.html" class="btn btn-neutral" title="Extending the page &amp; title models" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2015, Patrick Lauber.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.3.0.dev4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>