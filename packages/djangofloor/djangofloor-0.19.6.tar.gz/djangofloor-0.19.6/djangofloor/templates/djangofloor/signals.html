$(function () {
{% if use_ws4redis %}
    df.ws4redis_connect = function (window_key) {
        df.ws4redis = WS4Redis({
            uri: '{{ WEBSOCKET_URI }}djangofloor?subscribe-broadcast&subscribe-user&subscribe-session&publish-broadcast',
            receive_message: function (msg) { setTimeout(function() { var parsed = JSON.parse(msg); df.call(parsed.signal, parsed.options, true); }, 0); },
            heartbeat_msg: {{ WS4REDIS_HEARTBEAT }}
        });
        df.window_key = window_key;
        df.ws4redis_window = WS4Redis({
            uri: '{{ WEBSOCKET_URI }}' + window_key + '?subscribe-broadcast',
            receive_message: function (msg) { setTimeout(function() { var parsed = JSON.parse(msg); df.call(parsed.signal, parsed.options, true); }, 0); },
            heartbeat_msg: {{ WS4REDIS_HEARTBEAT }}
        });
    };
    {% for name in signals %}df.connect_ws('{{ name }}');
    {% endfor %}{% else %}
    df.ws4redis_connect = function (window_key) {
        df.window_key = window_key;
    };
    {% if WS4REDIS_EMULATION_INTERVAL > 0 %}
    setInterval(function () { df.connect_ws_emulator('{% url 'df_get_signal_calls' %}'); }, {{ WS4REDIS_EMULATION_INTERVAL }});{% endif %}
    {% for name in signals %}df.connect_http('{{ name }}', "{% url 'df_signal_call' signal=name %}");
    {% endfor %}{% endif %}
});

