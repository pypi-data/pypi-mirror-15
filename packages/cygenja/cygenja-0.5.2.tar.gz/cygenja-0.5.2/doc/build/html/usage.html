<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Usage &mdash; cygenja 0.5.1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.2.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="cygenja 0.5.1 documentation" href="contents.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Installing cygenja" href="installation.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="contents.html">
          cygenja</a>
        <span class="navbar-text navbar-version pull-left"><b>0.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="contents.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installing <strong class="program">cygenja</strong></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#the-generator-class">The <cite>Generator</cite> class</a><ul>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#raising-exceptions-on-warnings">Raising exceptions on <em>Warnings</em></a></li>
</ul>
</li>
<li><a class="reference internal" href="#patterns">Patterns</a></li>
<li><a class="reference internal" href="#the-root-directory">The <em>root</em> directory</a></li>
<li><a class="reference internal" href="#filters">Filters</a></li>
<li><a class="reference internal" href="#file-extensions">File extensions</a></li>
<li><a class="reference internal" href="#actions">Actions</a><ul>
<li><a class="reference internal" href="#user-callback">User callback</a></li>
<li><a class="reference internal" href="#incompatible-actions">Incompatible actions</a></li>
<li><a class="reference internal" href="#default-action">Default action</a></li>
</ul>
</li>
<li><a class="reference internal" href="#file-generation">File generation</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="installation.html" title="Previous Chapter: Installing cygenja"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Installing cygen...</span>
    </a>
  </li>
  <li>
    <a href="examples.html" title="Next Chapter: Examples"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Examples &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="usage">
<span id="cygenja-usage"></span><h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>We briefly describe the use of <strong class="program">cygenja</strong>. Basically, you register some filters, file extensions and actions before triggering the translation.
In the <a class="reference internal" href="examples.html#cygenja-examples"><span>Examples</span></a> section, you can see <strong class="program">cygenja</strong> in action as we detail its use to generate the <a class="reference external" href="https://github.com/PythonOptimizers/cysparse">CySparse</a> library.</p>
<div class="section" id="the-generator-class">
<span id="generator-class"></span><h2>The <cite>Generator</cite> class<a class="headerlink" href="#the-generator-class" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-class docutils literal"><span class="pre">Generator</span></code> class is the main class of the <strong class="program">cygenja</strong> library. It also is the only
class you need to interact with. Its constructor is really simple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cygenja.generator</span> <span class="kn">import</span> <span class="n">Generator</span>
<span class="o">...</span>

<span class="n">logger</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">env</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="s">&#39;root_directory&#39;</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>You provide a <code class="docutils literal"><span class="pre">root_directory</span></code> directory, a <strong class="program">Jinja2</strong>  environment, a <em>logger</em>
(from the standard <code class="docutils literal"><span class="pre">logging</span></code> library) and decide if <em>warnings</em> must raise <cite>Exception</cite>s or not (default: <code class="docutils literal"><span class="pre">False</span></code>). The first two arguments are mandatory while the last two are optional. You don&#8217;t have to provide
a logging engine. We describe the root directory a little further in <a class="reference internal" href="#root-directory"><span>The root directory</span></a>, refer the reader to <a class="reference external" href="http://jinja.pocoo.org/docs/dev/api/#jinja2.Environment">jinja2.Environment</a> for more about
the <code class="docutils literal"><span class="pre">env</span></code> argument and discuss the two last arguments
in the next corresponding subsections.</p>
<div class="section" id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h3>
<p>A logging engine <em>can</em> be used but is not mandatory. If you don&#8217;t want to log <strong class="program">cygenja</strong>&#8216;s behavior, simply pass <cite>None</cite> as the value of the logger argument in the constructor (this is the default). The logging engine is
an object from Python&#8217;s <a class="reference external" href="https://docs.python.org/2/library/logging.html">logging library</a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cygenja.generator</span> <span class="kn">import</span> <span class="n">Generator</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;Logger name&#39;</span><span class="p">)</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="s">&#39;root_directory&#39;</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Three message logging helpers are provided:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">log_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">log_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<p>Their names and signatures are quite self-explanatory.</p>
</div>
<div class="section" id="raising-exceptions-on-warnings">
<h3>Raising exceptions on <em>Warnings</em><a class="headerlink" href="#raising-exceptions-on-warnings" title="Permalink to this headline">¶</a></h3>
<p>Errors <strong>always</strong> trigger <cite>RuntimeError</cite>s while warnings may or may not trigger <cite>RuntimeError</cite>s. To raise exceptions on warnings, set the <code class="docutils literal"><span class="pre">raise_exception_on_warning</span></code> to <code class="docutils literal"><span class="pre">True</span></code> in the
constructor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="s">&#39;root_directory&#39;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">raise_exception_on_warning</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, <code class="docutils literal"><span class="pre">raise_exception_on_warning</span></code> is set to <code class="docutils literal"><span class="pre">False</span></code>.</p>
</div>
</div>
<div class="section" id="patterns">
<h2>Patterns<a class="headerlink" href="#patterns" title="Permalink to this headline">¶</a></h2>
<p id="index-0">There are only <strong>two</strong> types of patterns:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/2/library/fnmatch.html">fnmatch</a> patterns for file names and</li>
<li><a class="reference external" href="https://docs.python.org/2/library/glob.html">glob</a> patterns for directory names.</li>
</ul>
<p>This is a general rule for the whole library. When you register an action though, you must provide a directory name, <strong>not</strong> a directory name pattern.</p>
<p>We encourage the reader to (re)read the specifications of these two libraries.</p>
</div>
<div class="section" id="the-root-directory">
<span id="root-directory"></span><h2>The <em>root</em> directory<a class="headerlink" href="#the-root-directory" title="Permalink to this headline">¶</a></h2>
<p id="index-1">The root directory is really the main working directory: all file generations can <strong>only</strong> be done inside <strong>subdirectories</strong> of this directory.</p>
<p>This is so important that it is worth a warning:</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">File generations can <strong>only</strong> be done inside <strong>subdirectories</strong> of the <em>root</em> directory.</p>
</div>
<p>This directory is given as the first parameter of <code class="xref py py-class docutils literal"><span class="pre">Generator</span></code>&#8216;s constructor
and can be absolute or relative. At any moment, you can retrieve this directory as an absolute path:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="s">&#39;root_directory&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="n">absolute_root_directory</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">root_directory</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="filters">
<h2>Filters<a class="headerlink" href="#filters" title="Permalink to this headline">¶</a></h2>
<p>Filters are simply <strong class="program">Jinja2</strong> <a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/#filters">filters</a>. These filters are <em>registered</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">my_jinja2_filter</span><span class="p">(</span><span class="n">filter_argument</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">filter_result</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">engine</span><span class="o">.</span><span class="n">register_filter</span><span class="p">(</span><span class="s">&#39;my_filter_name&#39;</span><span class="p">,</span> <span class="n">my_jinja2_filter</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">'my_filter_name'</span></code> is the name of the filter used inside your <strong class="program">Jinja2</strong> template files and <code class="docutils literal"><span class="pre">my_jinja2_filter</span></code> is a reference to the actual filter.</p>
<p>The signature of <code class="docutils literal"><span class="pre">register_filter</span></code> is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">register_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_name</span><span class="p">,</span> <span class="n">filter_ref</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>allowing you to register a new filter under an already existing filter name. If you keep <code class="docutils literal"><span class="pre">force</span></code> set to <code class="docutils literal"><span class="pre">False</span></code>, a warning is triggered each time you try to register a
new filter under an already existing filter name and this <strong>new</strong> filter is disregarded.</p>
<p>You also can register several filters at once with a dictionary of filters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">filters</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;f1&#39;</span> <span class="p">:</span> <span class="n">filter1</span><span class="p">,</span>
            <span class="s">&#39;f2&#39;</span> <span class="p">:</span> <span class="n">filter2</span><span class="p">}</span>

<span class="n">engine</span><span class="o">.</span><span class="n">register_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>At any time, you can list the registered filters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="k">print</span> <span class="n">engine</span><span class="o">.</span><span class="n">filters_list</span><span class="p">()</span>
</pre></div>
</div>
<p>This list also includes predefined <strong class="program">Jinja2</strong> filters (see <a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/#builtin-filters">builtin filter</a>).
If you only want the filters you registered, invoke:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span><span class="o">.</span><span class="n">registered_filters_list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="file-extensions">
<span id="id2"></span><h2>File extensions<a class="headerlink" href="#file-extensions" title="Permalink to this headline">¶</a></h2>
<p><strong class="program">cygenja</strong> uses a correspondance table between template files and generated files. This table defines a correspondance between file <em>extensions</em>. For instance, to have <cite>*.cpd</cite> templates generate  <cite>*.pxd</cite> files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">engine</span><span class="o">.</span><span class="n">register_extension</span><span class="p">(</span><span class="sb">`.cpd`</span><span class="p">,</span> <span class="sb">`.pxd`</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, we use a <code class="docutils literal"><span class="pre">force</span></code> switch to force the redefinition of such a correspondance. By default, this switch is set to <code class="docutils literal"><span class="pre">False</span></code> and if you try to redefine an association with a given template extension, you will
trigger a warning and this new correspondance will be disregarded.</p>
<p>You can use a <code class="docutils literal"><span class="pre">dict</span></code> to register several extensions at once:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">ext_correspondance</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;.cpd&#39;</span> <span class="p">:</span> <span class="s">&#39;.pxd&#39;</span><span class="p">,</span>
                       <span class="s">&#39;.cpx&#39;</span> <span class="p">:</span> <span class="s">&#39;pyx&#39;</span><span class="p">}</span>
<span class="n">engine</span><span class="o">.</span><span class="n">register_extensions</span><span class="p">(</span><span class="n">ext_correspondance</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</pre></div>
</div>
<p>As with filters, you can retrieve the registered extensions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span><span class="o">.</span><span class="n">registered_extensions_list</span><span class="p">()</span>
</pre></div>
</div>
<p>Files with extensions registered as template file extensions are systematically parsed, i.e. you cannot use these extensions for files that are not templates because <strong class="program">cygenja</strong> will try to parse them.
What about generated file extensions? Files with these extensions can peacefully coexist with generated files, i.e. existing files,
regardless of their extensions, can coexist with generated files and will not be plagued by <strong class="program">cyjenja</strong>. This means that you can safely delete files: only generated files will be deleted <a class="footnote-reference" href="#footnote-existing-files" id="id3">[1]</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only generated files are deleted. You can thus safely delete files with <strong class="program">cygenja</strong>.</p>
</div>
</div>
<div class="section" id="actions">
<h2>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<p id="index-3">Actions (defined in the <code class="docutils literal"><span class="pre">GeneratorAction</span></code> class) are really the core concept of <strong class="program">cygenja</strong>: an action correspond to a <em>translation rule</em>. This translation rule makes a correspondance between a subdirectory
and a file pattern and a user callback. Here is the signature of the <code class="docutils literal"><span class="pre">register_action</span></code> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">register_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative_directory</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">,</span> <span class="n">action_function</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">relative_directory</span></code> argument holds the name of a relative directory from the <em>root</em> directory. The separator is OS dependent. For instance,
under linux, you can register the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">action_function</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="o">...</span>

<span class="n">engine</span><span class="o">.</span><span class="n">register_action</span><span class="p">(</span><span class="s">&#39;cysparse/sparse/utils&#39;</span><span class="p">,</span> <span class="s">&#39;find*.cpy&#39;</span><span class="p">,</span> <span class="n">action_function</span><span class="p">)</span>
</pre></div>
</div>
<p>This means that all files corresponding to the <code class="docutils literal"><span class="pre">'find*.cpy'</span></code> <a class="reference external" href="https://docs.python.org/2/library/fnmatch.html">fnmatch</a> pattern inside the <code class="docutils literal"><span class="pre">cysparse/sparse/utils</span></code>
directory can be dealt with the <code class="docutils literal"><span class="pre">action_function</span></code>.</p>
<p>Contrary to filters and file extensions, you <strong>cannot</strong> ask for a list of registered actions. But you can ask <strong class="program">cygenja</strong> to perform a <cite>dry</cite> session: <strong class="program">cygenja</strong> outputs what it would normaly do but without
taking any action <a class="footnote-reference" href="#footnote-treemap-to-string-html" id="id5">[2]</a>.</p>
<div class="section" id="user-callback">
<h3>User callback<a class="headerlink" href="#user-callback" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">action_function()</span></code> is a user-defined callback without argument. It returns a file suffix with a corresponding <strong class="program">Jinja2</strong>
<a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/#variables">variables dict</a> (this is a simple <strong class="program">Python</strong> <code class="docutils literal"><span class="pre">dict</span></code>). Let&#8217;s illustrate this by an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">GENERAL_CONTEXT</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="n">INDEX_TYPES</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;INT32&#39;</span><span class="p">,</span> <span class="s">&#39;INT64&#39;</span><span class="p">]</span>
<span class="n">ELEMENT_TYPES</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;FLOAT32&#39;</span><span class="p">,</span> <span class="s">&#39;FLOAT64&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">generate_following_index_and_type</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">INDEX_TYPES</span><span class="p">:</span>
        <span class="n">GENERAL_CONTEXT</span><span class="p">[</span><span class="s">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">ELEMENT_TYPES</span><span class="p">:</span>
            <span class="n">GENERAL_CONTEXT</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
            <span class="k">yield</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">type</span><span class="p">),</span> <span class="n">GENERAL_CONTEXT</span>
</pre></div>
</div>
<p>The user-defined callback <code class="docutils literal"><span class="pre">generate_following_index_and_type()</span></code> doesn&#8217;t take any input argument and returns the <code class="docutils literal"><span class="pre">'_%s_%s'</span></code> suffix string together with the variables <code class="docutils literal"><span class="pre">dict</span></code> <code class="docutils literal"><span class="pre">GENERAL_CONTEXT</span></code>.
This function allows <strong class="program">cygenja</strong> to create files with this suffix from any matching template file. The <code class="docutils literal"><span class="pre">GENERAL_CONTEXT</span></code> is given to <strong class="program">Jinja2</strong> for the appropriate translation.</p>
<p>For instance, let&#8217;s use the <code class="docutils literal"><span class="pre">ext_correspondance</span></code> extensions <code class="docutils literal"><span class="pre">dict</span></code> discussed earlier (see <a class="reference internal" href="#file-extensions"><span>File extensions</span></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ext_correspondance</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;.cpd&#39;</span> <span class="p">:</span> <span class="s">&#39;.pxd&#39;</span><span class="p">,</span>
                       <span class="s">&#39;.cpx&#39;</span> <span class="p">:</span> <span class="s">&#39;pyx&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Any template file with a <code class="docutils literal"><span class="pre">.cpd</span></code> or <code class="docutils literal"><span class="pre">.cpx</span></code> extension will be translated into a <code class="docutils literal"><span class="pre">_index_type.pxd</span></code> or <code class="docutils literal"><span class="pre">_index_type.pyx</span></code> file respectively. For instance, the template file <code class="docutils literal"><span class="pre">my_template_code_file.cpd</span></code> will be translated to:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">my_template_code_file_INT32_FLOAT32.cpd</span></code></li>
<li><code class="docutils literal"><span class="pre">my_template_code_file_INT32_FLOAT64.cpd</span></code></li>
<li><code class="docutils literal"><span class="pre">my_template_code_file_INT64_FLOAT32.cpd</span></code></li>
<li><code class="docutils literal"><span class="pre">my_template_code_file_INT64_FLOAT64.cpd</span></code></li>
</ul>
<p>As this function is defined by the user, you have total control on what you want to generate or not. In our example, we redefine <code class="docutils literal"><span class="pre">GENERAL_CONTEXT['index']</span></code> and <code class="docutils literal"><span class="pre">GENERAL_CONTEXT['type']</span></code> for each index and element types.</p>
<p>We use generators (<code class="docutils literal"><span class="pre">yield</span></code>) but you could return a <code class="docutils literal"><span class="pre">list</span></code> if you prefer.</p>
</div>
<div class="section" id="incompatible-actions">
<h3>Incompatible actions<a class="headerlink" href="#incompatible-actions" title="Permalink to this headline">¶</a></h3>
<p>You could register incompatible actions, i.e. register competing actions that would translate a file in different ways. Our approach is to <strong>only</strong> use the first compatible action and to disregard all the other actions, regardless
if they could be applied or not. So the order in which you register your actions is important. A file will be dealt with the <strong>first</strong> compatible action found. This is worth a warning:</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">A template is translated with the <strong>first</strong> compatible action found and only that action.</p>
</div>
</div>
<div class="section" id="default-action">
<h3>Default action<a class="headerlink" href="#default-action" title="Permalink to this headline">¶</a></h3>
<p><strong class="program">cygenja</strong> allows to define <strong>one</strong> default action that will be triggered when no other compatible action is found for a given
template file that corresponds to a <a class="reference external" href="https://docs.python.org/2/library/fnmatch.html">fnmatch</a> pattern:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">default_action</span><span class="p">():</span>
    <span class="k">return</span> <span class="o">...</span>

<span class="n">engine</span><span class="o">.</span><span class="n">register_default_action</span><span class="p">(</span><span class="s">&#39;*.*&#39;</span><span class="p">,</span>  <span class="n">default_action</span><span class="p">)</span>
</pre></div>
</div>
<p>Be careful when defining a default action. This action is applied to <strong>all</strong> template files (corresponding to the <strong class="program">fnmatch</strong> pattern) for
which no compatible action is found. You might want to prefer declaring explicit actions than relying on this
implicit default action. That said, if you have lots of default cases, this
default action can be very convenient and avoid lots of unnecessary action declarations.</p>
</div>
</div>
<div class="section" id="file-generation">
<h2>File generation<a class="headerlink" href="#file-generation" title="Permalink to this headline">¶</a></h2>
<p>To generate the files from template files, there is only <strong>one</strong> method to invoke: <cite>generate()</cite>. Its signature is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_pattern</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">,</span> <span class="n">action_ch</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span>
             <span class="n">recursively</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">dir_pattern</span></code> is a <code class="docutils literal"><span class="pre">glob</span></code> pattern taken from the root directory and it is <strong>only</strong> used for directories while <code class="docutils literal"><span class="pre">file_pattern</span></code> is a <code class="docutils literal"><span class="pre">fnmatch</span></code> pattern taken from all matching directories and is <strong>only</strong> used for files.
The <code class="docutils literal"><span class="pre">action_ch</span></code> is a character that triggers different behaviours:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">g</span></code>: Generate all files that match both directory and file patterns. This is the default behavior.</li>
<li><code class="docutils literal"><span class="pre">d</span></code>: Same as <cite>g</cite> but with doing anything, i.e. dry run.</li>
<li><code class="docutils literal"><span class="pre">c</span></code>: Same as <cite>g</cite> but erasing the generated files instead, i.e. clean.</li>
</ul>
<p>These actions can be done in a given directory or in all its corresponding subdirectories. To choose between these two options, use the <code class="docutils literal"><span class="pre">recursively</span></code> switch. Finally, by default, files are only generated if they are
outdated, i.e. if they are older than the template they were originated from. You can force the generation with the <code class="docutils literal"><span class="pre">force</span></code> switch.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="footnote-existing-files" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>The user is responsible to not to define a translation rule that overwrites any existing files.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="footnote-treemap-to-string-html" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[2]</a></td><td><p class="first">You also have access to the internal <code class="xref py py-class docutils literal"><span class="pre">TreeMap</span></code> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">engine</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">treemap</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">registered_actions_treemap</span><span class="p">()</span>
</pre></div>
</div>
<p class="last">and thus you have access to all its methods. One interesting method is <code class="docutils literal"><span class="pre">to_string()</span></code>. It gives you a representation of all involved subdirectories.</p>
</td></tr>
</tbody>
</table>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/usage.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2015, Sylvain Arreckx, Dominique Orban and Nikolaj van Omme.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>