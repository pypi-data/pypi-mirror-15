

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>numdifftools.limits &mdash; numdifftools 0.9.14.post0.dev10+gd22e9fa.dirty documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="numdifftools 0.9.14.post0.dev10+gd22e9fa.dirty documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> numdifftools</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../src/overview.html">Introduction to Numdifftools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../src/overview.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/overview.html#see-also">See also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../src/numerical/main.html">Numerical differentiation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#numerical-differentiation-of-a-general-function-of-one-variable">Numerical differentiation of a general function of one variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#unequally-spaced-finite-difference-rules">Unequally spaced finite difference rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#odd-and-even-transformations-of-a-function">Odd and even transformations of a function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#complex-step-derivative">Complex step derivative</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#high-order-derivative">High order derivative</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#richardson-extrapolation-methodology-applied-to-derivative-estimation">Richardson extrapolation methodology applied to derivative estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#multiple-term-richardson-extrapolants">Multiple term Richardson extrapolants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#uncertainty-estimates-for-derivative">Uncertainty estimates for Derivative</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#derivative-in-action">Derivative in action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#gradient-and-hessian-estimation">Gradient and Hessian  estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#conclusion">Conclusion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/numerical/derivest.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../src/algorithmic/main.html">Algorithmic differentiation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../src/algorithmic/ad.html">Numdifftools.nd_algopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src/algorithmic/ad.html#algoritmic-differentiation">Algoritmic differentiation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-9-14-november-10-2015">Version 0.9.14, November 10, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-9-13-october-30-2015">Version 0.9.13, October 30, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-9-12-august-28-2015">Version 0.9.12, August 28, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-9-11-august-27-2015">Version 0.9.11, August 27, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-9-10-august-26-2015">Version 0.9.10, August 26, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-9-4-august-26-2015">Version 0.9.4, August 26, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-9-3-august-23-2015">Version 0.9.3, August 23, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-9-2-august-20-2015">Version 0.9.2, August 20, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-9-1-august-20-2015">Version 0.9.1, August 20,2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-7-7-december-18-2014">Version 0.7.7, December 18, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-7-3-december-17-2014">Version 0.7.3, December 17, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-6-0-february-8-2014">Version 0.6.0, February 8, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-5-0-january-10-2014">Version 0.5.0, January 10, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-4-0-may-5-2012">Version 0.4.0, May 5, 2012</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-3-5-may-19-2011">Version 0.3.5, May 19, 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-3-4-feb-24-2011">Version 0.3.4, Feb 24, 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#version-0-3-1-may-20-2009">Version 0.3.1, May 20, 2009</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/modules.html">Module reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/numdifftools.html">numdifftools package</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">numdifftools</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>numdifftools.limits</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for numdifftools.limits</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on 27. aug. 2015</span>

<span class="sd">@author: pab</span>
<span class="sd">Author: John D&#39;Errico</span>
<span class="sd">e-mail: woodchips@rochester.rr.com</span>
<span class="sd">Release: 1.0</span>
<span class="sd">Release date: 5/23/2008</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">numdifftools.extrapolation</span> <span class="kn">import</span> <span class="n">Richardson</span><span class="p">,</span> <span class="n">dea3</span><span class="p">,</span> <span class="n">EPS</span>
<span class="n">_EPS</span> <span class="o">=</span> <span class="n">EPS</span>


<span class="k">def</span> <span class="nf">_make_exact</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make sure h is an exact representable number</span>

<span class="sd">    This is important when calculating numerical derivatives and is</span>
<span class="sd">    accomplished by adding 1 and then subtracting 1..</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>


<span class="k">def</span> <span class="nf">valarray</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">typecode</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an array of all value.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">typecode</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">typecode</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">typecode</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>


<span class="k">def</span> <span class="nf">nom_step</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return nominal step&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="mf">1.0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_default_base_step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">epsilon</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">_EPS</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span> <span class="o">*</span> <span class="n">nom_step</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">valarray</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span>


<div class="viewcode-block" id="MinStepGenerator"><a class="viewcode-back" href="../../api/generated/numdifftools.limits.MinStepGenerator.html#numdifftools.limits.MinStepGenerator">[docs]</a><span class="k">class</span> <span class="nc">MinStepGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a sequence of steps</span>

<span class="sd">    where steps = base_step * step_ratio ** (np.arange(num_steps) + offset)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    base_step : float, array-like, optional</span>
<span class="sd">        Defines the base step, if None, then base_step is set to</span>
<span class="sd">        EPS**(1/scale)*max(log(1+|x|), 1) where x is supplied at runtime</span>
<span class="sd">        through the __call__ method.</span>
<span class="sd">    step_ratio : real scalar, optional, default 4</span>
<span class="sd">        Ratio between sequential steps generated.</span>
<span class="sd">    num_steps : scalar integer, optional, default  n + order - 1 + num_extrap</span>
<span class="sd">        defines number of steps generated. It should be larger than</span>
<span class="sd">        n + order - 1</span>
<span class="sd">    offset : real scalar, optional, default 0</span>
<span class="sd">        offset to the base step</span>
<span class="sd">    scale : real scalar, optional</span>
<span class="sd">        scale used in base step. If not None it will override the default</span>
<span class="sd">        computed with the default_scale function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MinStepGenerator.__init__"><a class="viewcode-back" href="../../api/generated/numdifftools.limits.MinStepGenerator.html#numdifftools.limits.MinStepGenerator.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step_ratio</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">use_exact_steps</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_step</span> <span class="o">=</span> <span class="n">base_step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span> <span class="o">=</span> <span class="n">num_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_ratio</span> <span class="o">=</span> <span class="n">step_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_exact_steps</span> <span class="o">=</span> <span class="n">use_exact_steps</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">kwds</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">return</span> <span class="s">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwds</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_default_base_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">):</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">base_step</span> <span class="o">=</span> <span class="n">_default_base_step</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_step</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_exact_steps</span><span class="p">:</span>
            <span class="n">base_step</span> <span class="o">=</span> <span class="n">_make_exact</span><span class="p">(</span><span class="n">base_step</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">base_step</span>

    <span class="k">def</span> <span class="nf">_default_num_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2e7</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_ratio</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span>

    <span class="k">def</span> <span class="nf">_default_step_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">step_ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_ratio</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_exact_steps</span><span class="p">:</span>
            <span class="n">step_ratio</span> <span class="o">=</span> <span class="n">_make_exact</span><span class="p">(</span><span class="n">step_ratio</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">step_ratio</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">base_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_base_step</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
        <span class="n">step_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_step_ratio</span><span class="p">()</span>
        <span class="n">num_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_num_steps</span><span class="p">()</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">base_step</span> <span class="o">*</span> <span class="n">step_ratio</span><span class="o">**</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">offset</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">h</span>

</div>
<div class="viewcode-block" id="Limit"><a class="viewcode-back" href="../../api/generated/numdifftools.limits.Limit.html#numdifftools.limits.Limit">[docs]</a><span class="k">class</span> <span class="nc">Limit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute limit of a function at a given point</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f : callable</span>
<span class="sd">        function of one array f(z, `*args`, `**kwds`) to compute the limit for.</span>
<span class="sd">        The function, f, is assumed to return a result of the same shape and</span>
<span class="sd">        size as its input, `z`.</span>
<span class="sd">    step: float, complex, array-like or StepGenerator object, optional</span>
<span class="sd">        Defines the spacing used in the approximation.</span>
<span class="sd">        Default is  MinStepGenerator(base_step=step, step_ratio=4)</span>
<span class="sd">    method : {&#39;above&#39;, &#39;below&#39;}</span>
<span class="sd">        defines if the limit is taken from `above` or `below`</span>
<span class="sd">    order: positive scalar integer, optional.</span>
<span class="sd">        defines the order of approximation used to find the specified limit.</span>
<span class="sd">        The order must be member of [1 2 3 4 5 6 7 8]. 4 is a good compromise.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    limit_fz: array like</span>
<span class="sd">        estimated limit of f(z) as z --&gt; z0</span>
<span class="sd">    info:</span>
<span class="sd">        Only given if full_output is True and contains the following:</span>
<span class="sd">        error estimate: ndarray</span>
<span class="sd">            95 uncertainty estimate around the limit, such that</span>
<span class="sd">            abs(limit_fz - f(z0)*(z-z0)) &lt; error_estimate</span>
<span class="sd">        final_step: ndarray</span>
<span class="sd">            final step used in approximation</span>

<span class="sd">    Description</span>
<span class="sd">    -----------</span>
<span class="sd">    `Limit` computes the limit of a given function at a specified</span>
<span class="sd">    point, z0. When the function is evaluable at the point in question,</span>
<span class="sd">    this is a simple task. But when the function cannot be evaluated</span>
<span class="sd">    at that location due to a singularity, you may need a tool to</span>
<span class="sd">    compute the limit. `Limit` does this, as well as produce an</span>
<span class="sd">    uncertainty estimate in the final result.</span>

<span class="sd">    The methods used by `Limit` are Richardson extrapolation in a combination</span>
<span class="sd">    with Wynn&#39;s epsilon algorithm which also yield an error estimate.</span>
<span class="sd">    The user can specify the method order, as well as the path into</span>
<span class="sd">    z0. z0 may be real or complex. `Limit` uses a proportionally cascaded</span>
<span class="sd">    series of function evaluations, moving away from your point of evaluation</span>
<span class="sd">    along a path along the real line (or in the complex plane for complex z0 or</span>
<span class="sd">    step.) The `step_ratio` is the ratio used between sequential steps. The</span>
<span class="sd">    sign of step allows you to specify a limit from above or below. Negative</span>
<span class="sd">    values of step will cause the limit to be taken approaching z0 from below.</span>

<span class="sd">    A smaller `step_ratio` means that `Limit` will take more function</span>
<span class="sd">    evaluations to evaluate the limit, but the result will potentially be less</span>
<span class="sd">    accurate. The `step_ratio` MUST be a scalar larger than 1. A value in the</span>
<span class="sd">    range [2,100] is recommended. 4 seems a good compromise.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">     Compute the limit of sin(x)./x, at x == 0. The limit is 1.</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from numdifftools.limits import Limit</span>
<span class="sd">    &gt;&gt;&gt; def f(x): return np.sin(x)/x</span>
<span class="sd">    &gt;&gt;&gt; lim_f0, err = Limit(f, full_output=True)(0)</span>
<span class="sd">    &gt;&gt;&gt; np.allclose(lim_f0, 1)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; np.allclose(err.error_estimate, 1.77249444610966e-15)</span>
<span class="sd">    True</span>

<span class="sd">    Compute the derivative of cos(x) at x == pi/2. It should</span>
<span class="sd">    be -1. The limit will be taken as a function of the</span>
<span class="sd">    differential parameter, dx.</span>

<span class="sd">    &gt;&gt;&gt; x0 = np.pi/2;</span>
<span class="sd">    &gt;&gt;&gt; def g(x): return (np.cos(x0+x)-np.cos(x0))/x</span>
<span class="sd">    &gt;&gt;&gt; lim_g0, err = Limit(g, full_output=True)(0)</span>
<span class="sd">    &gt;&gt;&gt; np.allclose(lim_g0, -1)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; err.error_estimate &lt; 1e-14</span>
<span class="sd">    True</span>

<span class="sd">    Compute the residue at a first order pole at z = 0</span>
<span class="sd">    The function 1./(1-exp(2*z)) has a pole at z == 0.</span>
<span class="sd">    The residue is given by the limit of z*fun(z) as z --&gt; 0.</span>
<span class="sd">    Here, that residue should be -0.5.</span>

<span class="sd">    &gt;&gt;&gt; def h(z): return -z/(np.expm1(2*z))</span>
<span class="sd">    &gt;&gt;&gt; lim_h0, err = Limit(h, full_output=True)(0)</span>
<span class="sd">    &gt;&gt;&gt; np.allclose(lim_h0, -0.5)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; err.error_estimate &lt; 1e-14</span>
<span class="sd">    True</span>

<span class="sd">    A more difficult limit is one where there is significant</span>
<span class="sd">    subtractive cancellation at the limit point. In the following</span>
<span class="sd">    example, the cancellation is second order. The true limit</span>
<span class="sd">    should be 0.5.</span>

<span class="sd">    &gt;&gt;&gt; def k(x): return (x*np.exp(x)-np.exp(x)+1)/x**2</span>
<span class="sd">    &gt;&gt;&gt; lim_k0,err = Limit(k, full_output=True)(0)</span>
<span class="sd">    &gt;&gt;&gt; np.allclose(lim_k0, 0.5)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; np.allclose(err.error_estimate, 7.4e-9)</span>
<span class="sd">    True</span>

<span class="sd">    &gt;&gt;&gt; def h(x): return  (x-np.sin(x))/x**3</span>
<span class="sd">    &gt;&gt;&gt; lim_h0, err = Limit(h, full_output=True)(0)</span>
<span class="sd">    &gt;&gt;&gt; lim_h0, err</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">info</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;info&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;error_estimate&#39;</span><span class="p">,</span> <span class="s">&#39;final_step&#39;</span><span class="p">,</span> <span class="s">&#39;index&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="Limit.__init__"><a class="viewcode-back" href="../../api/generated/numdifftools.limits.Limit.html#numdifftools.limits.Limit.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;above&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                 <span class="n">full_output</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_output</span> <span class="o">=</span> <span class="n">full_output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_generator</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_make_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">step</span>
        <span class="k">return</span> <span class="n">MinStepGenerator</span><span class="p">(</span><span class="n">base_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_arg_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arg_mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanargmin</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">min_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">ix</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">min_error</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">min_errors</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">errors</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_error</span><span class="p">)</span>
            <span class="n">arg_mins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">idx</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_multi_index</span><span class="p">((</span><span class="n">arg_mins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ix</span>

    <span class="k">def</span> <span class="nf">_add_error_to_outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">der</span><span class="p">,</span> <span class="n">trim_fact</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c"># discard any estimate that differs wildly from the</span>
        <span class="c"># median of all estimates. A factor of 10 to 1 in either</span>
        <span class="c"># direction is probably wild enough here. The actual</span>
        <span class="c"># trimming factor is defined as a parameter.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">der</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">p75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">der</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">p25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">der</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">iqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p75</span><span class="o">-</span><span class="n">p25</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">der</span>

        <span class="n">a_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">median</span><span class="p">)</span>
        <span class="n">outliers</span> <span class="o">=</span> <span class="p">(((</span><span class="nb">abs</span><span class="p">(</span><span class="n">der</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">a_median</span> <span class="o">/</span> <span class="n">trim_fact</span><span class="p">))</span> <span class="o">+</span>
                    <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">der</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">a_median</span> <span class="o">*</span> <span class="n">trim_fact</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a_median</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="o">+</span>
                    <span class="p">((</span><span class="n">der</span> <span class="o">&lt;</span> <span class="n">p25</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">p75</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="n">iqr</span> <span class="o">&lt;</span> <span class="n">der</span><span class="p">)))</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">outliers</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">der</span> <span class="o">-</span> <span class="n">median</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">errors</span>

    <span class="k">def</span> <span class="nf">_get_best_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">der</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="n">errors</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_error_to_outliers</span><span class="p">(</span><span class="n">der</span><span class="p">)</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_arg_min</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
        <span class="n">final_step</span> <span class="o">=</span> <span class="n">steps</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">der</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">final_step</span><span class="p">,</span> <span class="n">ix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_richardson_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_ratio</span><span class="p">,</span> <span class="n">num_terms</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_richardson_extrapolate</span> <span class="o">=</span> <span class="n">Richardson</span><span class="p">(</span><span class="n">step_ratio</span><span class="o">=</span><span class="n">step_ratio</span><span class="p">,</span>
                                                  <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="n">num_terms</span><span class="o">=</span><span class="n">num_terms</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_wynn_extrapolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">der</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
        <span class="n">der</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">dea3</span><span class="p">(</span><span class="n">der</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">der</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">der</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">symmetric</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">der</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">steps</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_extrapolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="n">der1</span><span class="p">,</span> <span class="n">errors1</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_richardson_extrapolate</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">der1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># der, errors, steps = self._richardson_extrapolate(results, steps)</span>
            <span class="n">der1</span><span class="p">,</span> <span class="n">errors1</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wynn_extrapolate</span><span class="p">(</span><span class="n">der1</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">der</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_best_estimate</span><span class="p">(</span><span class="n">der1</span><span class="p">,</span> <span class="n">errors1</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">der</span><span class="p">,</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">_get_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">step</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">xi</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">_vstack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
        <span class="c"># sequence = np.atleast_2d(sequence)</span>
        <span class="n">original_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">f_del</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">original_shape</span><span class="p">)</span><span class="o">*</span><span class="n">step</span><span class="p">))</span>
                      <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f_del</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">h</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;fun did not return data of correct size &#39;</span> <span class="o">+</span>
                             <span class="s">&#39;(it must be vectorized)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f_del</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">original_shape</span>

    <span class="k">def</span> <span class="nf">_lim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">):</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">forward</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">backward</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">below</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">]</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">sign</span> <span class="o">*</span> <span class="n">step</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">z</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_richardson_rule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">step_ratio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vstack</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
        <span class="n">lim_fz</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extrapolate</span><span class="p">(</span><span class="o">*</span><span class="n">results</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lim_fz</span><span class="p">,</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">fz</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fz</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">fz</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">fz</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fz</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">final_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fz</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fz</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fz</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fz</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fz</span><span class="p">)</span>
            <span class="n">lim_fz</span><span class="p">,</span> <span class="n">info1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lim</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">fz</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">lim_fz</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_output</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">final_step</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">info1</span><span class="o">.</span><span class="n">final_step</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">info1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">info1</span><span class="o">.</span><span class="n">error_estimate</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">final_step</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fz</span>


<span class="c"># class Residue(Limit):</span>
<span class="c">#     &quot;&quot;&quot;function [res,errest] = residueEst(fun,z0,varargin)</span>
<span class="c">#     residueEst: residue of fun at z0 with an error estimate,</span>
<span class="c"># 1st or 2nd order pole</span>
<span class="c">#     usage: [res,errest] = residueEst(fun,z0)</span>
<span class="c">#     usage: [res,errest] = residueEst(fun,z0,prop1,val1,prop2,val2,...)</span>
<span class="c">#</span>
<span class="c">#     ResidueEst computes the residue of a given function at a</span>
<span class="c">#     simple first order pole, or at a second order pole.</span>
<span class="c">#</span>
<span class="c">#     The methods used by residueEst are polynomial extrapolants,</span>
<span class="c">#     which also yield an error estimate. The user can specify the</span>
<span class="c">#     method order, as well as the order of the pole. For more</span>
<span class="c">#     information on the exact methods, see the pdf file for my</span>
<span class="c">#     residueEst suite of codes.</span>
<span class="c">#</span>
<span class="c">#     Finally, While I have not written this function for the</span>
<span class="c">#     absolute maximum speed, speed was a major consideration</span>
<span class="c">#     in the algorithmic design. Maximum accuracy was my main goal.</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#     Arguments (input)</span>
<span class="c">#     fun - function to compute the residue for. May be an inline</span>
<span class="c">#           function, anonymous, or an m-file. If there are additional</span>
<span class="c">#           parameters to be passed into fun, then use of an anonymous</span>
<span class="c">#           function is recommended.</span>
<span class="c">#</span>
<span class="c">#           fun should be vectorized to allow evaluation at multiple</span>
<span class="c">#           locations at once. This will provide the best possible</span>
<span class="c">#           speed. IF fun is not so vectorized, then you MUST set</span>
<span class="c">#           &#39;vectorized&#39; property to &#39;no&#39;, so that residueEst will</span>
<span class="c">#           then call your function sequentially instead.</span>
<span class="c">#</span>
<span class="c">#           Fun is assumed to return a result of the same</span>
<span class="c">#           shape and size as its input.</span>
<span class="c">#</span>
<span class="c">#     z0  - scalar point at which to compute the residue. z0 may be</span>
<span class="c">#           real or complex.</span>
<span class="c">#</span>
<span class="c">#     Additional inputs must be in the form of property/value pairs.</span>
<span class="c">#     Properties are character strings. They may be shortened</span>
<span class="c">#     to the extent that they are unambiguous. Properties are</span>
<span class="c">#     not case sensitive. Valid property names are:</span>
<span class="c">#</span>
<span class="c">#     &#39;PoleOrder&#39;, &#39;MethodOrder&#39;, &#39;Vectorized&#39; &#39;StepRatio&#39;, &#39;MaxStep&#39;</span>
<span class="c">#     &#39;Path&#39;, &#39;DZ&#39;,</span>
<span class="c">#</span>
<span class="c">#     All properties have default values, chosen as intelligently</span>
<span class="c">#     as I could manage. Values that are character strings may</span>
<span class="c">#     also be unambiguously shortened. The legal values for each</span>
<span class="c">#     property are:</span>
<span class="c">#</span>
<span class="c">#     &#39;PoleOrder&#39; - specifies the order of the pole at z0.</span>
<span class="c">#           Must be 1, 2 or 3.</span>
<span class="c">#</span>
<span class="c">#           DEFAULT: 1 (first order pole)</span>
<span class="c">#</span>
<span class="c">#     &#39;Vectorized&#39; - residueEst will normally assume that your</span>
<span class="c">#           function can be safely evaluated at multiple locations</span>
<span class="c">#           in a single call. This would minimize the overhead of</span>
<span class="c">#           a loop and additional function call overhead. Some</span>
<span class="c">#           functions are not easily vectorizable, but you may</span>
<span class="c">#           (if your matlab release is new enough) be able to use</span>
<span class="c">#           arrayfun to accomplish the vectorization.</span>
<span class="c">#</span>
<span class="c">#           When all else fails, set the &#39;vectorized&#39; property</span>
<span class="c">#           to &#39;no&#39;. This will cause residueEst to loop over the</span>
<span class="c">#           successive function calls.</span>
<span class="c">#</span>
<span class="c">#           DEFAULT: &#39;yes&#39;</span>
<span class="c">#</span>
<span class="c">#     &#39;Path&#39; - Specifies the type of path to take the limit along.</span>
<span class="c">#           Must be either &#39;spiral&#39; or &#39;radial&#39;. Spiral paths</span>
<span class="c">#           will follow an exponential spiral into the pole, with</span>
<span class="c">#           angular steps at pi/8 radians.</span>
<span class="c">#</span>
<span class="c">#           DEFAULT: &#39;radial&#39;</span>
<span class="c">#</span>
<span class="c">#     &#39;DZ&#39; - Nominal step away from z0 taken in the estimation</span>
<span class="c">#           All samples of fun will be taken at some path away</span>
<span class="c">#           from zo, along the path z0 + dz. dz may be complex.</span>
<span class="c">#</span>
<span class="c">#           DEFAULT: 1e8*eps(z0)</span>
<span class="c">#</span>
<span class="c">#     &#39;StepRatio&#39; - ResidueEst uses a proportionally cascaded</span>
<span class="c">#           series of function evaluations, moving away from your</span>
<span class="c">#           point of evaluation along a path in the complex plane.</span>
<span class="c">#           The StepRatio is the ratio used between sequential steps.</span>
<span class="c">#</span>
<span class="c">#           DEFAULT: 4</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#     See the document DERIVEST.pdf for more explanation of the</span>
<span class="c">#     algorithms behind the parameters of residueEst. In most cases,</span>
<span class="c">#     I have chosen good values for these parameters, so the user</span>
<span class="c">#     should never need to specify anything other than possibly</span>
<span class="c">#     the PoleOrder. I&#39;ve also tried to make my code robust enough</span>
<span class="c">#     that it will not need much. But complete flexibility is in</span>
<span class="c">#     there for your use.</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#     Arguments: (output)</span>
<span class="c">#     residue - residue estimate at z0.</span>
<span class="c">#</span>
<span class="c">#           When the residue is estimated as approximately zero,</span>
<span class="c">#           the wrong order pole may have been specified.</span>
<span class="c">#</span>
<span class="c">#     errest - 95 uncertainty estimate around the residue, such that</span>
<span class="c">#</span>
<span class="c">#           abs(residue - fun(z0)*(z-z0)) &lt; erest(j)</span>
<span class="c">#</span>
<span class="c">#           Large uncertainties here suggest that the wrong order</span>
<span class="c">#           pole was specified for fun(z0).</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#     Example:</span>
<span class="c">#     A first order pole at z = 0</span>
<span class="c">#</span>
<span class="c">#     [r,e]=residueEst(@(z) 1./(1-exp(2*z)),0)</span>
<span class="c">#</span>
<span class="c">#     r =</span>
<span class="c">#             -0.5</span>
<span class="c">#</span>
<span class="c">#     e =</span>
<span class="c">#       4.5382e-12</span>
<span class="c">#</span>
<span class="c">#     Example:</span>
<span class="c">#     A second order pole around z = pi</span>
<span class="c">#</span>
<span class="c">#     [r,e]=residueEst(@(z) 1./(sin(z).^2),pi,&#39;poleorder&#39;,2)</span>
<span class="c">#</span>
<span class="c">#     r =</span>
<span class="c">#                1</span>
<span class="c">#</span>
<span class="c">#     e =</span>
<span class="c">#       2.6336e-11</span>
<span class="c">#     &quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c">#     def __init__(self, f, dz=None, order=None, pole_order=1, max_step=1000,</span>
<span class="c">#                  step_ratio=2.0, path=&#39;radial&#39;, dtheta=np.pi/8):</span>
<span class="c">#         if order is None:</span>
<span class="c">#             order = pole_order + 1</span>
<span class="c">#</span>
<span class="c">#         if order &lt;= pole_order:</span>
<span class="c">#             raise ValueError(&#39;MethodOrder must be at least PoleOrder+1.&#39;)</span>
<span class="c">#         if path not in [&#39;spiral&#39;, &#39;radial&#39;]:</span>
<span class="c">#             raise ValueError(&#39;Invalid Path: %s&#39; % str(path))</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#     # supply a default step?</span>
<span class="c">#     if isempty(par.DZ)</span>
<span class="c">#       if z0 == 0</span>
<span class="c">#         # special case for zero</span>
<span class="c">#         par.DZ = 1e8*eps(1);</span>
<span class="c">#       else</span>
<span class="c">#         par.DZ = 1e8*eps(z0);</span>
<span class="c">#       end</span>
<span class="c">#     elseif numel(par.DZ)&gt;1</span>
<span class="c">#       error(&#39;DZ must be scalar if supplied&#39;)</span>
<span class="c">#     end</span>
<span class="c">#</span>
<span class="c">#     # MethodOrder will always = PoleOrder + 2</span>
<span class="c">#     if isempty(par.MethodOrder)</span>
<span class="c">#       par.MethodOrder = par.PoleOrder+2;</span>
<span class="c">#     end</span>
<span class="c">#</span>
<span class="c">#     # if a radial path</span>
<span class="c">#     if (lower(par.Path(1)) == &#39;r&#39;)</span>
<span class="c">#       # a radial path. Just override any DTheta.</span>
<span class="c">#       par.DTheta = 0;</span>
<span class="c">#     else</span>
<span class="c">#       # a spiral path</span>
<span class="c">#       # par.DTheta has a default of pi/8 (radians)</span>
<span class="c">#     end</span>
<span class="c">#</span>
<span class="c">#     # Define the samples to use along a linear path</span>
<span class="c">#     k = (-15:15)&#39;;</span>
<span class="c">#     theta = par.DTheta*k;</span>
<span class="c">#     delta = par.DZ*exp(sqrt(-1)*theta).*(par.StepRatio.^k);</span>
<span class="c">#     ndel = length(delta);</span>
<span class="c">#     Z = z0 + delta;</span>
<span class="c">#</span>
<span class="c">#     # sample the function at these sample points</span>
<span class="c">#     if strcmpi(par.Vectorized,&#39;yes&#39;)</span>
<span class="c">#       # fun is supposed to be vectorized.</span>
<span class="c">#       fz = fun(Z);</span>
<span class="c">#       fz = fz(:);</span>
<span class="c">#       if numel(fz) ~= ndel</span>
<span class="c">#         error(&#39;fun did not return a result of the proper size. Perhaps not properly vectorized?&#39;)</span>
<span class="c">#       end</span>
<span class="c">#     else</span>
<span class="c">#       # evaluate in a loop</span>
<span class="c">#       fz = zeros(size(Z));</span>
<span class="c">#       for i = 1:ndel</span>
<span class="c">#         fz(i) = fun(Z(i));</span>
<span class="c">#       end</span>
<span class="c">#     end</span>
<span class="c">#</span>
<span class="c">#     # multiply the sampled function by (Z - z0).^par.PoleOrder</span>
<span class="c">#     fz = fz.*(delta.^par.PoleOrder);</span>
<span class="c">#</span>
<span class="c">#     # replicate the elements of fz into a sliding window</span>
<span class="c">#     m = par.MethodOrder;</span>
<span class="c">#     fz = fz(repmat((1:(ndel-m)),m+1,1) + repmat((0:m)&#39;,1,ndel-m));</span>
<span class="c">#</span>
<span class="c">#     # generate the general extrapolation rule</span>
<span class="c">#     d = par.StepRatio.^((0:m)&#39;-m/2);</span>
<span class="c">#     A = repmat(d,1,m).^repmat(0:m-1,m+1,1);</span>
<span class="c">#     [qA,rA] = qr(A,0);</span>
<span class="c">#</span>
<span class="c">#     # compute the various estimates of the prediction polynomials.</span>
<span class="c">#     polycoef = rA\(qA&#39;*fz);</span>
<span class="c">#</span>
<span class="c">#     # predictions for each model</span>
<span class="c">#     pred = A*polycoef;</span>
<span class="c">#     # and residual standard errors</span>
<span class="c">#     ser = sqrt(sum((pred - fz).^2,1));</span>
<span class="c">#</span>
<span class="c">#     # the actual extrapolated estimates are just the first row of polycoef</span>
<span class="c">#     # for a first order pole. For a second order pole, we need the first</span>
<span class="c">#     # lim_fz, so we need the second row. Higher order poles are not</span>
<span class="c">#     # estimable using this method due to numerical problems.</span>
<span class="c">#     switch par.PoleOrder</span>
<span class="c">#       case 1</span>
<span class="c">#         residue_estimates = polycoef(par.PoleOrder,:);</span>
<span class="c">#       case 2</span>
<span class="c">#         # we need to scale the estimated parameters by delta, for each estimate</span>
<span class="c">#         residue_estimates = polycoef(par.PoleOrder,:)./delta(1:(end - par.MethodOrder)).&#39;;</span>
<span class="c">#         residue_estimates = residue_estimates*par.StepRatio.^(-par.MethodOrder/2);</span>
<span class="c">#         # also the error estimate</span>
<span class="c">#         ser = ser./delta(1:(end - par.MethodOrder)).&#39; * par.StepRatio.^(-par.MethodOrder/2);</span>
<span class="c">#       case 3</span>
<span class="c">#         # we need to scale the estimated parameters by delta^(par.PoleOrder-1)</span>
<span class="c">#         residue_estimates = polycoef(par.PoleOrder,:)./delta(1:(end - par.MethodOrder)).&#39;.^2;</span>
<span class="c">#         residue_estimates = residue_estimates*par.StepRatio.^(-2*par.MethodOrder/2);</span>
<span class="c">#         ser = ser./delta(1:(end - par.MethodOrder)).&#39;.^2 * par.StepRatio.^(-2*par.MethodOrder/2);</span>
<span class="c">#     end</span>
<span class="c">#</span>
<span class="c">#     # uncertainty estimate of the limit</span>
<span class="c">#     rAinv = rA\eye(m);</span>
<span class="c">#     cov1 = sum(rAinv.^2,2);</span>
<span class="c">#</span>
<span class="c">#     # 1 spare dof, so we use a student&#39;s t with 1 dof</span>
<span class="c">#     errest = 12.7062047361747*sqrt(cov1(1))*ser;</span>
<span class="c">#</span>
<span class="c">#     # drop any estimates that were inf or nan.</span>
<span class="c">#     k = isnan(residue_estimates) | isinf(residue_estimates);</span>
<span class="c">#     errest(k) = [];</span>
<span class="c">#     residue_estimates(k) = [];</span>
<span class="c">#     # delta(k) = [];</span>
<span class="c">#</span>
<span class="c">#     # if nothing remains, then there was a problem.</span>
<span class="c">#     # possibly the wrong order pole, or a bad dz.</span>
<span class="c">#     nres = numel(residue_estimates);</span>
<span class="c">#     if nres &lt; 1</span>
<span class="c">#       error(&#39;Either the wrong order was specified for this pole, or dz was a very poor choice&#39;)</span>
<span class="c">#     end</span>
<span class="c">#</span>
<span class="c">#     # sort the remaining estimates</span>
<span class="c">#     [residue_estimates, tags] = sort(residue_estimates);</span>
<span class="c">#     errest = errest(tags);</span>
<span class="c">#     # delta = delta(tags);</span>
<span class="c">#</span>
<span class="c">#     # trim off the estimates at each end of the range</span>
<span class="c">#     if nres &gt; 4</span>
<span class="c">#       residue_estimates([1,end]) = [];</span>
<span class="c">#       errest([1,end]) = [];</span>
<span class="c">#       # delta([1,end]) = [];</span>
<span class="c">#     end</span>
<span class="c">#</span>
<span class="c">#     # and take the one that remains with the lowest error estimate</span>
<span class="c">#     [errest,k] = min(errest);</span>
<span class="c">#     res = residue_estimates(k);</span>
<span class="c">#     # delta = delta(k);</span>
<span class="c">#</span>
<span class="c">#     # for higher order poles, we need to divide by factorial(PoleOrder-1)</span>
<span class="c">#     if par.PoleOrder&gt;2</span>
<span class="c">#       res = res/factorial(par.PoleOrder-1);</span>
<span class="c">#       errest = errest/factorial(par.PoleOrder-1);</span>
<span class="c">#     end</span>
<span class="c">#</span>
<span class="c">#     end # mainline end</span>
<span class="c">#</span>
<span class="c">#</span>

</div>
<span class="k">def</span> <span class="nf">test_docstrings</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">NORMALIZE_WHITESPACE</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test_docstrings</span><span class="p">()</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2015, Per A Brodtkorb, John D&#39;Errico.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.9.14.post0.dev10+gd22e9fa.dirty',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>